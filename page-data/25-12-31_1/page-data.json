{"componentChunkName":"component---src-templates-blog-template-js","path":"/25-12-31_1/","result":{"data":{"cur":{"id":"16d4151c-c0f0-5202-8651-703654b9bb3c","html":"<p>ì°¸ê³  : í…Œë””ë…¸íŠ¸ì˜ RAG ë¹„ë²•ë…¸íŠ¸ (<a href=\"https://fastcampus.co.kr/data_online_teddy)\">https://fastcampus.co.kr/data_online_teddy)</a><br>ì†ŒìŠ¤ì½”ë“œ: <a href=\"https://github.com/teddylee777/langchain-kr\">https://github.com/teddylee777/langchain-kr</a><br>ìœ„í‚¤ë…ìŠ¤: <a href=\"https://wikidocs.net/book/14314\">https://wikidocs.net/book/14314</a></p>\n<p>Â </p>\n<p>ì´ë²ˆì—ëŠ” â€™<strong>LCELì—ì„œ ë©”ëª¨ë¦¬ ì‚¬ìš©í•˜ëŠ” ë°©ë²•</strong>â€˜ì„ ê°„ë‹¨íˆ ì •ë¦¬í•˜ê³ ,<br>â€™<strong>SQLite DBë¥¼ ì´ìš©í•œ ë©”ëª¨ë¦¬ ì €ì¥í•˜ëŠ” ë°©ë²•</strong>â€˜ì„ ì •ë¦¬í•´ë³´ê³ ì í•©ë‹ˆë‹¤.</p>\n<p>ìƒë‹¹íˆ ë³µì¡í•´ë³´ì—¬ì„œ ì—°ìŠµì´ ì¤‘ìš”í•  ê²ƒ ê°™ìŠµë‹ˆë‹¤.</p>\n<p>(<strong>ì£¼ì˜â€¼ï¸ ë§ˆìŒì˜ ì¤€ë¹„ë¥¼ í•˜ê³ , ì‹¬í˜¸í¡ í•œë²ˆ í¬ê²Œ í•˜ê³  ë“¤ì–´ê°€ì•¼ í•©ë‹ˆë‹¤.</strong>)</p>\n<p>ë ˆì¸ ê¸°ë¦¿~!</p>\n<p>Â </p>\n<h2 id=\"lcelì—ì„œ-ë©”ëª¨ë¦¬-ì‚¬ìš©í•˜ëŠ”-ë°©ë²•\" style=\"position:relative;\"><a href=\"#lcel%EC%97%90%EC%84%9C-%EB%A9%94%EB%AA%A8%EB%A6%AC-%EC%82%AC%EC%9A%A9%ED%95%98%EB%8A%94-%EB%B0%A9%EB%B2%95\" aria-label=\"lcelì—ì„œ ë©”ëª¨ë¦¬ ì‚¬ìš©í•˜ëŠ” ë°©ë²• permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>LCELì—ì„œ ë©”ëª¨ë¦¬ ì‚¬ìš©í•˜ëŠ” ë°©ë²•</h2>\n<hr>\n<ol>\n<li>\n<p><strong>í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ì— <code class=\"language-text\">MessagesPlaceholder(variable_name=\"chat_history\")</code> ë°•ì•„ë‘ê¸°</strong>!</p>\n</li>\n<li>\n<p><strong><code class=\"language-text\">memory = ConversationBufferMemory(return_messages=True, memory_key=\"chat_history\")</code> ë©”ëª¨ë¦¬ ìƒì„±í•˜ë©´ì„œ<br><code class=\"language-text\">memory_key</code>ì˜ ê°’ê³¼ <code class=\"language-text\">MessagesPlaceholder</code>ì— ë“¤ì–´ê°€ëŠ” <code class=\"language-text\">variable_name</code> ê°’ì„ ë™ì¼í•˜ê²Œ í•˜ê¸°</strong></p>\n<ul>\n<li><strong>ë©”ëª¨ë¦¬ì—ì„œ ì§€ì •í•œ <code class=\"language-text\">memory_key</code>ëŠ” í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ì—ì„œ ì´ì „ ëŒ€í™” ìë¦¬ì— ë°•ì•„ë‘ëŠ” ë³€ìˆ˜ëª…ê³¼ ê°™ì•„ì•¼ í•¨</strong></li>\n</ul>\n</li>\n<li>\n<p><strong><code class=\"language-text\">RunnablePassthrough.assign()</code>ì—ì„œ <code class=\"language-text\">RunnableLambda(memory.load_memory_variables) | itemgetter(memory.memory_key)</code>ì„ <code class=\"language-text\">chat_history</code>ì— ì§€ì •í•œ <code class=\"language-text\">runnable</code>ì„ ë§Œë“¤ì–´ chainì—ì„œ ì´ìš©í•¨</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> langchain_core<span class=\"token punctuation\">.</span>runnables <span class=\"token keyword\">import</span> RunnableLambda<span class=\"token punctuation\">,</span> RunnablePassthrough\n\nrunnable <span class=\"token operator\">=</span> RunnablePassthrough<span class=\"token punctuation\">.</span>assign<span class=\"token punctuation\">(</span>  chat_history<span class=\"token operator\">=</span>RunnableLambda<span class=\"token punctuation\">(</span>memory<span class=\"token punctuation\">.</span>load_memory_variables<span class=\"token punctuation\">)</span>\n    <span class=\"token operator\">|</span> itemgetter<span class=\"token punctuation\">(</span><span class=\"token string\">\"chat_history\"</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># RunnableLambda(memory.load_memory_variables)ì˜ ë°˜í™˜ê°’ì—ì„œ chat_historyë§Œ ì¶”ì¶œ</span>\n    <span class=\"token comment\"># | itemgetter(memory.memory_key) # ìœ„ì™€ ë˜‘ê°™ìŒ</span>\n<span class=\"token punctuation\">)</span>\n\nrunnable<span class=\"token punctuation\">.</span>invoke<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"input\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"hi\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># {'input': 'hi'}ê³¼ chat_history ê°’ì´ í•©ì³ì ¸ ì•„ë˜ì˜ í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ì˜ ë³€ìˆ˜ê°’ì— ë“¤ì–´ê°ˆ ê²ƒì„ ({'input': 'hi', 'chat_history': [ëŒ€í™”ë“¤]} ê¼´)</span></code></pre></div>\n<ul>\n<li><strong><code class=\"language-text\">RunnableLambda(memory.load_memory_variables)</code>ëŠ” <code class=\"language-text\">memory.load_memory_variables({})</code>ì™€ ê°™ì€ ê²ƒì„</strong>\n<ul>\n<li>ì¦‰, <code class=\"language-text\">chat_history</code> í‚¤ì˜ ê°’ì— <strong>ëŒ€í™”ë“¤ ë¦¬ìŠ¤íŠ¸</strong>ë¥¼ ë‹´ì€ ë”•ì…”ë„ˆë¦¬ì¼ ê²ƒì„</li>\n</ul>\n</li>\n<li>ê·¸ë¦¬ê³ , â­ï¸ <strong><code class=\"language-text\">memory.load_memory_variables({})</code>ì˜ ê²°ê³¼ê°’(ëŒ€í™”ë“¤ ë‹´ê¸´ ë”•ì…”ë„ˆë¦¬)ì—ì„œ <code class=\"language-text\">memory.memory_key</code>ê°’(â€˜chat_historyâ€™ í‚¤ì˜ ê°’, ì¦‰ ëŒ€í™”ë“¤)ë§Œ ì¶”ì¶œí•´ì„œ <code class=\"language-text\">chat_history</code> ë³€ìˆ˜ì— ì „ë‹¬í•¨</strong> â­ï¸\n<ul>\n<li><code class=\"language-text\">memory.load_memory_variables({})</code><br>: {â€˜chat_historyâ€™: [ëŒ€í™”ë“¤]} ê¼´</li>\n<li><code class=\"language-text\">memory.memory_key</code>ê°’(â€˜chat_historyâ€™ í‚¤ì˜ ê°’)ë§Œ ì¶”ì¶œ<br>: [ëŒ€í™”ë“¤] ê¼´</li>\n<li><code class=\"language-text\">chat_history</code> ë³€ìˆ˜ì— ì „ë‹¬í•œ í›„ì˜ ìµœì¢… <code class=\"language-text\">RunnablePassthrough.assign()</code> ê°’<br>: {â€˜chat_historyâ€™: [ëŒ€í™”ë“¤]}</li>\n<li><code class=\"language-text\">runnable.invoke({\"input\": \"hi\"})</code> ê°’<br>: <code class=\"language-text\">{'input': 'hi'}</code>ê³¼ <code class=\"language-text\">chat_history</code> ê°’ì´ í•©ì³ì ¸ <code class=\"language-text\">{'input': 'hi', 'chat_history': [ëŒ€í™”ë“¤]}</code> ê¼´ì´ ë¨</li>\n</ul>\n</li>\n</ul>\n<p>Â </p>\n<p>â­ï¸ **ê²°êµ­, runnableë¥¼ invoke í˜¸ì¶œí–ˆì„ ë•Œ<br><code class=\"language-text\">{'input': 'hi', 'chat_history': [ëŒ€í™”ë“¤]}</code>ì´ ë˜ë¯€ë¡œ ê°ê° ì‚¬ìš©ì ì…ë ¥ê°’ê³¼ ì´ì „ ëŒ€í™”ë¡œ í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ì—ì„œ ì´ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!!**â­ï¸</p>\n<p>(ì¢€ ë³µì¡í•˜ì§€ë§Œ ê·¸ ê³¼ì •ì„ ëª…í™•íˆ ì•Œê³  ìˆì–´ì•¼ ë³¸ê²©ì ìœ¼ë¡œ chainì— ì—°ê²°í•  ë•Œ í—·ê°ˆë¦¬ì§€ ì•Šì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤..)</p>\n</li>\n</ol>\n<p>Â </p>\n<p>ë°©ê¸ˆ ë§Œë“¤ì—ˆë˜ **ì´ì „ ëŒ€í™”ì™€ ìƒˆë¡œìš´ ì§ˆë¬¸ì„ ë°˜í™˜í•˜ëŠ” <code class=\"language-text\">runnable</code>**ì„ ê°€ì¥ ë§¨ ì•ì— ë¶™ì—¬<br>ê·¸ ê²°ê³¼ë¥¼ í”„ë¡¬í”„íŠ¸ì— ì „ë‹¬í•˜ëŠ” â€˜runnable-í”„ë¡¬í”„íŠ¸-LLM-íŒŒì„œâ€™ ì´ë ‡ê²Œ chainì„ êµ¬ì„±í•˜ë©´ ë  ë“¯ í•©ë‹ˆë‹¤.</p>\n<p>Â </p>\n<p>Â </p>\n<h2 id=\"sqlite-dbë¥¼-ì´ìš©í•œ-ë©”ëª¨ë¦¬-ì €ì¥-ë°©ë²•\" style=\"position:relative;\"><a href=\"#sqlite-db%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EB%A9%94%EB%AA%A8%EB%A6%AC-%EC%A0%80%EC%9E%A5-%EB%B0%A9%EB%B2%95\" aria-label=\"sqlite dbë¥¼ ì´ìš©í•œ ë©”ëª¨ë¦¬ ì €ì¥ ë°©ë²• permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SQLite DBë¥¼ ì´ìš©í•œ ë©”ëª¨ë¦¬ ì €ì¥ ë°©ë²•</h2>\n<hr>\n<p>ì´ì „ê¹Œì§€ëŠ” ì¸ë©”ëª¨ë¦¬ì— ìºì‹œë¥¼ ì €ì¥í•˜ëŠ” ë°©ë²•ì„ ì •ë¦¬í•´ë´¤ëŠ”ë°<br>ì‚¬ì‹¤, ëŒ€í™” ì„¸ì…˜ì„ ì¼íšŒì„±ìœ¼ë¡œ ì´ìš©í•˜ëŠ” ê²ƒì´ë©´ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•˜ì§€ ì•Šì•„ë„ ë˜ê¸´ í•©ë‹ˆë‹¤.</p>\n<p>í•˜ì§€ë§Œ, ì´ì „ ëŒ€í™”ë¥¼ ë‚˜ì¤‘ì— ë‹¤ì‹œ ì‚¬ìš©í•´ì•¼ í•œë‹¤ë©´ ë°ì´í„°ë² ì´ìŠ¤ì— ìœ ì €ë³„ í…Œì´ë¸” í˜•ì‹ìœ¼ë¡œ ì €ì¥í•´ë‘ê³ , ê·¸ ê¸°ë°˜ìœ¼ë¡œ ë‹µë³€ì„ í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.</p>\n<p>Â </p>\n<p>íë¦„ë¶€í„° ì •ë¦¬í•˜ê² ìŠµë‹ˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">invoke() í˜¸ì¶œ\n    â†“\nconfigì—ì„œ user_id, session_id ì¶”ì¶œ (history_factory_config ì°¸ì¡°)\n    â†“\nget_chat_history(user_id, session_id) í˜¸ì¶œ â†’ ChatMessageHistory ë°˜í™˜\n    â†“\nchat_historyë¥¼ í”„ë¡¬í”„íŠ¸ì— ì£¼ì… (history_messages_key ì‚¬ìš©)\n    â†“\nquestionì„ í”„ë¡¬í”„íŠ¸ì— ì£¼ì… (input_messages_key ì‚¬ìš©)\n    â†“\nLLM ì‹¤í–‰ â†’ ì‘ë‹µ ë°˜í™˜\n    â†“\nìƒˆ ëŒ€í™”(ì§ˆë¬¸+ì‘ë‹µ)ë¥¼ ChatMessageHistoryì— ìë™ ì €ì¥</code></pre></div>\n<p>ì²˜ìŒì— ì§ˆë¬¸ì„ í–ˆì„ ë•Œ configì—ì„œ ì–´ë– í•œ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì–´ë– í•œ í…Œì´ë¸”ì—ì„œ ì–´ë– í•œ ì»¬ëŸ¼ê°’ì„ ì°¸ê³ í• ì§€ë¥¼ ì •í•©ë‹ˆë‹¤.</p>\n<p>ì´í›„, í•´ë‹¹ configë¥¼ ì°¸ê³ í•˜ì—¬ ì´ì „ ëŒ€í™”ë¥¼ ê°€ì ¸ì˜¨ í›„ í”„ë¡¬í”„íŠ¸ì— ë„£ìŠµë‹ˆë‹¤.</p>\n<p>ê·¸ë¦¬ê³ , ì²˜ìŒ ì…ë ¥í•œ ì§ˆë¬¸ì„ í”„ë¡¬í”„íŠ¸ì— ë„£ìœ¼ë©´ì„œ LLMì´ ì‹¤í–‰í•˜ê³  ì‘ë‹µì„ ë°›ìŠµë‹ˆë‹¤.</p>\n<p>ë§ˆì§€ë§‰ì— ê·¸ ìƒˆë¡œìš´ ëŒ€í™”ë¥¼ í•´ë‹¹ ë°ì´í„°ë² ì´ìŠ¤ì˜ í…Œì´ë¸”ì— ë°ì´í„°ë¡œ ì €ì¥í•©ë‹ˆë‹¤.</p>\n<p>Â </p>\n<p>ì½”ë“œë¡œ ìì„¸í•˜ê²Œ ë´…ì‹œë‹¤.</p>\n<ol>\n<li>\n<p>**<code class=\"language-text\">ConfigurableFieldSpec</code>**ì„ ì´ìš©í•´ <strong>DB ì¡°íšŒí•  íŒŒë¼ë¯¸í„°(ì»¬ëŸ¼ëª… ë“±)ë¥¼ ì„¤ì •</strong>í•´ë‘ì–´ì•¼ í•©ë‹ˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> langchain_core<span class=\"token punctuation\">.</span>runnables<span class=\"token punctuation\">.</span>utils <span class=\"token keyword\">import</span> ConfigurableFieldSpec\n\nconfig_fields <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n    ConfigurableFieldSpec<span class=\"token punctuation\">(</span>\n        <span class=\"token builtin\">id</span><span class=\"token operator\">=</span><span class=\"token string\">\"user_id\"</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># â­ï¸ get_chat_history í•¨ìˆ˜ì—ì„œ ì‚¬ìš©í•  íŒŒë¼ë¯¸í„° â­ï¸</span>\n        annotation<span class=\"token operator\">=</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">,</span>\n        name<span class=\"token operator\">=</span><span class=\"token string\">\"User ID\"</span><span class=\"token punctuation\">,</span>\n        description<span class=\"token operator\">=</span><span class=\"token string\">\"Unique identifier for a user.\"</span><span class=\"token punctuation\">,</span>\n        default<span class=\"token operator\">=</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\n        is_shared<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    ConfigurableFieldSpec<span class=\"token punctuation\">(</span>\n        <span class=\"token builtin\">id</span><span class=\"token operator\">=</span><span class=\"token string\">\"conversation_id\"</span><span class=\"token punctuation\">,</span> <span class=\"token comment\"># â­ï¸ get_chat_history í•¨ìˆ˜ì—ì„œ ì‚¬ìš©í•  íŒŒë¼ë¯¸í„° â­ï¸</span>\n        annotation<span class=\"token operator\">=</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">,</span>\n        name<span class=\"token operator\">=</span><span class=\"token string\">\"Conversation ID\"</span><span class=\"token punctuation\">,</span>\n        description<span class=\"token operator\">=</span><span class=\"token string\">\"Unique identifier for a conversation.\"</span><span class=\"token punctuation\">,</span>\n        default<span class=\"token operator\">=</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\n        is_shared<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n</li>\n<li>\n<p><strong><code class=\"language-text\">get_chat_history</code></strong> í•¨ìˆ˜ì—ì„œ <strong>DBì—ì„œ ì‚¬ìš©í•  íŒŒë¼ë¯¸í„°ëª…ì„ ì¸ìë¡œ ë°›ì•„</strong>, **<code class=\"language-text\">SQLChatMessageHistory</code>**ì„ ì´ìš©í•´ <strong>DB ë©”ì‹œì§€ íˆìŠ¤í† ë¦¬ë¥¼ ê´€ë¦¬</strong>í•˜ë„ë¡ ì •ì˜í•©ë‹ˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">get_chat_history</span><span class=\"token punctuation\">(</span>user_id<span class=\"token punctuation\">,</span> conversation_id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">return</span> SQLChatMessageHistory<span class=\"token punctuation\">(</span>\n        table_name<span class=\"token operator\">=</span>user_id<span class=\"token punctuation\">,</span>          <span class=\"token comment\"># (ìœ ì € IDë³„) í…Œì´ë¸”</span>\n        session_id<span class=\"token operator\">=</span>conversation_id<span class=\"token punctuation\">,</span>  <span class=\"token comment\"># ëŒ€í™” ID ì»¬ëŸ¼</span>\n        connection<span class=\"token operator\">=</span><span class=\"token string\">\"sqlite:///sqlite.db\"</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># ë°ì´í„°ë² ì´ìŠ¤ íŒŒì¼ëª…</span>\n    <span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li>\n<p><code class=\"language-text\">table_name</code>: (ë³´í†µ ìœ ì € IDë³„) í…Œì´ë¸”ëª… ì„¤ì •</p>\n</li>\n<li>\n<p><code class=\"language-text\">session_id</code>: í…Œì´ë¸”ì—ì„œ session_id ê°’ì— ë„£ëŠ” ëŒ€í™” ì„¸ì…˜ ID ê°’ ì„¤ì •</p>\n</li>\n<li>\n<p><code class=\"language-text\">connection</code>: ë°ì´í„°ë² ì´ìŠ¤ íŒŒì¼ëª… ì„¤ì •</p>\n</li>\n</ul>\n</li>\n<li>\n<p><code class=\"language-text\">RunnableWithMessageHistory()</code> ê°ì²´ ìƒì„±í•˜ë©´ì„œ <strong>ëŒ€í™” ë‚´ìš©ì„ ê¸°ë¡í•´ì£¼ëŠ” í•¨ìˆ˜ë¥¼ ê¸°ì¡´ ì²´ì¸ì— ì—°ê²°</strong>í•´ì¤ë‹ˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> langchain_core<span class=\"token punctuation\">.</span>runnables<span class=\"token punctuation\">.</span>history <span class=\"token keyword\">import</span> RunnableWithMessageHistory\n\nchain_with_history <span class=\"token operator\">=</span> RunnableWithMessageHistory<span class=\"token punctuation\">(</span>\n    chain<span class=\"token punctuation\">,</span>\n    get_chat_history<span class=\"token punctuation\">,</span>  <span class=\"token comment\"># ëŒ€í™” ê¸°ë¡ì„ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.</span>\n    input_messages_key<span class=\"token operator\">=</span><span class=\"token string\">\"question\"</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># ì…ë ¥ ë©”ì‹œì§€ì˜ í‚¤ë¥¼ \"question\"ìœ¼ë¡œ ì„¤ì • (â­ï¸ chainì—ì„œ prompt í…œí”Œë¦¿ì˜ ì…ë ¥ ë³€ìˆ˜ì™€ ê°™ì•„ì•¼ í•¨ â­ï¸)</span>\n    history_messages_key<span class=\"token operator\">=</span><span class=\"token string\">\"chat_history\"</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># ëŒ€í™” ê¸°ë¡ ë©”ì‹œì§€ì˜ í‚¤ë¥¼ \"chat_history\"ë¡œ ì„¤ì • (â­ï¸ chainì—ì„œ prompt í…œí”Œë¦¿-ë©”ì‹œì§€í”Œë ˆì´ìŠ¤í™€ë”ì˜ ì…ë ¥ ë³€ìˆ˜ì™€ ê°™ì•„ì•¼ í•¨ â­ï¸)</span>\n    history_factory_config<span class=\"token operator\">=</span>config_fields<span class=\"token punctuation\">,</span>  <span class=\"token comment\"># ëŒ€í™” ê¸°ë¡ ì¡°íšŒì‹œ ì°¸ê³ í•  íŒŒë¼ë¯¸í„°ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤. (â­ï¸ get_chat_historyì—ì„œ ì‚¬ìš©í•˜ëŠ” ConfigurableFieldSpeceë“¤ì„ ì „ë‹¬í•˜ê¸° ìœ„í•œ ê²ƒ â­ï¸)</span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li>\n<p><code class=\"language-text\">chain</code>: ê¸°ì¡´ ì²´ì¸(í”„ë¡¬í”„íŠ¸-LLM-íŒŒì„œ ì—°ê²°)</p>\n</li>\n<li>\n<p><code class=\"language-text\">get_chat_history</code>: DBì—ì„œ ë°ì´í„°ë² ì´ìŠ¤ íŒŒì¼ëª…-ëŒ€í™” ì„¸ì…˜-(ìœ ì €ë³„) í…Œì´ë¸”ì„ ì°¾ì•„ê°€ì„œ ë©”ì‹œì§€ íˆìŠ¤í† ë¦¬ ê´€ë¦¬í•¨</p>\n</li>\n<li>\n<p><code class=\"language-text\">input_messages_key</code>: ê¸°ì¡´ ì²´ì¸ì—ì„œ í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ì—ì„œ ì‚¬ìš©í•˜ëŠ” ì…ë ¥ë³€ìˆ˜ ê°’ì„ ë„£ìŒ</p>\n</li>\n<li>\n<p><code class=\"language-text\">history_messages_key</code>: ê¸°ì¡´ ì²´ì¸ì—ì„œ í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ì—ì„œ <code class=\"language-text\">MessagesPlaceholder</code>ì—ì„œ ì‚¬ìš©í•˜ëŠ” ë³€ìˆ˜ ê°’ì„ ë„£ìŒ</p>\n</li>\n<li>\n<p><code class=\"language-text\">history_factory_config</code>: ëŒ€í™” ê¸°ë¡ ì¡°íšŒí•  ë•Œ ì°¸ê³ í•  íŒŒë¼ë¯¸í„° ì •ë³´ë“¤ ì„¤ì •</p>\n</li>\n</ul>\n</li>\n<li>\n<p>configì— configurable í‚¤ í•˜ìœ„ì— get_chat_historyì—ì„œ  <strong>DB ë©”ì‹œì§€ íˆìŠ¤í† ë¦¬ë¥¼ ê´€ë¦¬</strong>í•  ë•Œ ì‚¬ìš©í•˜ëŠ” <strong>íŒŒë¼ë¯¸í„°(ëŒ€í™” ì„¸ì…˜ ID, í…Œì´ë¸”ëª…)ë“¤ì„ ì„¤ì •</strong>í•©ë‹ˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># config ì„¤ì •</span>\n<span class=\"token triple-quoted-string string\">\"\"\"\nconfigurable í‚¤ í•˜ìœ„ì— user_id, conversation_id ê°’ì„ ì„¤ì •\n(get_chat_historyì—ì„œ DB ë©”ì‹œì§€ íˆìŠ¤í† ë¦¬ ê´€ë¦¬í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ê°’ë“¤)\n\"\"\"</span>\nconfig <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"configurable\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"user_id\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"user1\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"conversation_id\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"conversation1\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>\n<p><strong>table_name í…Œì´ë¸”ëª…=user_id=user1</strong></p>\n</li>\n<li>\n<p><strong>session_id ì»¬ëŸ¼ ê°’=conversation_id=conversation1</strong></p>\n</li>\n</ul>\n</li>\n<li>\n<p>ì•ì—ì„œ ê¸°ì¡´ ì²´ì¸ê³¼ ì´ì „ ëŒ€í™” ê¸°ë¡ ì¡°íšŒí•˜ëŠ” ê²ƒì„ ì—°ê²°í•œ <strong><code class=\"language-text\">chain_with_history</code>ì—ì„œ <code class=\"language-text\">invoke()</code> ë©”ì„œë“œì— ì…ë ¥ë³€ìˆ˜ì™€ configì„ ì „ë‹¬í•˜ì—¬ í˜¸ì¶œ</strong>í•©ë‹ˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">chain_with_history<span class=\"token punctuation\">.</span>invoke<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"question\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"ë‚´ ì´ë¦„ì´ ë­ë¼ê³ ?\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> config<span class=\"token punctuation\">)</span></code></pre></div>\n</li>\n</ol>\n<p>Â </p>\n<p>êµ‰ì¥íˆ ë³µì¡í•˜ê³  ì–´ë ¤ì›Œë³´ì´ì§€ë§Œ<br>ê°“ í…Œë””ë…¸íŠ¸ë‹˜ ê°•ì˜ ë“¤ìœ¼ë‹ˆ ì´í•´í•˜ê¸° ì‰½ë”ë¼ê³ ìš”,, ì¢‹ìŠ´ë‹¤â€¦</p>\n<p>Â </p>\n<p>Â </p>\n<p>ì—¬ê¸°ì„œ ë„ì•.<br>ë‹¤ìŒì€ ë¬¸ì„œ ë¡œë“œí•˜ëŠ” ë°©ë²•ì¸ë°, ê°„ë‹¨íˆ ì •ë¦¬í•˜ê³  ë‹¤ë¥¸ ê²ƒì„ ì“°ê³ ì í•©ë‹ˆë‹¤! See ya.</p>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#lcel%EC%97%90%EC%84%9C-%EB%A9%94%EB%AA%A8%EB%A6%AC-%EC%82%AC%EC%9A%A9%ED%95%98%EB%8A%94-%EB%B0%A9%EB%B2%95\">LCELì—ì„œ ë©”ëª¨ë¦¬ ì‚¬ìš©í•˜ëŠ” ë°©ë²•</a></li>\n<li><a href=\"#sqlite-db%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EB%A9%94%EB%AA%A8%EB%A6%AC-%EC%A0%80%EC%9E%A5-%EB%B0%A9%EB%B2%95\">SQLite DBë¥¼ ì´ìš©í•œ ë©”ëª¨ë¦¬ ì €ì¥ ë°©ë²•</a></li>\n</ul>\n</div>","excerpt":"ì°¸ê³  : í…Œë””ë…¸íŠ¸ì˜ RAG ë¹„ë²•ë…¸íŠ¸ (https://fastcampus.co.kr/data_online_teddy)ì†ŒìŠ¤ì½”ë“œ: https://github.com/teddylee777/langchain-krìœ„í‚¤ë…ìŠ¤: https://wikidocs.net/book/14314 Â  ì´ë²ˆì—ëŠ” â€™LCELì—ì„œ ë©”ëª¨ë¦¬ ì‚¬ìš©í•˜ëŠ” ë°©ë²•â€˜ì„ ê°„ë‹¨íˆ ì •ë¦¬í•˜ê³ ,â€™SQLite DBë¥¼ ì´ìš©í•œ ë©”ëª¨ë¦¬ ì €ì¥í•˜ëŠ” ë°©ë²•â€˜ì„ ì •ë¦¬í•´ë³´ê³ ì í•©ë‹ˆë‹¤. ìƒë‹¹íˆ ë³µì¡í•´ë³´ì—¬ì„œ ì—°ìŠµì´ ì¤‘ìš”í•  ê²ƒ ê°™ìŠµë‹ˆë‹¤. (ì£¼ì˜â€¼ï¸ ë§ˆìŒì˜ ì¤€ë¹„ë¥¼ í•˜ê³ , ì‹¬í˜¸í¡ í•œë²ˆ í¬ê²Œ í•˜ê³  ë“¤ì–´ê°€ì•¼ í•©ë‹ˆë‹¤.) ë ˆì¸ ê¸°ë¦¿~! Â  LCELì—ì„œ ë©”ëª¨ë¦¬ ì‚¬ìš©í•˜ëŠ” ë°©ë²• í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ì—  ë°•ì•„ë‘ê¸°!  ë©”ëª¨ë¦¬ ìƒì„±í•˜ë©´ì„œì˜ ê°’ê³¼ ì— ë“¤ì–´ê°€ëŠ”  ê°’ì„ ë™ì¼í•˜ê²Œ í•˜ê¸° ë©”ëª¨ë¦¬ì—ì„œ ì§€ì •í•œ ëŠ” í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ì—ì„œ ì´ì „ ëŒ€í™” ìë¦¬ì— ë°•ì•„ë‘ëŠ” ë³€ìˆ˜ëª…ê³¼ ê°™ì•„ì•¼ í•¨ ì—ì„œ ì„ ì— ì§€ì •í•œ ì„ ë§Œë“¤ì–´ chainì—ì„œ ì´ìš©í•¨ ëŠ” ì™€ ê°™ì€ ê²ƒì„ ì¦‰,  í‚¤ì˜ ê°’ì— ëŒ€í™”ë“¤ ë¦¬ìŠ¤íŠ¸ë¥¼ ë‹´ì€ ë”•ì…”ë„ˆë¦¬ì¼ ê²ƒì„ ê·¸ë¦¬â€¦","frontmatter":{"date":"December 31, 2025","title":"[LLM] í…Œë””ë…¸íŠ¸ì˜ RAG ë¹„ë²•ë…¸íŠ¸ ë„ì ë„ì -10","categories":"LLM","author":"ë³€ìš°ì¤‘","emoji":"â˜€ï¸"},"fields":{"slug":"/25-12-31_1/"}},"next":{"id":"e502e6d7-98be-5c28-a38e-553cae829030","html":"<p>ì°¸ê³  : í…Œë””ë…¸íŠ¸ì˜ RAG ë¹„ë²•ë…¸íŠ¸ (<a href=\"https://fastcampus.co.kr/data_online_teddy)\">https://fastcampus.co.kr/data_online_teddy)</a><br>ì†ŒìŠ¤ì½”ë“œ: <a href=\"https://github.com/teddylee777/langchain-kr\">https://github.com/teddylee777/langchain-kr</a><br>ìœ„í‚¤ë…ìŠ¤: <a href=\"https://wikidocs.net/book/14314\">https://wikidocs.net/book/14314</a></p>\n<p>Â </p>\n<p>ì˜¤ëŠ˜ì€ ëŒ€í™” ë©”ëª¨ë¦¬ë¥¼ ì €ì¥í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ë„ì ë„ì  í•˜ê³ ì í•˜ëŠ”ë°<br>ëª‡ ê°€ì§€ë§Œ ë‹¤ë£¨ê³ ì í•©ë‹ˆë‹¤.</p>\n<p>Â </p>\n<p>ê·¸ ì „ì—,</p>\n<p>chainì—ì„œ retrieverì— ì»¤ìŠ¤í…€ í•¨ìˆ˜ ì—°ê²°ë„ ê°€ëŠ¥í•˜ë‹¤ëŠ” ì ì–´ë‘ê³  ê°€ê² ìŠµë‹ˆë‹¤.</p>\n<blockquote>\n<h3 id=\"ê¹¨ì•Œ-tip\" style=\"position:relative;\"><a href=\"#%EA%B9%A8%EC%95%8C-tip\" aria-label=\"ê¹¨ì•Œ tip permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ğŸ’¡ê¹¨ì•Œ Tip</h3>\n<p><strong>chainì—ì„œ retrieverì— ì»¤ìŠ¤í…€ í•¨ìˆ˜ ì—°ê²°</strong>ë„ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>\n<p>ì´ë•Œ í•¨ìˆ˜ì— ì „ë‹¬í•˜ëŠ” ì¸ìëŠ” 1ê°œì—¬ì•¼ í•˜ëŠ”ë°,<br>ì¸ìê°€ ì—¬ëŸ¬ ê°œì¼ ë•ŒëŠ” wrapper í•¨ìˆ˜ë¥¼ í†µí•´ ì „ë‹¬ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">format_doc</span><span class=\"token punctuation\">(</span>document_list<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    \nchain <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token comment\"># context: retriever -> format_doc</span>\n    <span class=\"token comment\"># question: RunnablePassthrough() (user_input)</span>\n    <span class=\"token punctuation\">{</span><span class=\"token string\">\"context\"</span><span class=\"token punctuation\">:</span> retriever <span class=\"token operator\">|</span> format_doc<span class=\"token punctuation\">,</span> <span class=\"token string\">\"question\"</span><span class=\"token punctuation\">:</span> RunnablePassthrough<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">|</span> prompt\n    <span class=\"token operator\">|</span> llm\n    <span class=\"token operator\">|</span> StrOutputParser<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p>ì´ëŸ° ì‹ìœ¼ë¡œ <code class=\"language-text\">retriever</code> ê²°ê³¼ë¥¼ ì»¤ìŠ¤í…€ í•¨ìˆ˜ <code class=\"language-text\">format_doc</code>ì— ì—°ê²°í•´ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<p>ì´ë•Œ ì „ë‹¬í•˜ëŠ” ì¸ìëŠ”  <code class=\"language-text\">document_list</code> 1ê°œë§Œ ìˆê¸° ë•Œë¬¸ì— ì—°ê²°ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>\n</blockquote>\n<p>Â </p>\n<p>ê·¸ëŸ¼, ë³¸ê²©ì ìœ¼ë¡œ ë ˆì¸ ê¸°ë¦¿~!</p>\n<p>Â </p>\n<p>Â </p>\n<h2 id=\"conversationkgmemory-ì§€ì‹-ê·¸ë˜í”„-í˜•íƒœ-ê¸°ì–µ\" style=\"position:relative;\"><a href=\"#conversationkgmemory-%EC%A7%80%EC%8B%9D-%EA%B7%B8%EB%9E%98%ED%94%84-%ED%98%95%ED%83%9C-%EA%B8%B0%EC%96%B5\" aria-label=\"conversationkgmemory ì§€ì‹ ê·¸ë˜í”„ í˜•íƒœ ê¸°ì–µ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ConversationKGMemory: ì§€ì‹ ê·¸ë˜í”„ í˜•íƒœ ê¸°ì–µ</h2>\n<hr>\n<p>ìš°ì„  LLMì—ì„œ â€˜ìµœì‹  kê°œì˜ ëŒ€í™”ë¥¼ ê¸°ì–µ, ìµœëŒ€ í† í° ìˆ˜ì— ë”°ë¥¸ ìµœì‹  ëŒ€í™”ë¥¼ ê¸°ì–µ, íŠ¹ì • ì—”í‹°í‹°ë¥¼ ì¶”ì¶œí•˜ì—¬ ëŒ€í™”ë¥¼ ê¸°ì–µ, ì§€ì‹ ê·¸ë˜í”„ í˜•íƒœë¡œ ëŒ€í™”ë¥¼ ê¸°ì–µ, ìš”ì•½í•´ì„œ ëŒ€í™”ë¥¼ ê¸°ì–µ ë“± ëŒ€í™”ë¥¼ ê¸°ì–µí•˜ëŠ” ë°©ë²•â€™ì´ ë§¤ìš° ë‹¤ì–‘í•˜ê²Œ ì¡´ì¬í•©ë‹ˆë‹¤.</p>\n<p>ê·¸ ì¤‘ì— <strong>ì§€ì‹ ê·¸ë˜í”„ í˜•íƒœë¡œ ëŒ€í™”ë¥¼ ê¸°ì–µí•˜ëŠ” ë°©ë²•</strong>ì„ ë³´ê³ ì í•©ë‹ˆë‹¤.</p>\n<p>í˜„ì¬ langchain 1.x ë²„ì „ì´ë©°,<br>ê³§ ì‚¬ë¼ì§ˆ ìˆ˜ ìˆëŠ” ë°©ë²•ì¼ ìˆ˜ ìˆìœ¼ë‹ˆ ì•Œì•„ ë‘ì‹­ì‡¼.</p>\n<p>Â </p>\n<p>âœ… <strong>ë¨¼ì € ì•Œì•„ë‘ì–´ì•¼ í•  ê²ƒ</strong></p>\n<ul>\n<li><strong><code class=\"language-text\">ConversationChain</code> ê°ì²´ëŠ” ëŒ€í™” ì²´ì¸ ê°ì²´ì´ê³ ,</strong></li>\n<li><strong><code class=\"language-text\">ConversationKGMemory</code> ê°ì²´ëŠ” ë©”ëª¨ë¦¬ ë°©ì‹ ê°ì²´ì„</strong></li>\n</ul>\n<p>Â </p>\n<h3 id=\"conversationchain-ê°ì²´-ìƒì„±\" style=\"position:relative;\"><a href=\"#conversationchain-%EA%B0%9D%EC%B2%B4-%EC%83%9D%EC%84%B1\" aria-label=\"conversationchain ê°ì²´ ìƒì„± permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ConversationChain ê°ì²´ ìƒì„±</h3>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> langchain_openai <span class=\"token keyword\">import</span> ChatOpenAI\n<span class=\"token keyword\">from</span> langchain_core<span class=\"token punctuation\">.</span>prompts <span class=\"token keyword\">import</span> PromptTemplate\n<span class=\"token keyword\">from</span> langchain_classic<span class=\"token punctuation\">.</span>chains <span class=\"token keyword\">import</span> ConversationChain\n<span class=\"token keyword\">from</span> langchain_classic<span class=\"token punctuation\">.</span>memory <span class=\"token keyword\">import</span> ConversationKGMemory\n\nllm <span class=\"token operator\">=</span> ChatOpenAI<span class=\"token punctuation\">(</span>temperature<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\ntemplate <span class=\"token operator\">=</span> <span class=\"token triple-quoted-string string\">\"\"\"The following is a friendly conversation between a human and an AI. \nThe AI is talkative and provides lots of specific details from its context. \nIf the AI does not know the answer to a question, it truthfully says it does not know. \nThe AI ONLY uses information contained in the \"Relevant Information\" section and does not hallucinate.\n\nRelevant Information:\n\n{history}\n\nConversation:\nHuman: {input}\nAI:\"\"\"</span>\nprompt <span class=\"token operator\">=</span> PromptTemplate<span class=\"token punctuation\">(</span>\n    input_variables<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"history\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"input\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> template<span class=\"token operator\">=</span>template<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># ConversationChain ê°ì²´ ìƒì„±</span>\n<span class=\"token comment\"># ë©”ëª¨ë¦¬ì— ConversationKGMemory(ChatOpenAIë¥¼ ì´ìš©í•˜ì—¬ ìƒì„±)ë¡œ ì„¤ì •</span>\n<span class=\"token comment\"># ConversationChain ê°ì²´ì˜ llmìœ¼ë¡œ ChatOpenAI ì„¤ì •</span>\nconversation_with_kg <span class=\"token operator\">=</span> ConversationChain<span class=\"token punctuation\">(</span>\n    llm<span class=\"token operator\">=</span>llm<span class=\"token punctuation\">,</span> prompt<span class=\"token operator\">=</span>prompt<span class=\"token punctuation\">,</span> memory<span class=\"token operator\">=</span>ConversationKGMemory<span class=\"token punctuation\">(</span>llm<span class=\"token operator\">=</span>llm<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li>\n<p>ìš°ì„ , <code class=\"language-text\">ConversationChain</code>ê³¼ <code class=\"language-text\">ConversationKGMemory</code> í´ë˜ìŠ¤ëŠ” <code class=\"language-text\">langchain_classic</code>ì— ì¡´ì¬í•©ë‹ˆë‹¤. í˜„ì¬ langchain ë²„ì „ìœ¼ë¡œëŠ” <code class=\"language-text\">langchain_classic</code>ì—ì„œ ê°€ì ¸ì™€ì•¼ í•©ë‹ˆë‹¤.</p>\n</li>\n<li>\n<p><code class=\"language-text\">ConversationChain</code> ê°ì²´ ìƒì„± ì‹œ, LLMê³¼ Promptë¥¼ ì„¤ì •í•˜ë©°, memory ë°©ì‹ì„ <code class=\"language-text\">ConversationKGMemory</code>ìœ¼ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.<br>(ì´ë•Œ ì§€ì‹ ê·¸ë˜í”„ ìƒì„±í•˜ëŠ” <code class=\"language-text\">ConversationKGMemory</code> ê°ì²´ë„ LLMì„ ì„¤ì •í•´ì¤ë‹ˆë‹¤.)</p>\n</li>\n<li>\n<p>â­ï¸ <strong>ì¦‰, <code class=\"language-text\">ConversationChain</code> ê°ì²´ì—ì„œ ë©”ëª¨ë¦¬ ë°©ì‹ì„ ì„¤ì •í•´ì£¼ëŠ” ê²ƒì…ë‹ˆë‹¤.</strong> â­ï¸<br>ë‹¤ë¥¸ ë©”ëª¨ë¦¬ ë°©ì‹ë„ ìœ ì‚¬í•œ ë°©ë²•ìœ¼ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.</p>\n</li>\n</ul>\n<p>Â </p>\n<h3 id=\"ëŒ€í™”í•˜ê¸°\" style=\"position:relative;\"><a href=\"#%EB%8C%80%ED%99%94%ED%95%98%EA%B8%B0\" aria-label=\"ëŒ€í™”í•˜ê¸° permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ëŒ€í™”í•˜ê¸°</h3>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># ì²«ë²ˆì§¸ ëŒ€í™” ì‹œì‘  -> ë©”ëª¨ë¦¬ì— ì§€ì‹ ê·¸ë˜í”„ ìƒì„±ë¨</span>\nconversation_with_kg<span class=\"token punctuation\">.</span>predict<span class=\"token punctuation\">(</span>\n    <span class=\"token builtin\">input</span><span class=\"token operator\">=</span><span class=\"token string\">\"My name is Teddy. Shirley is a coworker of mine, and she's a new designer at our company.\"</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token triple-quoted-string string\">\"\"\"ì¶œë ¥:\n\"Hello Teddy! It's nice to meet you. Shirley must be excited to be starting a new job as a designer at your company. I hope she's settling in well and getting to know everyone. If you need any tips on how to make her feel welcome or help her adjust to the new role, feel free to ask me!\"\n\"\"\"</span></code></pre></div>\n<ul>\n<li><code class=\"language-text\">predict()</code> : ëŒ€í™”ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.\n<ul>\n<li><code class=\"language-text\">input</code>ì— ë”°ë¥¸ ì¶œë ¥ì´ ìƒì„±ë©ë‹ˆë‹¤.</li>\n<li>ì´ë•Œ, <code class=\"language-text\">input</code>ê³¼ ìƒì„±í•œ  <code class=\"language-text\">ì¶œë ¥(output)</code> ëŒ€í™” ìŒì„ ì €ì¥í•˜ê³ , ì§€ì‹ ê·¸ë˜í”„ë¥¼ ìƒì„±í•˜ê²Œ ë©ë‹ˆë‹¤.</li>\n</ul>\n</li>\n</ul>\n<p>Â </p>\n<h3 id=\"ì´ì „-ëŒ€í™”-ë‚´ìš©-ë³´ê¸°\" style=\"position:relative;\"><a href=\"#%EC%9D%B4%EC%A0%84-%EB%8C%80%ED%99%94-%EB%82%B4%EC%9A%A9-%EB%B3%B4%EA%B8%B0\" aria-label=\"ì´ì „ ëŒ€í™” ë‚´ìš© ë³´ê¸° permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ì´ì „ ëŒ€í™” ë‚´ìš© ë³´ê¸°</h3>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># ì´ì „ ëŒ€í™” ë‚´ìš© ë³´ê¸°</span>\nconversation_with_kg<span class=\"token punctuation\">.</span>memory<span class=\"token punctuation\">.</span>chat_memory<span class=\"token punctuation\">.</span>messages\n<span class=\"token triple-quoted-string string\">\"\"\"ì¶œë ¥:\n[HumanMessage(content=\"My name is Teddy. Shirley is a coworker of mine, and she's a new designer at our company.\", additional_kwargs={}, response_metadata={}),\n AIMessage(content=\"Hello Teddy! It's nice to meet you. Shirley must be excited to be starting a new job as a designer at your company. I hope she's settling in well and getting to know everyone. If you need any tips on how to make her feel welcome or help her adjust to the new role, feel free to ask me!\", additional_kwargs={}, response_metadata={})]\n\"\"\"</span></code></pre></div>\n<ul>\n<li><code class=\"language-text\">conversation_with_kg.memory.chat_memory.messages</code><br>: ì´ì „ ëŒ€í™”ë¥¼ ë‹´ì•„ë‘ê³  ìˆìŠµë‹ˆë‹¤.\n<ul>\n<li><code class=\"language-text\">HumanMessage</code>, <code class=\"language-text\">AIMessage</code> ê³¼ ê°™ì´ ë©”ì‹œì§€ ê°ì²´ë¡œ ì €ì¥ë˜ì–´ ìˆìŠµë‹ˆë‹¤.</li>\n</ul>\n</li>\n</ul>\n<p>Â </p>\n<h3 id=\"ì§€ì‹-ê·¸ë˜í”„ì˜-ì •ë³´-í™•ì¸í•˜ê¸°\" style=\"position:relative;\"><a href=\"#%EC%A7%80%EC%8B%9D-%EA%B7%B8%EB%9E%98%ED%94%84%EC%9D%98-%EC%A0%95%EB%B3%B4-%ED%99%95%EC%9D%B8%ED%95%98%EA%B8%B0\" aria-label=\"ì§€ì‹ ê·¸ë˜í”„ì˜ ì •ë³´ í™•ì¸í•˜ê¸° permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ì§€ì‹ ê·¸ë˜í”„ì˜ ì •ë³´ í™•ì¸í•˜ê¸°</h3>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># ì§€ì‹ ê·¸ë˜í”„ ì•ˆì— ì–´ë–¤ ì •ë³´ê°€ ì €ì¥ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>conversation_with_kg<span class=\"token punctuation\">.</span>memory<span class=\"token punctuation\">.</span>kg<span class=\"token punctuation\">.</span>get_triples<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token triple-quoted-string string\">\"\"\"ì¶œë ¥:\n[('Teddy', 'name', 'is'), ('Shirley', 'coworker', 'is a'), ('Shirley', 'new designer', 'is a'), ('Shirley', 'company', 'is at')]\n\"\"\"</span></code></pre></div>\n<ul>\n<li><code class=\"language-text\">conversation_with_kg.memory.kg.get_triples()</code><br>:<code class=\"language-text\">Triple</code>ì„ ì¶œë ¥í•˜ì—¬ ì§€ì‹ ê·¸ë˜í”„ ì•ˆì— ì–´ë–¤ ì •ë³´ê°€ ì €ì¥ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>\n<li><code class=\"language-text\">Triple</code> ìš”ì†Œ: ë…¸ë“œ(ì •ë³´ ëŒ€ìƒ), ì—£ì§€(ê´€ê³„), ë°©í–¥ ì¡´ì¬</li>\n<li><code class=\"language-text\">Triple</code> êµ¬ì¡°: <strong>ì£¼ì–´(ê´€ê³„ ì‹œì‘ì )-ë™ì‚¬(ê´€ê³„, í™”ì‚´í‘œ)-ëª©ì ì–´(ê´€ê³„ ë„ì°©ì ) í˜•íƒœ</strong></li>\n</ul>\n<p>Â </p>\n<p>ì•„ë˜ì™€ ê°™ì´ <strong>ê·¸ë˜í”„ ê°ì²´ë¥¼ ì ‘ê·¼í•˜ì—¬ ëª¨ë“  ë…¸ë“œ, ì—£ì§€ë¥¼ í™•ì¸í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.</strong><br>(<code class=\"language-text\">memory.kg._graph()</code>ì˜ <code class=\"language-text\">nodes()</code>, <code class=\"language-text\">edges(data=True)</code> ì´ìš©)</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># ë‚´ë¶€ì˜ ì‹¤ì œ networkx ê·¸ë˜í”„ ê°ì²´ ì ‘ê·¼</span>\ninfo_graph <span class=\"token operator\">=</span> conversation_with_kg<span class=\"token punctuation\">.</span>memory<span class=\"token punctuation\">.</span>kg<span class=\"token punctuation\">.</span>_graph \n\n<span class=\"token comment\"># ëª¨ë“  ë…¸ë“œ(ê°œì²´) ë³´ê¸°</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Nodes:\"</span><span class=\"token punctuation\">,</span> info_graph<span class=\"token punctuation\">.</span>nodes<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># ëª¨ë“  ì—£ì§€(ê´€ê³„) ë³´ê¸°</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Edges:\"</span><span class=\"token punctuation\">,</span> info_graph<span class=\"token punctuation\">.</span>edges<span class=\"token punctuation\">(</span>data<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token triple-quoted-string string\">\"\"\"ì¶œë ¥:\nNodes: ['Teddy', 'name', 'Shirley', 'coworker', 'new designer', 'company']\nEdges: [('Teddy', 'name', {'relation': 'is'}), ('Shirley', 'coworker', {'relation': 'is a'}), ('Shirley', 'new designer', {'relation': 'is a'}), ('Shirley', 'company', {'relation': 'is at'})]\n\"\"\"</span></code></pre></div>\n<p>Â </p>\n<p>ì•„ë˜ì™€ ê°™ì´ ê·¸ë˜í”„ë¥¼ ì§ì ‘ ë‚˜íƒ€ë‚´ì–´ë³´ë©´</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> networkx <span class=\"token keyword\">as</span> nx\n<span class=\"token keyword\">import</span> matplotlib<span class=\"token punctuation\">.</span>pyplot <span class=\"token keyword\">as</span> plt\n\n<span class=\"token comment\"># ë‚´ë¶€ ê·¸ë˜í”„ ê°ì²´ ê°€ì ¸ì˜¤ê¸°</span>\ngraph <span class=\"token operator\">=</span> conversation_with_kg<span class=\"token punctuation\">.</span>memory<span class=\"token punctuation\">.</span>kg<span class=\"token punctuation\">.</span>_graph\n\n<span class=\"token comment\"># ê·¸ë˜í”„ ê·¸ë¦¬ê¸° ì„¤ì •</span>\nplt<span class=\"token punctuation\">.</span>figure<span class=\"token punctuation\">(</span>figsize<span class=\"token operator\">=</span><span class=\"token punctuation\">(</span><span class=\"token number\">8</span><span class=\"token punctuation\">,</span> <span class=\"token number\">6</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\npos <span class=\"token operator\">=</span> nx<span class=\"token punctuation\">.</span>spring_layout<span class=\"token punctuation\">(</span>graph<span class=\"token punctuation\">)</span>  <span class=\"token comment\"># ë…¸ë“œ ìœ„ì¹˜ ê²°ì • ì•Œê³ ë¦¬ì¦˜</span>\n\n<span class=\"token comment\"># ë…¸ë“œì™€ ì—£ì§€ ê·¸ë¦¬ê¸°</span>\nnx<span class=\"token punctuation\">.</span>draw<span class=\"token punctuation\">(</span>graph<span class=\"token punctuation\">,</span> pos<span class=\"token punctuation\">,</span> with_labels<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span> node_color<span class=\"token operator\">=</span><span class=\"token string\">'lightblue'</span><span class=\"token punctuation\">,</span> \n        node_size<span class=\"token operator\">=</span><span class=\"token number\">2000</span><span class=\"token punctuation\">,</span> font_size<span class=\"token operator\">=</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> font_weight<span class=\"token operator\">=</span><span class=\"token string\">'bold'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># ì—£ì§€ ë¼ë²¨(ê´€ê³„ ëª…ì¹­) ê·¸ë¦¬ê¸°</span>\nedge_labels <span class=\"token operator\">=</span> nx<span class=\"token punctuation\">.</span>get_edge_attributes<span class=\"token punctuation\">(</span>graph<span class=\"token punctuation\">,</span> <span class=\"token string\">'relation'</span><span class=\"token punctuation\">)</span>\nnx<span class=\"token punctuation\">.</span>draw_networkx_edge_labels<span class=\"token punctuation\">(</span>graph<span class=\"token punctuation\">,</span> pos<span class=\"token punctuation\">,</span> edge_labels<span class=\"token operator\">=</span>edge_labels<span class=\"token punctuation\">)</span>\n\nplt<span class=\"token punctuation\">.</span>show<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 75.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAA9hAAAPYQGoP6dpAAABOUlEQVQ4y41U30vDMBDO//+P+OSDsCdhAwUVFfHXXJlYrHQPK7I51zZNG5tPEpu2i9dsgRB6d/n63d13YdizlFI754qXWOWitVm7Xcx19AP6Nms9vnnG6GHuAVQKdbP7QdQPeJ5jvc2QV9LPsM+o2x1YXdfIsgxSyn/s3WUAr8MFnuKErJ0GS9O0BXPZkwzHs3eczUKUBQfnhQFpbhhm9tsHRKasL3LOUZUCkyDC+evHH8CBYAZQNQ1xg27DGNNFcjAzUjY2WNerlhWpQ18d9cmoSzptDWo7PcSM0iyj2OlGDLFzWWlNGl02Nma7aQNKIUiJDAGe3M8xDqK2qazv/MoLfG625MQMAW6ExOk0xMVb3KVsx+ro8hGjuxeoH+mdhlZmjT9I1riKlrs1tC/Jd1HulcjQrOvS/QLP+p3ru+kpDgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"kg ex\" title=\"kg ex\" src=\"/static/9abbf3b1e554e66171bd7afe2d28b53d/37523/kg_ex.png\" srcset=\"/static/9abbf3b1e554e66171bd7afe2d28b53d/e9ff0/kg_ex.png 180w,\n/static/9abbf3b1e554e66171bd7afe2d28b53d/f21e7/kg_ex.png 360w,\n/static/9abbf3b1e554e66171bd7afe2d28b53d/37523/kg_ex.png 720w,\n/static/9abbf3b1e554e66171bd7afe2d28b53d/97655/kg_ex.png 819w\" sizes=\"(max-width: 720px) 100vw, 720px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n<p>ìš”ë ‡ê²Œ ë‚˜ì˜µë‹ˆë‹¤.</p>\n<p>ì´ëŸ° ì‹ìœ¼ë¡œ ì‹œê°í™”í•¨ìœ¼ë¡œì¨ ì´ì „ ëŒ€í™”ì—ì„œ ì–´ë–»ê²Œ ì§€ì‹ ê·¸ë˜í”„ë¥¼ ìƒì„±í•´ë†“ê³  ìˆëŠ”ì§€ í™•ì¸ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>\n<p>Â </p>\n<h3 id=\"conversationkgmemory-ëŒ€í™”-ì €ì¥\" style=\"position:relative;\"><a href=\"#conversationkgmemory-%EB%8C%80%ED%99%94-%EC%A0%80%EC%9E%A5\" aria-label=\"conversationkgmemory ëŒ€í™” ì €ì¥ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ConversationKGMemory ëŒ€í™” ì €ì¥</h3>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">ConversationKGMemory<span class=\"token punctuation\">.</span>save_context<span class=\"token punctuation\">(</span>\n    inputs<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"human\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"íŒ¨í‚¤ì§€ ì˜ˆì•½ ì‹œ ì˜ˆì•½ê¸ˆì€ ì–¼ë§ˆì¸ê°€ìš”? ì·¨ì†Œ ì •ì±…ì€ ì–´ë–»ê²Œ ë˜ë‚˜ìš”?\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    outputs<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>\n        <span class=\"token string\">\"ai\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"íŒ¨í‚¤ì§€ ì˜ˆì•½ ì‹œ 500ìœ ë¡œì˜ ì˜ˆì•½ê¸ˆì´ í•„ìš”í•©ë‹ˆë‹¤. ì·¨ì†Œ ì •ì±…ì€ ì˜ˆì•½ì¼ë¡œë¶€í„° 30ì¼ ì „ê¹Œì§€ëŠ” ì „ì•¡ í™˜ë¶ˆì´ ê°€ëŠ¥í•˜ë©°, ì´í›„ ì·¨ì†Œ ì‹œì—ëŠ” ì˜ˆì•½ê¸ˆì´ í™˜ë¶ˆë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì—¬í–‰ ì‹œì‘ì¼ë¡œë¶€í„° 14ì¼ ì „ ì·¨ì†Œ ì‹œ 50%ì˜ ë¹„ìš©ì´ ì²­êµ¬ë˜ë©°, ê·¸ ì´í›„ëŠ” ì „ì•¡ ë¹„ìš©ì´ ì²­êµ¬ë©ë‹ˆë‹¤.\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li><code class=\"language-text\">ConversationKGMemory.save_context()</code><br>: <code class=\"language-text\">inputs</code>, <code class=\"language-text\">outputs</code> íŒŒë¼ë¯¸í„°ì— ëŒ€í™”ìŒì„ ì „ë‹¬í•˜ì—¬ ëŒ€í™”ë¥¼ ì €ì¥í•©ë‹ˆë‹¤</li>\n</ul>\n<p>Â </p>\n<p>Â </p>\n<h2 id=\"conversationsummarybuffermemory-ìµœê·¼-ëŒ€í™”--ì´ì „-ëŒ€í™”-ìš”ì•½\" style=\"position:relative;\"><a href=\"#conversationsummarybuffermemory-%EC%B5%9C%EA%B7%BC-%EB%8C%80%ED%99%94--%EC%9D%B4%EC%A0%84-%EB%8C%80%ED%99%94-%EC%9A%94%EC%95%BD\" aria-label=\"conversationsummarybuffermemory ìµœê·¼ ëŒ€í™”  ì´ì „ ëŒ€í™” ìš”ì•½ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ConversationSummaryBufferMemory: ìµœê·¼ ëŒ€í™” + ì´ì „ ëŒ€í™” ìš”ì•½</h2>\n<hr>\n<p><strong><code class=\"language-text\">ConversationSummaryBufferMemory</code>ëŠ” ìµœê·¼ ëŒ€í™”ëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€í•˜ë©´ì„œ ì´ì „ ëŒ€í™”ëŠ” ìš”ì•½í•˜ì—¬ ë©”ëª¨ë¦¬ì— ì €ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</strong></p>\n<p>ì–´ë–»ê²Œ ë³´ë©´ ê°€ì¥ ìœ ìš©í•œ ë°©ì‹ì´ì§€ ì•Šì„ê¹Œ ìƒê°í•©ë‹ˆë‹¤.</p>\n<p><code class=\"language-text\">ConversationSummaryMemory</code>ëŠ” ì´ì „ ëŒ€í™”ë¥¼ ëª¨ë‘ ìš”ì•½í•˜ì§€ë§Œ,<br><code class=\"language-text\">ConversationSummaryBufferMemory</code>ëŠ” <code class=\"language-text\">max_token_limit</code>ì„ ì„¤ì •í•¨ìœ¼ë¡œì¨ ìµœì‹  ëŒ€í™”ëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> langchain_openai <span class=\"token keyword\">import</span> ChatOpenAI\n<span class=\"token keyword\">from</span> langchain_classic<span class=\"token punctuation\">.</span>memory <span class=\"token keyword\">import</span> ConversationSummaryBufferMemory\n\nllm <span class=\"token operator\">=</span> ChatOpenAI<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\nmemory <span class=\"token operator\">=</span> ConversationSummaryBufferMemory<span class=\"token punctuation\">(</span>\n    llm<span class=\"token operator\">=</span>llm<span class=\"token punctuation\">,</span>\n    max_token_limit<span class=\"token operator\">=</span><span class=\"token number\">200</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># 200 í† í°ê¹Œì§€ëŠ” ìµœê·¼ ëŒ€í™” ìœ ì§€í•˜ê³ , ë‚˜ë¨¸ì§€ëŠ” ìš”ì•½</span>\n    return_messages<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p>ì´ë ‡ê²Œ ìµœëŒ€ n í† í°ê¹Œì§€ ìµœì‹  ëŒ€í™”ë“¤ì„ ê·¸ëŒ€ë¡œ ìœ ì§€í•˜ë©°<br>ê·¸ ë„˜ì–´ê°€ëŠ” ì´ì „ ëŒ€í™”ëŠ” ëª¨ë‘ ìš”ì•½í•œ ìƒíƒœë¡œ ë©”ëª¨ë¦¬ë¥¼ ì €ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">memory<span class=\"token punctuation\">.</span>save_context<span class=\"token punctuation\">(</span>\n    inputs<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"human\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"ì—¬í–‰ ì¤‘ì— ë°©ë¬¸í•  ì£¼ìš” ê´€ê´‘ì§€ëŠ” ì–´ë””ì¸ê°€ìš”?\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    outputs<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>\n        <span class=\"token string\">\"ai\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"ì´ ì—¬í–‰ì—ì„œëŠ” íŒŒë¦¬ì˜ ì—í íƒ‘, ë¡œë§ˆì˜ ì½œë¡œì„¸ì›€, ë² ë¥¼ë¦°ì˜ ë¸Œë€ë´ë¶€ë¥´í¬ ë¬¸, ì·¨ë¦¬íˆì˜ ë¼ì´ë„¤í´ ë“± ìœ ëŸ½ì˜ ìœ ëª…í•œ ê´€ê´‘ì§€ë“¤ì„ ë°©ë¬¸í•©ë‹ˆë‹¤. ê° ë„ì‹œì˜ ëŒ€í‘œì ì¸ ëª…ì†Œë“¤ì„ í¬ê´„ì ìœ¼ë¡œ ê²½í—˜í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p>ì´ë ‡ê²Œ <strong><code class=\"language-text\">save_context()</code> ë©”ì„œë“œë¥¼ í†µí•´ ëŒ€í™”ë¥¼ ì €ì¥í•´ë„ ë˜ê³ </strong><br><strong><code class=\"language-text\">predict()</code> ë©”ì„œë“œë¥¼ í†µí•´ ëŒ€í™”ë¥¼ ì§ì ‘ í•˜ë©° ë©”ëª¨ë¦¬ì— ì €ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</strong></p>\n<p><strong>ê·¸ë ‡ê²Œ ëª‡ ê°œì˜ ëŒ€í™”ë¥¼ ì €ì¥í•œ í›„ì—,<br> <code class=\"language-text\">load_memory_variables({})[\"history\"]</code>ë¥¼ í†µí•´ ë©”ëª¨ë¦¬ë¥¼ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤.</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># ë©”ëª¨ë¦¬ì— ì €ì¥ëœ ëŒ€í™”ë‚´ìš© í™•ì¸</span>\n<span class=\"token comment\"># 200í† í°ì´ ë„˜ì–´ ì˜ˆì „ ëŒ€í™”ëŠ” ìš”ì•½ë˜ì–´ ìˆê³ , ìµœê·¼ëŒ€í™”ëŠ” ì›ë³¸ ê·¸ëŒ€ë¡œ ê°€ì§€ê³  ìˆìŒ</span>\nmemory<span class=\"token punctuation\">.</span>load_memory_variables<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"history\"</span><span class=\"token punctuation\">]</span>\n<span class=\"token triple-quoted-string string\">\"\"\"\nì¶œë ¥:\n[SystemMessage(content=\"The human asks the AI about the price of a European travel package. The AI responds with the details of the package and optional costs, including traveler's insurance. The human then asks if they can upgrade to business class seats and the cost associated with it. The AI confirms that upgrading to business class is possible for an additional cost of around 1,200 euros round trip, offering benefits such as wider seats, premium in-flight meals, and additional luggage allowance.\", additional_kwargs={}, response_metadata={}),\n HumanMessage(content='íŒ¨í‚¤ì§€ì— í¬í•¨ëœ í˜¸í…”ì˜ ë“±ê¸‰ì€ ì–´ë–»ê²Œ ë˜ë‚˜ìš”?', additional_kwargs={}, response_metadata={}),\n AIMessage(content='ì´ íŒ¨í‚¤ì§€ì—ëŠ” 4ì„±ê¸‰ í˜¸í…” ìˆ™ë°•ì´ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ê° í˜¸í…”ì€ í¸ì•ˆí•¨ê³¼ í¸ì˜ì„±ì„ ì œê³µí•˜ë©°, ì¤‘ì‹¬ì§€ì— ìœ„ì¹˜í•´ ê´€ê´‘ì§€ì™€ì˜ ì ‘ê·¼ì„±ì´ ì¢‹ìŠµë‹ˆë‹¤. ëª¨ë“  í˜¸í…”ì€ ìš°ìˆ˜í•œ ì„œë¹„ìŠ¤ì™€ í¸ì˜ ì‹œì„¤ì„ ê°–ì¶”ê³  ìˆìŠµë‹ˆë‹¤.', additional_kwargs={}, response_metadata={})]\n\"\"\"</span></code></pre></div>\n<p>ì´ì™€ ê°™ì´<br><strong>ì´ì „ ëŒ€í™”ë“¤ì€ ìš”ì•½ëœ ìƒíƒœì—ì„œ <code class=\"language-text\">SystemMessage</code>ì˜  <code class=\"language-text\">content</code>ì— ë‹´ê²¨ ìˆê³ ,<br>ìµœì‹  ëŒ€í™”ë“¤ì€ <code class=\"language-text\">HumanMessage</code>ì™€ <code class=\"language-text\">AIMessage</code>ì˜ <code class=\"language-text\">content</code>ì— ë‹´ê²¨ìˆìŒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</strong></p>\n<p>Â </p>\n<p>Â </p>\n<h2 id=\"vectorstoreretrievermemory-ìœ ì‚¬ì„±-ìˆëŠ”-ëŒ€í™”ì—-ì ‘ê·¼\" style=\"position:relative;\"><a href=\"#vectorstoreretrievermemory-%EC%9C%A0%EC%82%AC%EC%84%B1-%EC%9E%88%EB%8A%94-%EB%8C%80%ED%99%94%EC%97%90-%EC%A0%91%EA%B7%BC\" aria-label=\"vectorstoreretrievermemory ìœ ì‚¬ì„± ìˆëŠ” ëŒ€í™”ì— ì ‘ê·¼ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>VectorStoreRetrieverMemory: ìœ ì‚¬ì„± ìˆëŠ” ëŒ€í™”ì— ì ‘ê·¼</h2>\n<hr>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> faiss\n<span class=\"token keyword\">from</span> langchain_openai <span class=\"token keyword\">import</span> OpenAIEmbeddings\n<span class=\"token keyword\">from</span> langchain_classic<span class=\"token punctuation\">.</span>docstore <span class=\"token keyword\">import</span> InMemoryDocstore\n<span class=\"token keyword\">from</span> langchain_classic<span class=\"token punctuation\">.</span>vectorstores <span class=\"token keyword\">import</span> FAISS\n<span class=\"token keyword\">from</span> langchain_classic<span class=\"token punctuation\">.</span>memory <span class=\"token keyword\">import</span> VectorStoreRetrieverMemory\n\n\n<span class=\"token comment\"># ì„ë² ë”© ëª¨ë¸ ì •ì˜</span>\nembeddings_model <span class=\"token operator\">=</span> OpenAIEmbeddings<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># Vector Store ì´ˆê¸°í™”</span>\nembedding_size <span class=\"token operator\">=</span> <span class=\"token number\">1536</span>\nindex <span class=\"token operator\">=</span> faiss<span class=\"token punctuation\">.</span>IndexFlatL2<span class=\"token punctuation\">(</span>embedding_size<span class=\"token punctuation\">)</span>  <span class=\"token comment\"># FAISS ì¸ë±ìŠ¤ë¥¼ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.</span>\nvectorstore <span class=\"token operator\">=</span> FAISS<span class=\"token punctuation\">(</span>embeddings_model<span class=\"token punctuation\">,</span> index<span class=\"token punctuation\">,</span> InMemoryDocstore<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># Vector Storeë¥¼ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.</span>\n\nretriever <span class=\"token operator\">=</span> vectorstore<span class=\"token punctuation\">.</span>as_retriever<span class=\"token punctuation\">(</span>search_kwargs<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"k\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># k=1ì€ ê°€ì¥ ê´€ë ¨ì„± ìˆëŠ” ë¬¸ì„œë§Œ ë°˜í™˜</span>\nmemory <span class=\"token operator\">=</span> VectorStoreRetrieverMemory<span class=\"token punctuation\">(</span>retriever<span class=\"token operator\">=</span>retriever<span class=\"token punctuation\">)</span>      <span class=\"token comment\"># retrieverë¥¼ ì‚¬ìš©í•˜ì—¬ ë©”ëª¨ë¦¬ ìƒì„±</span>\n\n\nmemory<span class=\"token punctuation\">.</span>save_context<span class=\"token punctuation\">(</span>\n    inputs<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>\n        <span class=\"token string\">\"human\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"ì•ˆë…•í•˜ì„¸ìš”, ì˜¤ëŠ˜ ë©´ì ‘ì— ì°¸ì„í•´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤. ìê¸°ì†Œê°œ ë¶€íƒë“œë¦½ë‹ˆë‹¤.\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    outputs<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>\n        <span class=\"token string\">\"ai\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"ì•ˆë…•í•˜ì„¸ìš”. ì €ëŠ” ì»´í“¨í„° ê³¼í•™ì„ ì „ê³µí•œ ì‹ ì… ê°œë°œìì…ë‹ˆë‹¤. ëŒ€í•™ì—ì„œëŠ” ì£¼ë¡œ ìë°”ì™€ íŒŒì´ì¬ì„ ì‚¬ìš©í–ˆìœ¼ë©°, ìµœê·¼ì—ëŠ” ì›¹ ê°œë°œ í”„ë¡œì íŠ¸ì— ì°¸ì—¬í•˜ì—¬ ì‹¤ì œ ì‚¬ìš©ìë¥¼ ìœ„í•œ ì„œë¹„ìŠ¤ë¥¼ ê°œë°œí•˜ëŠ” ê²½í—˜ì„ í–ˆìŠµë‹ˆë‹¤.\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p>ì´ë ‡ê²Œ <strong>ì„ë² ë”© ëª¨ë¸ì„ ìƒì„±</strong>í•˜ê³  <strong>FAISS ì¸ë±ìŠ¤ë¥¼ ì´ˆê¸°í™”</strong>í•œ í›„ì—<br><strong><code class=\"language-text\">langchain_classic</code>ì˜ <code class=\"language-text\">docstore</code>ì—ì„œ <code class=\"language-text\">InMemoryDocstore</code> ëª¨ë“ˆ(ë¬¸ì„œë¥¼ ë©”ëª¨ë¦¬ì— ì €ì¥í•˜ëŠ” ì €ì¥ì†Œ)ì„ ì´ìš©í•´ <code class=\"language-text\">vectorstore</code>ë¥¼ ì´ˆê¸°í™”</strong>í•©ë‹ˆë‹¤.</p>\n<p><strong><code class=\"language-text\">vectorstore</code>ì˜ <code class=\"language-text\">as_retriever</code> ë©”ì„œë“œë¥¼ ì´ìš©í•´ ë¦¬íŠ¸ë¦¬ë²„ë¥¼ ìƒì„±</strong>í•˜ê³ <br><strong><code class=\"language-text\">VectorStoreRetrieverMemory</code>ì— í•´ë‹¹ ë¦¬íŠ¸ë¦¬ë²„ë¥¼ ì„¤ì •í•´ì£¼ì–´ ë©”ëª¨ë¦¬ë¥¼ ìƒì„±</strong>í•©ë‹ˆë‹¤.</p>\n<p><strong>ëŒ€í™”ë¥¼ ì €ì¥í•œ í›„ì—, <code class=\"language-text\">load_memory_variables()</code> ë©”ì„œë“œì— <code class=\"language-text\">{role ë¶€ë¶„: ì§ˆë¬¸}</code>ë¥¼ ì „ë‹¬í•˜ê³  <code class=\"language-text\">[\"history\"]</code> ê°’ì„ êº¼ë‚´ë©´ ì´ì „ ëŒ€í™”ë“¤ì˜ ê°€ì¥ ìœ ì‚¬í•œ ëŒ€í™”ë¥¼ ì¶œë ¥í•˜ê²Œ ë©ë‹ˆë‹¤.</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>\n    memory<span class=\"token punctuation\">.</span>load_memory_variables<span class=\"token punctuation\">(</span>\n        <span class=\"token punctuation\">{</span><span class=\"token string\">\"human\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"ë©´ì ‘ìê°€ í”„ë¡œì íŠ¸ì—ì„œ ë§¡ì€ ì—­í• ì€ ë¬´ì—‡ì¸ê°€ìš”?\"</span><span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"history\"</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">)</span>\n<span class=\"token triple-quoted-string string\">\"\"\"ì¶œë ¥:\nhuman: í”„ë¡œì íŠ¸ì—ì„œ ì–´ë–¤ ì—­í• ì„ ë§¡ì•˜ë‚˜ìš”?\nai: ì œê°€ ë§¡ì€ ì—­í• ì€ ë°±ì—”ë“œ ê°œë°œìì˜€ìŠµë‹ˆë‹¤. ì‚¬ìš©ì ë°ì´í„° ì²˜ë¦¬ì™€ ì„œë²„ ë¡œì§ ê°œë°œì„ ë‹´ë‹¹í–ˆìœ¼ë©°, RESTful APIë¥¼ êµ¬í˜„í•˜ì—¬ í”„ë¡ íŠ¸ì—”ë“œì™€ì˜ í†µì‹ ì„ ë‹´ë‹¹í–ˆìŠµë‹ˆë‹¤. ë˜í•œ, ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„ì—ë„ ì°¸ì—¬í–ˆìŠµë‹ˆë‹¤.\n\"\"\"</span></code></pre></div>\n<p>Â </p>\n<p>ì¢€ ë³µì¡í•˜ì§€ë§Œ ì•„ë˜ì˜ ë‹¨ê³„ë¥¼ ê¸°ì–µí•©ì‹œë‹¤.</p>\n<ol>\n<li>ì„ë² ë”© ëª¨ë¸ ìƒì„±</li>\n<li>FAISS ì¸ë±ìŠ¤ ì´ˆê¸°í™”</li>\n<li>ì„ë² ë”© ëª¨ë¸, ì¸ë±ìŠ¤, ë©”ëª¨ë¦¬ ë°©ì‹, ë¬¸ì„œ ì €ì¥ì†Œë¥¼ ì´ìš©í•´ <code class=\"language-text\">vectorstore</code> ì´ˆê¸°í™”</li>\n<li><code class=\"language-text\">vectorstore</code>ì˜ ë¦¬íŠ¸ë¦¬ë²„ ìƒì„±</li>\n<li>ë¦¬íŠ¸ë¦¬ë²„ ì´ìš©í•´ <code class=\"language-text\">VectorStoreRetrieverMemory</code> ë©”ëª¨ë¦¬ ìƒì„±</li>\n<li>ë©”ëª¨ë¦¬ì— ëŒ€í™” ì €ì¥(ëŒ€í™” ì‹œì‘)</li>\n<li>ë©”ëª¨ë¦¬ì˜ <code class=\"language-text\">load_memory_variables()</code> ë©”ì„œë“œì—ì„œ ìœ ì‚¬í•œ ëŒ€í™”ë¥¼ ì°¾ê¸° ìœ„í•œ ì§ˆë¬¸ì„ ë„£ì–´ í˜¸ì¶œ (<code class=\"language-text\">history</code> ê°’ í™•ì¸)</li>\n</ol>\n<p>Â </p>\n<p>Â </p>\n<p>ì´ì™¸ì—ë„ ë§ì€ ë©”ëª¨ë¦¬ ì €ì¥í•˜ëŠ” ë°©ì‹ì€ ë§ì€ë°<br>ê¸°íšŒê°€ ë  ë•Œ ì¶”ê°€ë¡œ ì •ë¦¬í•´ë³´ê² ìŠµë‹ˆë‹¤.</p>\n<p>ë„ì•.</p>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#conversationkgmemory-%EC%A7%80%EC%8B%9D-%EA%B7%B8%EB%9E%98%ED%94%84-%ED%98%95%ED%83%9C-%EA%B8%B0%EC%96%B5\">ConversationKGMemory: ì§€ì‹ ê·¸ë˜í”„ í˜•íƒœ ê¸°ì–µ</a></p>\n<ul>\n<li><a href=\"#conversationchain-%EA%B0%9D%EC%B2%B4-%EC%83%9D%EC%84%B1\">ConversationChain ê°ì²´ ìƒì„±</a></li>\n<li><a href=\"#%EB%8C%80%ED%99%94%ED%95%98%EA%B8%B0\">ëŒ€í™”í•˜ê¸°</a></li>\n<li><a href=\"#%EC%9D%B4%EC%A0%84-%EB%8C%80%ED%99%94-%EB%82%B4%EC%9A%A9-%EB%B3%B4%EA%B8%B0\">ì´ì „ ëŒ€í™” ë‚´ìš© ë³´ê¸°</a></li>\n<li><a href=\"#%EC%A7%80%EC%8B%9D-%EA%B7%B8%EB%9E%98%ED%94%84%EC%9D%98-%EC%A0%95%EB%B3%B4-%ED%99%95%EC%9D%B8%ED%95%98%EA%B8%B0\">ì§€ì‹ ê·¸ë˜í”„ì˜ ì •ë³´ í™•ì¸í•˜ê¸°</a></li>\n<li><a href=\"#conversationkgmemory-%EB%8C%80%ED%99%94-%EC%A0%80%EC%9E%A5\">ConversationKGMemory ëŒ€í™” ì €ì¥</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#conversationsummarybuffermemory-%EC%B5%9C%EA%B7%BC-%EB%8C%80%ED%99%94--%EC%9D%B4%EC%A0%84-%EB%8C%80%ED%99%94-%EC%9A%94%EC%95%BD\">ConversationSummaryBufferMemory: ìµœê·¼ ëŒ€í™” + ì´ì „ ëŒ€í™” ìš”ì•½</a></p>\n</li>\n<li>\n<p><a href=\"#vectorstoreretrievermemory-%EC%9C%A0%EC%82%AC%EC%84%B1-%EC%9E%88%EB%8A%94-%EB%8C%80%ED%99%94%EC%97%90-%EC%A0%91%EA%B7%BC\">VectorStoreRetrieverMemory: ìœ ì‚¬ì„± ìˆëŠ” ëŒ€í™”ì— ì ‘ê·¼</a></p>\n</li>\n</ul>\n</div>","frontmatter":{"date":"December 30, 2025","title":"[LLM] í…Œë””ë…¸íŠ¸ì˜ RAG ë¹„ë²•ë…¸íŠ¸ ë„ì ë„ì -9","categories":"LLM RAG","author":"ë³€ìš°ì¤‘","emoji":"â˜€ï¸"},"fields":{"slug":"/25-12-30_1/"}},"prev":{"id":"69725161-4cf6-5273-b75f-c77780d8edb4","html":"<p>ì°¸ê³  : í…Œë””ë…¸íŠ¸ì˜ RAG ë¹„ë²•ë…¸íŠ¸ (<a href=\"https://fastcampus.co.kr/data_online_teddy)\">https://fastcampus.co.kr/data_online_teddy)</a><br>ì†ŒìŠ¤ì½”ë“œ: <a href=\"https://github.com/teddylee777/langchain-kr\">https://github.com/teddylee777/langchain-kr</a><br>ìœ„í‚¤ë…ìŠ¤: <a href=\"https://wikidocs.net/book/14314\">https://wikidocs.net/book/14314</a></p>\n<p>Â </p>\n<p>ì´ë²ˆì—ëŠ” â€™<strong>LCELì—ì„œ ë©”ëª¨ë¦¬ ì‚¬ìš©í•˜ëŠ” ë°©ë²•</strong>â€˜ì„ ê°„ë‹¨íˆ ì •ë¦¬í•˜ê³ ,<br>â€™<strong>SQLite DBë¥¼ ì´ìš©í•œ ë©”ëª¨ë¦¬ ì €ì¥í•˜ëŠ” ë°©ë²•</strong>â€˜ì„ ì •ë¦¬í•´ë³´ê³ ì í•©ë‹ˆë‹¤.</p>\n<p>ìƒë‹¹íˆ ë³µì¡í•´ë³´ì—¬ì„œ ì—°ìŠµì´ ì¤‘ìš”í•  ê²ƒ ê°™ìŠµë‹ˆë‹¤.</p>\n<p>(<strong>ì£¼ì˜â€¼ï¸ ë§ˆìŒì˜ ì¤€ë¹„ë¥¼ í•˜ê³ , ì‹¬í˜¸í¡ í•œë²ˆ í¬ê²Œ í•˜ê³  ë“¤ì–´ê°€ì•¼ í•©ë‹ˆë‹¤.</strong>)</p>\n<p>ë ˆì¸ ê¸°ë¦¿~!</p>\n<p>Â </p>\n<h2 id=\"lcelì—ì„œ-ë©”ëª¨ë¦¬-ì‚¬ìš©í•˜ëŠ”-ë°©ë²•\" style=\"position:relative;\"><a href=\"#lcel%EC%97%90%EC%84%9C-%EB%A9%94%EB%AA%A8%EB%A6%AC-%EC%82%AC%EC%9A%A9%ED%95%98%EB%8A%94-%EB%B0%A9%EB%B2%95\" aria-label=\"lcelì—ì„œ ë©”ëª¨ë¦¬ ì‚¬ìš©í•˜ëŠ” ë°©ë²• permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>LCELì—ì„œ ë©”ëª¨ë¦¬ ì‚¬ìš©í•˜ëŠ” ë°©ë²•</h2>\n<hr>\n<ol>\n<li>\n<p><strong>í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ì— <code class=\"language-text\">MessagesPlaceholder(variable_name=\"chat_history\")</code> ë°•ì•„ë‘ê¸°</strong>!</p>\n</li>\n<li>\n<p><strong><code class=\"language-text\">memory = ConversationBufferMemory(return_messages=True, memory_key=\"chat_history\")</code> ë©”ëª¨ë¦¬ ìƒì„±í•˜ë©´ì„œ<br><code class=\"language-text\">memory_key</code>ì˜ ê°’ê³¼ <code class=\"language-text\">MessagesPlaceholder</code>ì— ë“¤ì–´ê°€ëŠ” <code class=\"language-text\">variable_name</code> ê°’ì„ ë™ì¼í•˜ê²Œ í•˜ê¸°</strong></p>\n<ul>\n<li><strong>ë©”ëª¨ë¦¬ì—ì„œ ì§€ì •í•œ <code class=\"language-text\">memory_key</code>ëŠ” í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ì—ì„œ ì´ì „ ëŒ€í™” ìë¦¬ì— ë°•ì•„ë‘ëŠ” ë³€ìˆ˜ëª…ê³¼ ê°™ì•„ì•¼ í•¨</strong></li>\n</ul>\n</li>\n<li>\n<p><strong><code class=\"language-text\">RunnablePassthrough.assign()</code>ì—ì„œ <code class=\"language-text\">RunnableLambda(memory.load_memory_variables) | itemgetter(memory.memory_key)</code>ì„ <code class=\"language-text\">chat_history</code>ì— ì§€ì •í•œ <code class=\"language-text\">runnable</code>ì„ ë§Œë“¤ì–´ chainì—ì„œ ì´ìš©í•¨</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> langchain_core<span class=\"token punctuation\">.</span>runnables <span class=\"token keyword\">import</span> RunnableLambda<span class=\"token punctuation\">,</span> RunnablePassthrough\n\nrunnable <span class=\"token operator\">=</span> RunnablePassthrough<span class=\"token punctuation\">.</span>assign<span class=\"token punctuation\">(</span>  chat_history<span class=\"token operator\">=</span>RunnableLambda<span class=\"token punctuation\">(</span>memory<span class=\"token punctuation\">.</span>load_memory_variables<span class=\"token punctuation\">)</span>\n    <span class=\"token operator\">|</span> itemgetter<span class=\"token punctuation\">(</span><span class=\"token string\">\"chat_history\"</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># RunnableLambda(memory.load_memory_variables)ì˜ ë°˜í™˜ê°’ì—ì„œ chat_historyë§Œ ì¶”ì¶œ</span>\n    <span class=\"token comment\"># | itemgetter(memory.memory_key) # ìœ„ì™€ ë˜‘ê°™ìŒ</span>\n<span class=\"token punctuation\">)</span>\n\nrunnable<span class=\"token punctuation\">.</span>invoke<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"input\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"hi\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># {'input': 'hi'}ê³¼ chat_history ê°’ì´ í•©ì³ì ¸ ì•„ë˜ì˜ í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ì˜ ë³€ìˆ˜ê°’ì— ë“¤ì–´ê°ˆ ê²ƒì„ ({'input': 'hi', 'chat_history': [ëŒ€í™”ë“¤]} ê¼´)</span></code></pre></div>\n<ul>\n<li><strong><code class=\"language-text\">RunnableLambda(memory.load_memory_variables)</code>ëŠ” <code class=\"language-text\">memory.load_memory_variables({})</code>ì™€ ê°™ì€ ê²ƒì„</strong>\n<ul>\n<li>ì¦‰, <code class=\"language-text\">chat_history</code> í‚¤ì˜ ê°’ì— <strong>ëŒ€í™”ë“¤ ë¦¬ìŠ¤íŠ¸</strong>ë¥¼ ë‹´ì€ ë”•ì…”ë„ˆë¦¬ì¼ ê²ƒì„</li>\n</ul>\n</li>\n<li>ê·¸ë¦¬ê³ , â­ï¸ <strong><code class=\"language-text\">memory.load_memory_variables({})</code>ì˜ ê²°ê³¼ê°’(ëŒ€í™”ë“¤ ë‹´ê¸´ ë”•ì…”ë„ˆë¦¬)ì—ì„œ <code class=\"language-text\">memory.memory_key</code>ê°’(â€˜chat_historyâ€™ í‚¤ì˜ ê°’, ì¦‰ ëŒ€í™”ë“¤)ë§Œ ì¶”ì¶œí•´ì„œ <code class=\"language-text\">chat_history</code> ë³€ìˆ˜ì— ì „ë‹¬í•¨</strong> â­ï¸\n<ul>\n<li><code class=\"language-text\">memory.load_memory_variables({})</code><br>: {â€˜chat_historyâ€™: [ëŒ€í™”ë“¤]} ê¼´</li>\n<li><code class=\"language-text\">memory.memory_key</code>ê°’(â€˜chat_historyâ€™ í‚¤ì˜ ê°’)ë§Œ ì¶”ì¶œ<br>: [ëŒ€í™”ë“¤] ê¼´</li>\n<li><code class=\"language-text\">chat_history</code> ë³€ìˆ˜ì— ì „ë‹¬í•œ í›„ì˜ ìµœì¢… <code class=\"language-text\">RunnablePassthrough.assign()</code> ê°’<br>: {â€˜chat_historyâ€™: [ëŒ€í™”ë“¤]}</li>\n<li><code class=\"language-text\">runnable.invoke({\"input\": \"hi\"})</code> ê°’<br>: <code class=\"language-text\">{'input': 'hi'}</code>ê³¼ <code class=\"language-text\">chat_history</code> ê°’ì´ í•©ì³ì ¸ <code class=\"language-text\">{'input': 'hi', 'chat_history': [ëŒ€í™”ë“¤]}</code> ê¼´ì´ ë¨</li>\n</ul>\n</li>\n</ul>\n<p>Â </p>\n<p>â­ï¸ **ê²°êµ­, runnableë¥¼ invoke í˜¸ì¶œí–ˆì„ ë•Œ<br><code class=\"language-text\">{'input': 'hi', 'chat_history': [ëŒ€í™”ë“¤]}</code>ì´ ë˜ë¯€ë¡œ ê°ê° ì‚¬ìš©ì ì…ë ¥ê°’ê³¼ ì´ì „ ëŒ€í™”ë¡œ í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ì—ì„œ ì´ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!!**â­ï¸</p>\n<p>(ì¢€ ë³µì¡í•˜ì§€ë§Œ ê·¸ ê³¼ì •ì„ ëª…í™•íˆ ì•Œê³  ìˆì–´ì•¼ ë³¸ê²©ì ìœ¼ë¡œ chainì— ì—°ê²°í•  ë•Œ í—·ê°ˆë¦¬ì§€ ì•Šì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤..)</p>\n</li>\n</ol>\n<p>Â </p>\n<p>ë°©ê¸ˆ ë§Œë“¤ì—ˆë˜ **ì´ì „ ëŒ€í™”ì™€ ìƒˆë¡œìš´ ì§ˆë¬¸ì„ ë°˜í™˜í•˜ëŠ” <code class=\"language-text\">runnable</code>**ì„ ê°€ì¥ ë§¨ ì•ì— ë¶™ì—¬<br>ê·¸ ê²°ê³¼ë¥¼ í”„ë¡¬í”„íŠ¸ì— ì „ë‹¬í•˜ëŠ” â€˜runnable-í”„ë¡¬í”„íŠ¸-LLM-íŒŒì„œâ€™ ì´ë ‡ê²Œ chainì„ êµ¬ì„±í•˜ë©´ ë  ë“¯ í•©ë‹ˆë‹¤.</p>\n<p>Â </p>\n<p>Â </p>\n<h2 id=\"sqlite-dbë¥¼-ì´ìš©í•œ-ë©”ëª¨ë¦¬-ì €ì¥-ë°©ë²•\" style=\"position:relative;\"><a href=\"#sqlite-db%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EB%A9%94%EB%AA%A8%EB%A6%AC-%EC%A0%80%EC%9E%A5-%EB%B0%A9%EB%B2%95\" aria-label=\"sqlite dbë¥¼ ì´ìš©í•œ ë©”ëª¨ë¦¬ ì €ì¥ ë°©ë²• permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SQLite DBë¥¼ ì´ìš©í•œ ë©”ëª¨ë¦¬ ì €ì¥ ë°©ë²•</h2>\n<hr>\n<p>ì´ì „ê¹Œì§€ëŠ” ì¸ë©”ëª¨ë¦¬ì— ìºì‹œë¥¼ ì €ì¥í•˜ëŠ” ë°©ë²•ì„ ì •ë¦¬í•´ë´¤ëŠ”ë°<br>ì‚¬ì‹¤, ëŒ€í™” ì„¸ì…˜ì„ ì¼íšŒì„±ìœ¼ë¡œ ì´ìš©í•˜ëŠ” ê²ƒì´ë©´ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•˜ì§€ ì•Šì•„ë„ ë˜ê¸´ í•©ë‹ˆë‹¤.</p>\n<p>í•˜ì§€ë§Œ, ì´ì „ ëŒ€í™”ë¥¼ ë‚˜ì¤‘ì— ë‹¤ì‹œ ì‚¬ìš©í•´ì•¼ í•œë‹¤ë©´ ë°ì´í„°ë² ì´ìŠ¤ì— ìœ ì €ë³„ í…Œì´ë¸” í˜•ì‹ìœ¼ë¡œ ì €ì¥í•´ë‘ê³ , ê·¸ ê¸°ë°˜ìœ¼ë¡œ ë‹µë³€ì„ í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.</p>\n<p>Â </p>\n<p>íë¦„ë¶€í„° ì •ë¦¬í•˜ê² ìŠµë‹ˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">invoke() í˜¸ì¶œ\n    â†“\nconfigì—ì„œ user_id, session_id ì¶”ì¶œ (history_factory_config ì°¸ì¡°)\n    â†“\nget_chat_history(user_id, session_id) í˜¸ì¶œ â†’ ChatMessageHistory ë°˜í™˜\n    â†“\nchat_historyë¥¼ í”„ë¡¬í”„íŠ¸ì— ì£¼ì… (history_messages_key ì‚¬ìš©)\n    â†“\nquestionì„ í”„ë¡¬í”„íŠ¸ì— ì£¼ì… (input_messages_key ì‚¬ìš©)\n    â†“\nLLM ì‹¤í–‰ â†’ ì‘ë‹µ ë°˜í™˜\n    â†“\nìƒˆ ëŒ€í™”(ì§ˆë¬¸+ì‘ë‹µ)ë¥¼ ChatMessageHistoryì— ìë™ ì €ì¥</code></pre></div>\n<p>ì²˜ìŒì— ì§ˆë¬¸ì„ í–ˆì„ ë•Œ configì—ì„œ ì–´ë– í•œ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì–´ë– í•œ í…Œì´ë¸”ì—ì„œ ì–´ë– í•œ ì»¬ëŸ¼ê°’ì„ ì°¸ê³ í• ì§€ë¥¼ ì •í•©ë‹ˆë‹¤.</p>\n<p>ì´í›„, í•´ë‹¹ configë¥¼ ì°¸ê³ í•˜ì—¬ ì´ì „ ëŒ€í™”ë¥¼ ê°€ì ¸ì˜¨ í›„ í”„ë¡¬í”„íŠ¸ì— ë„£ìŠµë‹ˆë‹¤.</p>\n<p>ê·¸ë¦¬ê³ , ì²˜ìŒ ì…ë ¥í•œ ì§ˆë¬¸ì„ í”„ë¡¬í”„íŠ¸ì— ë„£ìœ¼ë©´ì„œ LLMì´ ì‹¤í–‰í•˜ê³  ì‘ë‹µì„ ë°›ìŠµë‹ˆë‹¤.</p>\n<p>ë§ˆì§€ë§‰ì— ê·¸ ìƒˆë¡œìš´ ëŒ€í™”ë¥¼ í•´ë‹¹ ë°ì´í„°ë² ì´ìŠ¤ì˜ í…Œì´ë¸”ì— ë°ì´í„°ë¡œ ì €ì¥í•©ë‹ˆë‹¤.</p>\n<p>Â </p>\n<p>ì½”ë“œë¡œ ìì„¸í•˜ê²Œ ë´…ì‹œë‹¤.</p>\n<ol>\n<li>\n<p>**<code class=\"language-text\">ConfigurableFieldSpec</code>**ì„ ì´ìš©í•´ <strong>DB ì¡°íšŒí•  íŒŒë¼ë¯¸í„°(ì»¬ëŸ¼ëª… ë“±)ë¥¼ ì„¤ì •</strong>í•´ë‘ì–´ì•¼ í•©ë‹ˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> langchain_core<span class=\"token punctuation\">.</span>runnables<span class=\"token punctuation\">.</span>utils <span class=\"token keyword\">import</span> ConfigurableFieldSpec\n\nconfig_fields <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n    ConfigurableFieldSpec<span class=\"token punctuation\">(</span>\n        <span class=\"token builtin\">id</span><span class=\"token operator\">=</span><span class=\"token string\">\"user_id\"</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># â­ï¸ get_chat_history í•¨ìˆ˜ì—ì„œ ì‚¬ìš©í•  íŒŒë¼ë¯¸í„° â­ï¸</span>\n        annotation<span class=\"token operator\">=</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">,</span>\n        name<span class=\"token operator\">=</span><span class=\"token string\">\"User ID\"</span><span class=\"token punctuation\">,</span>\n        description<span class=\"token operator\">=</span><span class=\"token string\">\"Unique identifier for a user.\"</span><span class=\"token punctuation\">,</span>\n        default<span class=\"token operator\">=</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\n        is_shared<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    ConfigurableFieldSpec<span class=\"token punctuation\">(</span>\n        <span class=\"token builtin\">id</span><span class=\"token operator\">=</span><span class=\"token string\">\"conversation_id\"</span><span class=\"token punctuation\">,</span> <span class=\"token comment\"># â­ï¸ get_chat_history í•¨ìˆ˜ì—ì„œ ì‚¬ìš©í•  íŒŒë¼ë¯¸í„° â­ï¸</span>\n        annotation<span class=\"token operator\">=</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">,</span>\n        name<span class=\"token operator\">=</span><span class=\"token string\">\"Conversation ID\"</span><span class=\"token punctuation\">,</span>\n        description<span class=\"token operator\">=</span><span class=\"token string\">\"Unique identifier for a conversation.\"</span><span class=\"token punctuation\">,</span>\n        default<span class=\"token operator\">=</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\n        is_shared<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n</li>\n<li>\n<p><strong><code class=\"language-text\">get_chat_history</code></strong> í•¨ìˆ˜ì—ì„œ <strong>DBì—ì„œ ì‚¬ìš©í•  íŒŒë¼ë¯¸í„°ëª…ì„ ì¸ìë¡œ ë°›ì•„</strong>, **<code class=\"language-text\">SQLChatMessageHistory</code>**ì„ ì´ìš©í•´ <strong>DB ë©”ì‹œì§€ íˆìŠ¤í† ë¦¬ë¥¼ ê´€ë¦¬</strong>í•˜ë„ë¡ ì •ì˜í•©ë‹ˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">get_chat_history</span><span class=\"token punctuation\">(</span>user_id<span class=\"token punctuation\">,</span> conversation_id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">return</span> SQLChatMessageHistory<span class=\"token punctuation\">(</span>\n        table_name<span class=\"token operator\">=</span>user_id<span class=\"token punctuation\">,</span>          <span class=\"token comment\"># (ìœ ì € IDë³„) í…Œì´ë¸”</span>\n        session_id<span class=\"token operator\">=</span>conversation_id<span class=\"token punctuation\">,</span>  <span class=\"token comment\"># ëŒ€í™” ID ì»¬ëŸ¼</span>\n        connection<span class=\"token operator\">=</span><span class=\"token string\">\"sqlite:///sqlite.db\"</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># ë°ì´í„°ë² ì´ìŠ¤ íŒŒì¼ëª…</span>\n    <span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li>\n<p><code class=\"language-text\">table_name</code>: (ë³´í†µ ìœ ì € IDë³„) í…Œì´ë¸”ëª… ì„¤ì •</p>\n</li>\n<li>\n<p><code class=\"language-text\">session_id</code>: í…Œì´ë¸”ì—ì„œ session_id ê°’ì— ë„£ëŠ” ëŒ€í™” ì„¸ì…˜ ID ê°’ ì„¤ì •</p>\n</li>\n<li>\n<p><code class=\"language-text\">connection</code>: ë°ì´í„°ë² ì´ìŠ¤ íŒŒì¼ëª… ì„¤ì •</p>\n</li>\n</ul>\n</li>\n<li>\n<p><code class=\"language-text\">RunnableWithMessageHistory()</code> ê°ì²´ ìƒì„±í•˜ë©´ì„œ <strong>ëŒ€í™” ë‚´ìš©ì„ ê¸°ë¡í•´ì£¼ëŠ” í•¨ìˆ˜ë¥¼ ê¸°ì¡´ ì²´ì¸ì— ì—°ê²°</strong>í•´ì¤ë‹ˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> langchain_core<span class=\"token punctuation\">.</span>runnables<span class=\"token punctuation\">.</span>history <span class=\"token keyword\">import</span> RunnableWithMessageHistory\n\nchain_with_history <span class=\"token operator\">=</span> RunnableWithMessageHistory<span class=\"token punctuation\">(</span>\n    chain<span class=\"token punctuation\">,</span>\n    get_chat_history<span class=\"token punctuation\">,</span>  <span class=\"token comment\"># ëŒ€í™” ê¸°ë¡ì„ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.</span>\n    input_messages_key<span class=\"token operator\">=</span><span class=\"token string\">\"question\"</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># ì…ë ¥ ë©”ì‹œì§€ì˜ í‚¤ë¥¼ \"question\"ìœ¼ë¡œ ì„¤ì • (â­ï¸ chainì—ì„œ prompt í…œí”Œë¦¿ì˜ ì…ë ¥ ë³€ìˆ˜ì™€ ê°™ì•„ì•¼ í•¨ â­ï¸)</span>\n    history_messages_key<span class=\"token operator\">=</span><span class=\"token string\">\"chat_history\"</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># ëŒ€í™” ê¸°ë¡ ë©”ì‹œì§€ì˜ í‚¤ë¥¼ \"chat_history\"ë¡œ ì„¤ì • (â­ï¸ chainì—ì„œ prompt í…œí”Œë¦¿-ë©”ì‹œì§€í”Œë ˆì´ìŠ¤í™€ë”ì˜ ì…ë ¥ ë³€ìˆ˜ì™€ ê°™ì•„ì•¼ í•¨ â­ï¸)</span>\n    history_factory_config<span class=\"token operator\">=</span>config_fields<span class=\"token punctuation\">,</span>  <span class=\"token comment\"># ëŒ€í™” ê¸°ë¡ ì¡°íšŒì‹œ ì°¸ê³ í•  íŒŒë¼ë¯¸í„°ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤. (â­ï¸ get_chat_historyì—ì„œ ì‚¬ìš©í•˜ëŠ” ConfigurableFieldSpeceë“¤ì„ ì „ë‹¬í•˜ê¸° ìœ„í•œ ê²ƒ â­ï¸)</span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li>\n<p><code class=\"language-text\">chain</code>: ê¸°ì¡´ ì²´ì¸(í”„ë¡¬í”„íŠ¸-LLM-íŒŒì„œ ì—°ê²°)</p>\n</li>\n<li>\n<p><code class=\"language-text\">get_chat_history</code>: DBì—ì„œ ë°ì´í„°ë² ì´ìŠ¤ íŒŒì¼ëª…-ëŒ€í™” ì„¸ì…˜-(ìœ ì €ë³„) í…Œì´ë¸”ì„ ì°¾ì•„ê°€ì„œ ë©”ì‹œì§€ íˆìŠ¤í† ë¦¬ ê´€ë¦¬í•¨</p>\n</li>\n<li>\n<p><code class=\"language-text\">input_messages_key</code>: ê¸°ì¡´ ì²´ì¸ì—ì„œ í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ì—ì„œ ì‚¬ìš©í•˜ëŠ” ì…ë ¥ë³€ìˆ˜ ê°’ì„ ë„£ìŒ</p>\n</li>\n<li>\n<p><code class=\"language-text\">history_messages_key</code>: ê¸°ì¡´ ì²´ì¸ì—ì„œ í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ì—ì„œ <code class=\"language-text\">MessagesPlaceholder</code>ì—ì„œ ì‚¬ìš©í•˜ëŠ” ë³€ìˆ˜ ê°’ì„ ë„£ìŒ</p>\n</li>\n<li>\n<p><code class=\"language-text\">history_factory_config</code>: ëŒ€í™” ê¸°ë¡ ì¡°íšŒí•  ë•Œ ì°¸ê³ í•  íŒŒë¼ë¯¸í„° ì •ë³´ë“¤ ì„¤ì •</p>\n</li>\n</ul>\n</li>\n<li>\n<p>configì— configurable í‚¤ í•˜ìœ„ì— get_chat_historyì—ì„œ  <strong>DB ë©”ì‹œì§€ íˆìŠ¤í† ë¦¬ë¥¼ ê´€ë¦¬</strong>í•  ë•Œ ì‚¬ìš©í•˜ëŠ” <strong>íŒŒë¼ë¯¸í„°(ëŒ€í™” ì„¸ì…˜ ID, í…Œì´ë¸”ëª…)ë“¤ì„ ì„¤ì •</strong>í•©ë‹ˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># config ì„¤ì •</span>\n<span class=\"token triple-quoted-string string\">\"\"\"\nconfigurable í‚¤ í•˜ìœ„ì— user_id, conversation_id ê°’ì„ ì„¤ì •\n(get_chat_historyì—ì„œ DB ë©”ì‹œì§€ íˆìŠ¤í† ë¦¬ ê´€ë¦¬í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ê°’ë“¤)\n\"\"\"</span>\nconfig <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"configurable\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"user_id\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"user1\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"conversation_id\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"conversation1\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>\n<p><strong>table_name í…Œì´ë¸”ëª…=user_id=user1</strong></p>\n</li>\n<li>\n<p><strong>session_id ì»¬ëŸ¼ ê°’=conversation_id=conversation1</strong></p>\n</li>\n</ul>\n</li>\n<li>\n<p>ì•ì—ì„œ ê¸°ì¡´ ì²´ì¸ê³¼ ì´ì „ ëŒ€í™” ê¸°ë¡ ì¡°íšŒí•˜ëŠ” ê²ƒì„ ì—°ê²°í•œ <strong><code class=\"language-text\">chain_with_history</code>ì—ì„œ <code class=\"language-text\">invoke()</code> ë©”ì„œë“œì— ì…ë ¥ë³€ìˆ˜ì™€ configì„ ì „ë‹¬í•˜ì—¬ í˜¸ì¶œ</strong>í•©ë‹ˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">chain_with_history<span class=\"token punctuation\">.</span>invoke<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"question\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"ë‚´ ì´ë¦„ì´ ë­ë¼ê³ ?\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> config<span class=\"token punctuation\">)</span></code></pre></div>\n</li>\n</ol>\n<p>Â </p>\n<p>êµ‰ì¥íˆ ë³µì¡í•˜ê³  ì–´ë ¤ì›Œë³´ì´ì§€ë§Œ<br>ê°“ í…Œë””ë…¸íŠ¸ë‹˜ ê°•ì˜ ë“¤ìœ¼ë‹ˆ ì´í•´í•˜ê¸° ì‰½ë”ë¼ê³ ìš”,, ì¢‹ìŠ´ë‹¤â€¦</p>\n<p>Â </p>\n<p>Â </p>\n<p>ì—¬ê¸°ì„œ ë„ì•.<br>ë‹¤ìŒì€ ë¬¸ì„œ ë¡œë“œí•˜ëŠ” ë°©ë²•ì¸ë°, ê°„ë‹¨íˆ ì •ë¦¬í•˜ê³  ë‹¤ë¥¸ ê²ƒì„ ì“°ê³ ì í•©ë‹ˆë‹¤! See ya.</p>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#lcel%EC%97%90%EC%84%9C-%EB%A9%94%EB%AA%A8%EB%A6%AC-%EC%82%AC%EC%9A%A9%ED%95%98%EB%8A%94-%EB%B0%A9%EB%B2%95\">LCELì—ì„œ ë©”ëª¨ë¦¬ ì‚¬ìš©í•˜ëŠ” ë°©ë²•</a></li>\n<li><a href=\"#sqlite-db%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EB%A9%94%EB%AA%A8%EB%A6%AC-%EC%A0%80%EC%9E%A5-%EB%B0%A9%EB%B2%95\">SQLite DBë¥¼ ì´ìš©í•œ ë©”ëª¨ë¦¬ ì €ì¥ ë°©ë²•</a></li>\n</ul>\n</div>","frontmatter":{"date":"January 01, 2026","title":"[LLM] í…Œë””ë…¸íŠ¸ì˜ RAG ë¹„ë²•ë…¸íŠ¸ ë„ì ë„ì -11","categories":"LLM RAG","author":"ë³€ìš°ì¤‘","emoji":"â˜€ï¸"},"fields":{"slug":"/26-01-01_1/"}},"site":{"siteMetadata":{"siteUrl":"https://www.zoomkoding.com","comments":{"utterances":{"repo":"https://github.com/byeonwoojung/byeonwoojung.github.io"}}}}},"pageContext":{"slug":"/25-12-31_1/","nextSlug":"/25-12-30_1/","prevSlug":"/26-01-01_1/"}},"staticQueryHashes":["1073350324","1956554647","2938748437"]}