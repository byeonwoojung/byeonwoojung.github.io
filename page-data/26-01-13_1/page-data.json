{"componentChunkName":"component---src-templates-blog-template-js","path":"/26-01-13_1/","result":{"data":{"cur":{"id":"34d120bf-0552-506b-8640-779280088570","html":"<p>참고 : 테디노트의 RAG 비법노트 (<a href=\"https://fastcampus.co.kr/data_online_teddy)\">https://fastcampus.co.kr/data_online_teddy)</a><br>소스코드: <a href=\"https://github.com/teddylee777/langchain-kr\">https://github.com/teddylee777/langchain-kr</a><br>위키독스: <a href=\"https://wikidocs.net/book/14314\">https://wikidocs.net/book/14314</a></p>\n<p> </p>\n<p>오늘은 정말 뜬금없이 갖가지 내용들을 끄적이고자 합니다..<br><strong>@chain 데코레이터</strong>, <strong>Configurable</strong>, <strong>Route</strong> 등에 대해 정리하고자 합니다.</p>\n<p>레츠기릿</p>\n<p> </p>\n<h2 id=\"chain-데코레이터\" style=\"position:relative;\"><a href=\"#chain-%EB%8D%B0%EC%BD%94%EB%A0%88%EC%9D%B4%ED%84%B0\" aria-label=\"chain 데코레이터 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>@chain 데코레이터</h2>\n<hr>\n<p><code class=\"language-text\">from langchain_core.runnables import chain</code>으로 가져와서<br><code class=\"language-text\">@chain</code> 데코레이터를 이용해 <strong>함수를 <code class=\"language-text\">chain</code>으로 변환</strong>하도록 합시다.</p>\n<p>즉, <code class=\"language-text\">chain</code>은 <code class=\"language-text\">Runnable</code> 객체이기 때문에 LCEL 인터페이스에 따라 <code class=\"language-text\">invoke()</code> 메서드 등을 활용할 수 있습니다.</p>\n<p>chain.get_graph().print_ascii()로 체인의 그래프 출력 가능<br>(<code class=\"language-text\">!pip install -qU grandalf</code> 그래프 그리는 라이브러리 설치해야 함)</p>\n<p><code class=\"language-text\">chain.get_prompts()</code>로 체인의 프롬프트 확인 가능</p>\n<h2 id=\"helper-함수와-wrapper-함수\" style=\"position:relative;\"><a href=\"#helper-%ED%95%A8%EC%88%98%EC%99%80-wrapper-%ED%95%A8%EC%88%98\" aria-label=\"helper 함수와 wrapper 함수 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Helper 함수와 Wrapper 함수</h2>\n<hr>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token triple-quoted-string string\">\"\"\"\nHelper 함수: Wrapper 함수를 통해서만 사용된다는 의미로 _를 붙임\n- 실제 로직이 실행되는 함수\n\"\"\"</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">_multiple_length_function</span><span class=\"token punctuation\">(</span>text1<span class=\"token punctuation\">,</span> text2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>  <span class=\"token comment\"># 두 텍스트의 길이를 곱하는 함수</span>\n    <span class=\"token keyword\">return</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>text1<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>text2<span class=\"token punctuation\">)</span>\n\n<span class=\"token triple-quoted-string string\">\"\"\"\nWrapper 함수: 2개 인자를 받는 함수로 연결하는 함수\n- Helper 함수에서 실제 로직이 실행되기 위해, 형식을 맞춰주는 함수\n- RunnableLambda에서 인자는 1개로 받아야 하므로, 딕셔너리 활용\n- 이 함수에서만 사용한다는 의미와 dict 기본 명령어 겹치지 않기 위해 _dict라는 이름을 사용\n\"\"\"</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">multiple_length_function</span><span class=\"token punctuation\">(</span>\n    _dict<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>  <span class=\"token comment\"># 딕셔너리에서 \"text1\"과 \"text2\"의 길이를 곱하는 함수</span>\n    <span class=\"token keyword\">return</span> _multiple_length_function<span class=\"token punctuation\">(</span>_dict<span class=\"token punctuation\">[</span><span class=\"token string\">\"text1\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> _dict<span class=\"token punctuation\">[</span><span class=\"token string\">\"text2\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2 id=\"configurable\" style=\"position:relative;\"><a href=\"#configurable\" aria-label=\"configurable permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Configurable</h2>\n<hr>\n<p><code class=\"language-text\">chain</code>에 <code class=\"language-text\">config</code>로 전달하는 딕셔너리(<code class=\"language-text\">RunnableConfig</code>)에서 주로 쓰는 약속된 키가 몇 가지 존재합니다. <code class=\"language-text\">chain.invoke(입력값, config)</code>로 config 설정 가능합니다. 사용하는 방법은 <code class=\"language-text\">Configurable</code>에 챕터에서 자세히 보고자 합니다.</p>\n<ol>\n<li>\n<p><code class=\"language-text\">callbacks</code> (가장 중요 ⭐)</p>\n<ul>\n<li>\n<p><strong>역할</strong>: 실행 과정을 지켜보는 감시자(핸들러)를 등록합니다.</p>\n</li>\n<li>\n<p><strong>용도</strong>: Log 출력, LangSmith 추적, 스트리밍 처리 등.</p>\n</li>\n<li>\n<p><strong>예시</strong>:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">{\"callbacks\": [ConsoleCallbackHandler()]}</code></pre></div>\n</li>\n</ul>\n</li>\n<li>\n<p><code class=\"language-text\">tags</code></p>\n<ul>\n<li>\n<p><strong>역할</strong>: 이 실행에 태그(꼬리표)를 붙입니다.</p>\n</li>\n<li>\n<p><strong>용도</strong>: 나중에 로그나 LangSmith에서 “이 태그 달린 것만 보여줘” 하고 필터링할 때 씁니다.</p>\n</li>\n<li>\n<p><strong>예시</strong>:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">{\"tags\": [\"my-tag\", \"experiment-1\"]}</code></pre></div>\n</li>\n</ul>\n</li>\n<li>\n<p><code class=\"language-text\">metadata</code></p>\n<ul>\n<li>\n<p><strong>역할</strong>: 추가적인 정보를 딕셔너리로 저장합니다.</p>\n</li>\n<li>\n<p><strong>용도</strong>: 사용자 ID, 세션 ID 처럼 실행 로직에는 영향이 없지만 기록해두고 싶은 정보들.</p>\n</li>\n<li>\n<p><strong>예시</strong>:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">{\"metadata\": {\"user_id\": \"123\", \"session_id\": \"abc\"}}</code></pre></div>\n</li>\n</ul>\n</li>\n<li>\n<p><code class=\"language-text\">run_name</code></p>\n<ul>\n<li>\n<p><strong>역할</strong>: 이 실행(Run)의 이름을 강제로 지정합니다.</p>\n</li>\n<li>\n<p><strong>용도</strong>: LangSmith 트레이스 화면에서 “RunnableLambda” 대신 “내 수정 함수” 처럼 예쁜 이름으로 보고 싶을 때.</p>\n</li>\n<li>\n<p><strong>예시</strong>:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">{\"run_name\": \"MyCustomParsingJob\"}</code></pre></div>\n</li>\n</ul>\n</li>\n<li>\n<p><code class=\"language-text\">recursion_limit</code></p>\n<ul>\n<li>\n<p><strong>역할</strong>: 체인이 너무 깊게 뺑뺑이 도는 것을 막습니다. (기본값 25)</p>\n</li>\n<li>\n<p><strong>용도</strong>: 무한 루프 방지.</p>\n</li>\n<li>\n<p><strong>예시</strong>:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">{\"recursion_limit\": 10}</code></pre></div>\n</li>\n</ul>\n</li>\n</ol>\n<p> </p>\n<p>이외에도 <code class=\"language-text\">configurable_field()</code> 메서드를 이용해 LLM 모델을 생성한 후<br><strong><code class=\"language-text\">config</code>에서 <code class=\"language-text\">configurable</code>키를 설정해 LLM 모델의 필드(파라미터)를 동적으로 바꿀 수 있습니다.</strong></p>\n<p> </p>\n<p> </p>\n<p>앞서 얘기한 <strong>configurable</strong>에 대해 더 구체적이고 명확하게 정리하고자 합니다.</p>\n<h3 id=\"동적-변경을-허용할-속성runnable-대안-정의하는-방법\" style=\"position:relative;\"><a href=\"#%EB%8F%99%EC%A0%81-%EB%B3%80%EA%B2%BD%EC%9D%84-%ED%97%88%EC%9A%A9%ED%95%A0-%EC%86%8D%EC%84%B1runnable-%EB%8C%80%EC%95%88-%EC%A0%95%EC%9D%98%ED%95%98%EB%8A%94-%EB%B0%A9%EB%B2%95\" aria-label=\"동적 변경을 허용할 속성runnable 대안 정의하는 방법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>동적 변경을 허용할 ‘속성/Runnable 대안’ 정의하는 방법</h3>\n<ol>\n<li>\n<p><code class=\"language-text\">.configurable_fields()</code>: 동적 변경 가능한 속성(필드)을 정의하는 메서드</p>\n<p>[동적 변경할 ChatOpenAI의 model_name 속성 정의]</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> langchain<span class=\"token punctuation\">.</span>prompts <span class=\"token keyword\">import</span> PromptTemplate\n<span class=\"token keyword\">from</span> langchain_core<span class=\"token punctuation\">.</span>runnables <span class=\"token keyword\">import</span> ConfigurableField\n<span class=\"token keyword\">from</span> langchain_openai <span class=\"token keyword\">import</span> ChatOpenAI\n\n<span class=\"token comment\"># model_name: 동적 설정 가능 (default:gpt-4o)</span>\nmodel <span class=\"token operator\">=</span> ChatOpenAI<span class=\"token punctuation\">(</span>temperature<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> model_name<span class=\"token operator\">=</span><span class=\"token string\">\"gpt-4o\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>configurable_fields<span class=\"token punctuation\">(</span>\n\t<span class=\"token comment\"># ChatOpenAI의 필드 model_name을 동적으로 변경할 것임을 설정</span>\n    model_name<span class=\"token operator\">=</span>ConfigurableField<span class=\"token punctuation\">(</span>\n        <span class=\"token builtin\">id</span><span class=\"token operator\">=</span><span class=\"token string\">\"gpt_version\"</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># model_name의 id 설정</span>\n        name<span class=\"token operator\">=</span><span class=\"token string\">\"Version of GPT\"</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># model_name의 이름 설정</span>\n        <span class=\"token comment\"># model_name의 설명 설정</span>\n        description<span class=\"token operator\">=</span><span class=\"token string\">\"Official model name of GPTs. ex) gpt-4o, gpt-4o-mini\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li><code class=\"language-text\">ChatOpenAI</code>에 <code class=\"language-text\">configurable_fields()</code> 메서드를 이용해 속성 <code class=\"language-text\">model_name</code>을 동적 변경 가능한 속성으로 정의함</li>\n<li>속성 <code class=\"language-text\">model_name</code>에 <code class=\"language-text\">ConfigurableField</code>을 이용해 정의함</li>\n<li>속성 변경 시, <code class=\"language-text\">model_name</code>의 <code class=\"language-text\">id</code> 값인 <code class=\"language-text\">gpt_version</code>에 변경할 값을 주면 됨</li>\n</ul>\n<p> </p>\n<p>[HubRunnable을 이용한 랭체인 허브 프롬프트 동적 변경 정의]</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> langchain<span class=\"token punctuation\">.</span>runnables<span class=\"token punctuation\">.</span>hub <span class=\"token keyword\">import</span> HubRunnable\n\nprompt <span class=\"token operator\">=</span> HubRunnable<span class=\"token punctuation\">(</span><span class=\"token string\">\"teddynote/rag-prompt-korean\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>configurable_fields<span class=\"token punctuation\">(</span>\n    <span class=\"token comment\"># 소유자 저장소 커밋을 설정하는 ConfigurableField</span>\n    owner_repo_commit<span class=\"token operator\">=</span>ConfigurableField<span class=\"token punctuation\">(</span>  <span class=\"token comment\"># ⭐️ owner_repo_commit는 \"teddynote/rag-prompt-korean\" 부분을 말하는 것 ⭐️</span>\n        <span class=\"token comment\"># 필드의 ID</span>\n        <span class=\"token builtin\">id</span><span class=\"token operator\">=</span><span class=\"token string\">\"hub_commit\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token comment\"># 필드의 이름</span>\n        name<span class=\"token operator\">=</span><span class=\"token string\">\"Hub Commit\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token comment\"># 필드에 대한 설명</span>\n        description<span class=\"token operator\">=</span><span class=\"token string\">\"Korean RAG prompt by teddynote\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span>\nprompt</code></pre></div>\n<ul>\n<li><code class=\"language-text\">HubRunnable</code>에 <code class=\"language-text\">configurable_fields()</code> 메서드를 이용해 속성 <code class=\"language-text\">owner_repo_commit</code>을 동적 변경 가능한 속성으로 정의함\n<ul>\n<li><strong>정확히 말하자면, LangChain Hub에서 프롬프트 불러오는 repo 속성을 변경하는 것입니다!!!</strong></li>\n</ul>\n</li>\n<li>속성 <code class=\"language-text\">owner_repo_commit</code>에 <code class=\"language-text\">ConfigurableField</code>을 이용해 정의함</li>\n<li>속성 변경 시, <code class=\"language-text\">owner_repo_commit</code>의 <code class=\"language-text\">id</code> 값인 <code class=\"language-text\">hub_commit</code>에 변경할 값을 주면 됨</li>\n</ul>\n</li>\n<li>\n<p><code class=\"language-text\">.configurable_alternatives()</code>: Runnable 객체 대안을 정의하는 메서드</p>\n<p>[LLM의 객체 대안 정의]</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> langchain<span class=\"token punctuation\">.</span>prompts <span class=\"token keyword\">import</span> PromptTemplate\n<span class=\"token keyword\">from</span> langchain_anthropic <span class=\"token keyword\">import</span> ChatAnthropic\n<span class=\"token keyword\">from</span> langchain_core<span class=\"token punctuation\">.</span>runnables <span class=\"token keyword\">import</span> ConfigurableField\n<span class=\"token keyword\">from</span> langchain_openai <span class=\"token keyword\">import</span> ChatOpenAI\n\n<span class=\"token comment\"># ⭐️ configurable_alternatives: Runnable 객체 자체를 바꿈 ⭐️</span>\n\nllm <span class=\"token operator\">=</span> ChatAnthropic<span class=\"token punctuation\">(</span>\n    temperature<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> model<span class=\"token operator\">=</span><span class=\"token string\">\"claude-3-5-sonnet-20240620\"</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>configurable_alternatives<span class=\"token punctuation\">(</span>\n    <span class=\"token comment\"># 이 필드에 id를 부여합니다.</span>\n    <span class=\"token comment\"># 최종 실행 가능한 객체를 구성할 때, 이 id를 사용하여 이 필드를 구성할 수 있습니다.</span>\n    ConfigurableField<span class=\"token punctuation\">(</span><span class=\"token builtin\">id</span><span class=\"token operator\">=</span><span class=\"token string\">\"llm\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\"># 기본 키를 설정합니다.</span>\n    <span class=\"token comment\"># ⭐️ configurable에서 llm에 이 키를 지정하면 위에서 초기화된 기본 LLM(ChatAnthropic(temperature=0, model=\"claude-3-5-sonnet-20240620\"))이 사용됩니다. ⭐️</span>\n    default_key<span class=\"token operator\">=</span><span class=\"token string\">\"anthropic\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\"># 'openai'라는 이름의 새 옵션을 추가하며, 이는 `ChatOpenAI()`와 동일합니다.</span>\n    openai<span class=\"token operator\">=</span>ChatOpenAI<span class=\"token punctuation\">(</span>model<span class=\"token operator\">=</span><span class=\"token string\">\"gpt-4o-mini\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\"># 'gpt4'라는 이름의 새 옵션을 추가하며, 이는 `ChatOpenAI(model=\"gpt-4\")`와 동일합니다.</span>\n    gpt4o<span class=\"token operator\">=</span>ChatOpenAI<span class=\"token punctuation\">(</span>model<span class=\"token operator\">=</span><span class=\"token string\">\"gpt-4o\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\"># 여기에 더 많은 구성 옵션을 추가할 수 있습니다.</span>\n<span class=\"token punctuation\">)</span>\nprompt <span class=\"token operator\">=</span> PromptTemplate<span class=\"token punctuation\">.</span>from_template<span class=\"token punctuation\">(</span><span class=\"token string\">\"{topic} 에 대해 간단히 설명해주세요.\"</span><span class=\"token punctuation\">)</span>\nchain <span class=\"token operator\">=</span> prompt <span class=\"token operator\">|</span> llm</code></pre></div>\n<ul>\n<li>\n<p><code class=\"language-text\">ChatAnthropic</code>에 <code class=\"language-text\">configurable_alternatives()</code> 메서드를 이용해 LLM 모델 자체를 변경 가능하도록 정의함<br>(속성 변경이 아니므로 메서드에 필드명 없이 바로 <code class=\"language-text\">ConfigurableField</code> 넣음)</p>\n</li>\n<li>\n<p>LLM 모델 변경 시</p>\n<ul>\n<li>\n<p><code class=\"language-text\">id</code> 값인 <code class=\"language-text\">llm</code>에 변경할 값을 주면 됨</p>\n</li>\n<li>\n<p><code class=\"language-text\">id</code>에 줄 수 있는 변경 가능한 값</p>\n<ul>\n<li><code class=\"language-text\">anthropic</code>: <code class=\"language-text\">default_key</code>로 설정한 원래 모델 설정<br>(<code class=\"language-text\">ChatAnthropic(temperature=0, model=\"claude-3-5-sonnet-20240620\")</code>)을 이용할 때, <code class=\"language-text\">id</code>에 줄 값</li>\n<li><code class=\"language-text\">openai</code>: <code class=\"language-text\">ChatOpenAI(model=\"gpt-4o-mini\")</code>로 설정</li>\n<li><code class=\"language-text\">gpt4o</code>: <code class=\"language-text\">ChatOpenAI(model=\"gpt-4o\")</code>로 설정</li>\n</ul>\n</li>\n<li>\n<p>모델 변경 방법 예시</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">chain<span class=\"token punctuation\">.</span>with_config<span class=\"token punctuation\">(</span>configurable<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"llm\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"openai\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>invoke<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"topic\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"뉴진스\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n</li>\n</ul>\n</li>\n</ul>\n<p>[프롬프트 객체 대안 정의]</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># 언어 모델을 초기화하고 temperature를 0으로 설정합니다.</span>\nllm <span class=\"token operator\">=</span> ChatOpenAI<span class=\"token punctuation\">(</span>temperature<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\nprompt <span class=\"token operator\">=</span> PromptTemplate<span class=\"token punctuation\">.</span>from_template<span class=\"token punctuation\">(</span>\n    <span class=\"token string\">\"{country} 의 수도는 어디야?\"</span>  <span class=\"token comment\"># 기본 프롬프트 템플릿</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>configurable_alternatives<span class=\"token punctuation\">(</span>\n    <span class=\"token comment\"># 이 필드에 id를 부여합니다. (⭐️ 변경할 값을 prompt 변수명에 넣으면 됨 ⭐️)</span>\n    ConfigurableField<span class=\"token punctuation\">(</span><span class=\"token builtin\">id</span><span class=\"token operator\">=</span><span class=\"token string\">\"prompt\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\"># 기본 키를 설정합니다. -> ⭐️ configurable에서 prompt에 capital로 넣으면 원래 프롬프트 \"{country} 의 수도는 어디야?\"로 설정됨 ⭐️</span>\n    default_key<span class=\"token operator\">=</span><span class=\"token string\">\"capital\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\"># 'area'이라는 새로운 옵션을 추가합니다.</span>\n    area<span class=\"token operator\">=</span>PromptTemplate<span class=\"token punctuation\">.</span>from_template<span class=\"token punctuation\">(</span><span class=\"token string\">\"{country} 의 면적은 얼마야?\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\"># 'population'이라는 새로운 옵션을 추가합니다.</span>\n    population<span class=\"token operator\">=</span>PromptTemplate<span class=\"token punctuation\">.</span>from_template<span class=\"token punctuation\">(</span><span class=\"token string\">\"{country} 의 인구는 얼마야?\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\"># 'eng'이라는 새로운 옵션을 추가합니다.</span>\n    eng<span class=\"token operator\">=</span>PromptTemplate<span class=\"token punctuation\">.</span>from_template<span class=\"token punctuation\">(</span><span class=\"token string\">\"{input} 을 영어로 번역해주세요.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\"># 여기에 더 많은 구성 옵션을 추가할 수 있습니다.</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 프롬프트와 언어 모델을 연결하여 체인을 생성합니다.</span>\nchain <span class=\"token operator\">=</span> prompt <span class=\"token operator\">|</span> llm</code></pre></div>\n<p>LLM 객체 대안 설정과 비슷합니다 !!</p>\n</li>\n<li>\n<p><code class=\"language-text\">ConfigurableField()</code>: 동적으로 변경할 필드 정의</p>\n<ul>\n<li>\n<p><code class=\"language-text\">id</code> : 동적으로 변경할 필드명을 대신할 변수명(필수로 지정)<br>ex ChatOpenAI의 model_name 필드명을 gpt_version으로 대신함 -> 나중에 gpt_version에 속성값을 지정함</p>\n</li>\n<li>\n<p><code class=\"language-text\">name</code>: id에 대한 이름</p>\n<ul>\n<li>동적으로 변경하는 필드명이 무엇인지 이름을 정함</li>\n</ul>\n</li>\n<li>\n<p><code class=\"language-text\">description</code>: 해당 필드에 대한 설명</p>\n</li>\n</ul>\n</li>\n</ol>\n<p> </p>\n<h3 id=\"속성을-변경하는-방법\" style=\"position:relative;\"><a href=\"#%EC%86%8D%EC%84%B1%EC%9D%84-%EB%B3%80%EA%B2%BD%ED%95%98%EB%8A%94-%EB%B0%A9%EB%B2%95\" aria-label=\"속성을 변경하는 방법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>속성을 변경하는 방법</h3>\n<ol>\n<li>\n<p><code class=\"language-text\">.invoke(config={\"configurable\": {id: 바꾸고자 하는 값}})</code>: chain에서 <code class=\"language-text\">invoke()</code> 호출 시 config 설정으로 속성을 동적으로 변경합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># gpt_version(model_name의 ConfigurableField에서 id)을 gpt-3.5-turbo로 동적 설정</span>\nmodel<span class=\"token punctuation\">.</span>invoke<span class=\"token punctuation\">(</span>\n    <span class=\"token string\">\"대한민국의 수도는 어디야?\"</span><span class=\"token punctuation\">,</span>\n    config<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"configurable\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"gpt_version\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"gpt-3.5-turbo\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n</li>\n<li>\n<p><code class=\"language-text\">.with_config(configurable={id: 바꾸고자하는 값})</code>: 속성 또는 객체를 동적 변경을 위한 Runnable의 메서드<br>(<code class=\"language-text\">configurable</code> 값에 바꿀 값을 전달합니다.)</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">chain<span class=\"token punctuation\">.</span>with_config<span class=\"token punctuation\">(</span>configurable<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"llm\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"openai\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>invoke<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"topic\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"뉴진스\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n</li>\n</ol>\n<p>차이점: <code class=\"language-text\">invoke</code>에서 config 설정은 **“이번 한 번만 실행할 때 적용”**하는 느낌이고, <code class=\"language-text\">.with_config()</code>는 “설정이 적용된 새로운 체인 객체를 아예 만들어내는” 느낌입니다. (그래서 변수에 저장해서 재사용 가능)</p>\n<p> </p>\n<p> </p>\n<h2 id=\"route\" style=\"position:relative;\"><a href=\"#route\" aria-label=\"route permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Route</h2>\n<hr>\n<p>라우팅은 이전 단계의 출력이 경로를 정하는 것입니다.<br><strong>간단한 질문 분류</strong>나 <strong>주제 분류</strong> 등에 유용한 방식이죠.</p>\n<p>유저의 질문이 들어왔을 때 라우팅을 하는 방법은<br><code class=\"language-text\">RunnableLambda</code>, <code class=\"language-text\">RunnableBranch</code> 2가지가 존재합니다.</p>\n<p> </p>\n<h3 id=\"code-classlanguage-textrunnablelambdacode에서-routing\" style=\"position:relative;\"><a href=\"#code-classlanguage-textrunnablelambdacode%EC%97%90%EC%84%9C-routing\" aria-label=\"code classlanguage textrunnablelambdacode에서 routing permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><code class=\"language-text\">RunnableLambda</code>에서 Routing</h3>\n<p><code class=\"language-text\">route</code>를 정해주는 <code class=\"language-text\">route_chain</code> 생성</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> langchain_openai <span class=\"token keyword\">import</span> ChatOpenAI\n<span class=\"token keyword\">from</span> langchain_core<span class=\"token punctuation\">.</span>output_parsers <span class=\"token keyword\">import</span> StrOutputParser\n<span class=\"token keyword\">from</span> langchain_core<span class=\"token punctuation\">.</span>prompts <span class=\"token keyword\">import</span> PromptTemplate\n\nroute_prompt <span class=\"token operator\">=</span> PromptTemplate<span class=\"token punctuation\">.</span>from_template<span class=\"token punctuation\">(</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"주어진 사용자 질문을 `수학`, `과학`, 또는 `기타` 중 하나로 분류하세요. 한 단어 이상으로 응답하지 마세요.\n\n&lt;question>\n{question}\n&lt;/question>\n\nClassification:\"\"\"</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 체인 생성</span>\nroute_chain <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>\n    route_prompt\n    <span class=\"token operator\">|</span> ChatOpenAI<span class=\"token punctuation\">(</span>model<span class=\"token operator\">=</span><span class=\"token string\">\"gpt-4o-mini\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token operator\">|</span> StrOutputParser<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p> </p>\n<p><code class=\"language-text\">route</code>별 수행해야 할 <code class=\"language-text\">chain</code> 생성</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">math_chain <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>\n    PromptTemplate<span class=\"token punctuation\">.</span>from_template<span class=\"token punctuation\">(</span>\n        <span class=\"token triple-quoted-string string\">\"\"\"You are an expert in math. \\\nAlways answer questions starting with \"깨봉선생님께서 말씀하시기를..\". \\\nRespond to the following question:\n\nQuestion: {question}\nAnswer:\"\"\"</span>\n    <span class=\"token punctuation\">)</span>\n    <span class=\"token operator\">|</span> ChatOpenAI<span class=\"token punctuation\">(</span>model<span class=\"token operator\">=</span><span class=\"token string\">\"gpt-4o-mini\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span>\n\nscience_chain <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>\n    PromptTemplate<span class=\"token punctuation\">.</span>from_template<span class=\"token punctuation\">(</span>\n        <span class=\"token triple-quoted-string string\">\"\"\"You are an expert in science. \\\nAlways answer questions starting with \"아이작 뉴턴 선생님께서 말씀하시기를..\". \\\nRespond to the following question:\n\nQuestion: {question}\nAnswer:\"\"\"</span>\n    <span class=\"token punctuation\">)</span>\n    <span class=\"token operator\">|</span> ChatOpenAI<span class=\"token punctuation\">(</span>model<span class=\"token operator\">=</span><span class=\"token string\">\"gpt-4o-mini\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span>\n\ngeneral_chain <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>\n    PromptTemplate<span class=\"token punctuation\">.</span>from_template<span class=\"token punctuation\">(</span>\n        <span class=\"token triple-quoted-string string\">\"\"\"Respond to the following question concisely:\n\nQuestion: {question}\nAnswer:\"\"\"</span>\n    <span class=\"token punctuation\">)</span>\n    <span class=\"token operator\">|</span> ChatOpenAI<span class=\"token punctuation\">(</span>model<span class=\"token operator\">=</span><span class=\"token string\">\"gpt-4o-mini\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p> </p>\n<p>정해진 <code class=\"language-text\">route</code>에 따라 <code class=\"language-text\">chain</code>으로 안내하는 교차로 역할의 함수 정의</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># RunnableLambda로 실행되는 함수이므로, 인자는 1개를 받아와야 함</span>\n<span class=\"token comment\"># info = {\"topic\": route_chain 결과, \"question\": 사용자 입력}</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">route</span><span class=\"token punctuation\">(</span>info<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\"># 주제에 \"수학\"이 포함되어 있는 경우</span>\n    <span class=\"token keyword\">if</span> <span class=\"token string\">\"수학\"</span> <span class=\"token keyword\">in</span> info<span class=\"token punctuation\">[</span><span class=\"token string\">\"topic\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>lower<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># datascience_chain을 반환</span>\n        <span class=\"token keyword\">return</span> math_chain\n    <span class=\"token comment\"># 주제에 \"과학\"이 포함되어 있는 경우</span>\n    <span class=\"token keyword\">elif</span> <span class=\"token string\">\"과학\"</span> <span class=\"token keyword\">in</span> info<span class=\"token punctuation\">[</span><span class=\"token string\">\"topic\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>lower<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># art_chain을 반환</span>\n        <span class=\"token keyword\">return</span> science_chain\n    <span class=\"token comment\"># 그 외의 경우</span>\n    <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># general_chain을 반환</span>\n        <span class=\"token keyword\">return</span> general_chain</code></pre></div>\n<p> </p>\n<p>이들을 모두 엮어주는 메인 chain</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> operator <span class=\"token keyword\">import</span> itemgetter\n<span class=\"token keyword\">from</span> langchain_core<span class=\"token punctuation\">.</span>runnables <span class=\"token keyword\">import</span> RunnableLambda\n\nfull_chain <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">{</span><span class=\"token string\">\"topic\"</span><span class=\"token punctuation\">:</span> route_chain<span class=\"token punctuation\">,</span> <span class=\"token string\">\"question\"</span><span class=\"token punctuation\">:</span> itemgetter<span class=\"token punctuation\">(</span><span class=\"token string\">\"question\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">|</span> RunnableLambda<span class=\"token punctuation\">(</span>\n        <span class=\"token comment\"># 경로를 지정하는 함수를 인자로 전달합니다.</span>\n        route\n    <span class=\"token punctuation\">)</span>\n    <span class=\"token operator\">|</span> StrOutputParser<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p><code class=\"language-text\">{\"topic\": route_chain, \"question\": itemgetter(\"question\")}</code>부터 이해가 안 갈 수 있지만</p>\n<p>1가지 기억합시다.</p>\n<blockquote>\n<p><strong>“chain에는 딕셔너리 형태로 계속 무언가가 전달된다.”</strong></p>\n</blockquote>\n<p>즉,</p>\n<p><strong>전달되는 것과 출력되는 것들에 집중하고<br>항상 입력을 딕셔너리로 받아온 후, itemgetter 등으로 뽑아서 사용된다는 것을 잊지 말자.</strong></p>\n<p> </p>\n<p>사용자 입력은</p>\n<ol>\n<li><code class=\"language-text\">chain</code>에 전달돼서 주제를 가져와 <code class=\"language-text\">topic</code>에 저장하고</li>\n<li><code class=\"language-text\">question</code>에 그대로 저장됩니다.</li>\n</ol>\n<p><code class=\"language-text\">topic</code>과 <code class=\"language-text\">question</code>은 <code class=\"language-text\">RunnableLambda</code>에 의해<br><code class=\"language-text\">route</code> 함수에서 <code class=\"language-text\">info</code> 딕셔너리로 그대로 받아와 <code class=\"language-text\">topic</code>에 따라 루트가 정해집니다.</p>\n<p>결국, 해당 주제별 체인에 <code class=\"language-text\">topic</code>과 <code class=\"language-text\">question</code>이 전달되면서 변수에 맞게 프롬프트가 채워지는 거죠.</p>\n<p> </p>\n<p><code class=\"language-text\">full_chain.get_graph().print_ascii()</code>를 하면</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token operator\">+</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span>                      \n                    <span class=\"token operator\">|</span> Parallel<span class=\"token operator\">&lt;</span>topic<span class=\"token punctuation\">,</span>question<span class=\"token operator\">></span>Input <span class=\"token operator\">|</span>                      \n                    <span class=\"token operator\">+</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span>                      \n                             <span class=\"token operator\">**</span><span class=\"token operator\">*</span>           <span class=\"token operator\">**</span><span class=\"token operator\">*</span>                             \n                           <span class=\"token operator\">**</span>                 <span class=\"token operator\">**</span>                           \n                         <span class=\"token operator\">**</span>                     <span class=\"token operator\">**</span>                         \n              <span class=\"token operator\">+</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span>                  <span class=\"token operator\">**</span>                       \n              <span class=\"token operator\">|</span> PromptTemplate <span class=\"token operator\">|</span>                   <span class=\"token operator\">*</span>                       \n              <span class=\"token operator\">+</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span>                   <span class=\"token operator\">*</span>                       \n                       <span class=\"token operator\">*</span>                           <span class=\"token operator\">*</span>                       \n                       <span class=\"token operator\">*</span>                           <span class=\"token operator\">*</span>                       \n                       <span class=\"token operator\">*</span>                           <span class=\"token operator\">*</span>                       \n                <span class=\"token operator\">+</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span>                     <span class=\"token operator\">*</span>                       \n                <span class=\"token operator\">|</span> ChatOpenAI <span class=\"token operator\">|</span>                     <span class=\"token operator\">*</span>                       \n                <span class=\"token operator\">+</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span>                     <span class=\"token operator\">*</span>                       \n                       <span class=\"token operator\">*</span>                           <span class=\"token operator\">*</span>                       \n                       <span class=\"token operator\">*</span>                           <span class=\"token operator\">*</span>                       \n                       <span class=\"token operator\">*</span>                           <span class=\"token operator\">*</span>                       \n              <span class=\"token operator\">+</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span>             <span class=\"token operator\">+</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span>                   \n              <span class=\"token operator\">|</span> StrOutputParser <span class=\"token operator\">|</span>             <span class=\"token operator\">|</span> Lambda <span class=\"token operator\">|</span>                   \n              <span class=\"token operator\">+</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span>             <span class=\"token operator\">+</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span>                   \n                             <span class=\"token operator\">**</span><span class=\"token operator\">*</span>           <span class=\"token operator\">**</span><span class=\"token operator\">*</span>                             \n                                <span class=\"token operator\">**</span>       <span class=\"token operator\">**</span>                                \n                                  <span class=\"token operator\">**</span>   <span class=\"token operator\">**</span>                                  \n                    <span class=\"token operator\">+</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span>                     \n                    <span class=\"token operator\">|</span> Parallel<span class=\"token operator\">&lt;</span>topic<span class=\"token punctuation\">,</span>question<span class=\"token operator\">></span>Output <span class=\"token operator\">|</span>                     \n                    <span class=\"token operator\">+</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span>                     \n                                     <span class=\"token operator\">*</span>                                     \n                                     <span class=\"token operator\">*</span>                                     \n                                     <span class=\"token operator\">*</span>                                     \n                              <span class=\"token operator\">+</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span>                              \n                              <span class=\"token operator\">|</span> route_input <span class=\"token operator\">|</span>                              \n                          <span class=\"token operator\">**</span><span class=\"token operator\">**</span><span class=\"token operator\">+</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span><span class=\"token operator\">**</span><span class=\"token operator\">**</span>                          \n                     <span class=\"token operator\">**</span><span class=\"token operator\">**</span><span class=\"token operator\">*</span>           <span class=\"token operator\">*</span>           <span class=\"token operator\">**</span><span class=\"token operator\">**</span><span class=\"token operator\">*</span>                     \n                 <span class=\"token operator\">**</span><span class=\"token operator\">**</span>                <span class=\"token operator\">*</span>                <span class=\"token operator\">**</span><span class=\"token operator\">**</span>                 \n              <span class=\"token operator\">**</span><span class=\"token operator\">*</span>                    <span class=\"token operator\">*</span>                    <span class=\"token operator\">**</span><span class=\"token operator\">*</span>              \n<span class=\"token operator\">+</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span>          <span class=\"token operator\">+</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span>          <span class=\"token operator\">+</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span> \n<span class=\"token operator\">|</span> PromptTemplate <span class=\"token operator\">|</span>          <span class=\"token operator\">|</span> PromptTemplate <span class=\"token operator\">|</span>          <span class=\"token operator\">|</span> PromptTemplate <span class=\"token operator\">|</span> \n<span class=\"token operator\">+</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span>          <span class=\"token operator\">+</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span>          <span class=\"token operator\">+</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span> \n         <span class=\"token operator\">*</span>                           <span class=\"token operator\">*</span>                           <span class=\"token operator\">*</span>         \n         <span class=\"token operator\">*</span>                           <span class=\"token operator\">*</span>                           <span class=\"token operator\">*</span>         \n         <span class=\"token operator\">*</span>                           <span class=\"token operator\">*</span>                           <span class=\"token operator\">*</span>         \n  <span class=\"token operator\">+</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span>              <span class=\"token operator\">+</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span>              <span class=\"token operator\">+</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span>   \n  <span class=\"token operator\">|</span> ChatOpenAI <span class=\"token operator\">|</span><span class=\"token operator\">*</span>             <span class=\"token operator\">|</span> ChatOpenAI <span class=\"token operator\">|</span>              <span class=\"token operator\">|</span> ChatOpenAI <span class=\"token operator\">|</span>   \n  <span class=\"token operator\">+</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span> <span class=\"token operator\">**</span><span class=\"token operator\">**</span>         <span class=\"token operator\">+</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span>          <span class=\"token operator\">**</span><span class=\"token operator\">**</span><span class=\"token operator\">+</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span>   \n                     <span class=\"token operator\">**</span><span class=\"token operator\">**</span><span class=\"token operator\">*</span>           <span class=\"token operator\">*</span>           <span class=\"token operator\">**</span><span class=\"token operator\">**</span><span class=\"token operator\">*</span>                     \n                          <span class=\"token operator\">**</span><span class=\"token operator\">**</span>       <span class=\"token operator\">*</span>       <span class=\"token operator\">**</span><span class=\"token operator\">**</span>                          \n                              <span class=\"token operator\">**</span><span class=\"token operator\">*</span>    <span class=\"token operator\">*</span>    <span class=\"token operator\">**</span><span class=\"token operator\">*</span>                              \n                             <span class=\"token operator\">+</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span>                              \n                             <span class=\"token operator\">|</span> route_output <span class=\"token operator\">|</span>                              \n                             <span class=\"token operator\">+</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span>                              \n                                     <span class=\"token operator\">*</span>                                     \n                                     <span class=\"token operator\">*</span>                                     \n                                     <span class=\"token operator\">*</span>                                     \n                            <span class=\"token operator\">+</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span>                            \n                            <span class=\"token operator\">|</span> StrOutputParser <span class=\"token operator\">|</span>                            \n                            <span class=\"token operator\">+</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span>                            \n                                     <span class=\"token operator\">*</span>                                     \n                                     <span class=\"token operator\">*</span>                                     \n                                     <span class=\"token operator\">*</span>                                     \n                        <span class=\"token operator\">+</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span>                          \n                        <span class=\"token operator\">|</span> StrOutputParserOutput <span class=\"token operator\">|</span>                          \n                        <span class=\"token operator\">+</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span></code></pre></div>\n<p>아름다운 그림이 나와요.</p>\n<p> </p>\n<p> </p>\n<h3 id=\"code-classlanguage-textrunnablebranchcode에서-routing\" style=\"position:relative;\"><a href=\"#code-classlanguage-textrunnablebranchcode%EC%97%90%EC%84%9C-routing\" aria-label=\"code classlanguage textrunnablebranchcode에서 routing permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><code class=\"language-text\">RunnableBranch</code>에서 Routing</h3>\n<p><code class=\"language-text\">RunnableBranch</code>는 <code class=\"language-text\">if-elif-else</code>의 <code class=\"language-text\">chain</code> 버전이라고 생각하시면 됩니다.</p>\n<p>우선, ”<code class=\"language-text\">route</code>를 정해주는 <code class=\"language-text\">route_chain</code> 생성”, ”<code class=\"language-text\">route</code>별 수행해야 할 <code class=\"language-text\">chain</code> 생성”을 한 후</p>\n<p><strong>교차로 역할인 <code class=\"language-text\">route</code> 함수에서 <code class=\"language-text\">if-elif-else</code>문을 <br><code class=\"language-text\">RunnableBranch</code>에서 3개의 <code class=\"language-text\">Runnable</code> 형식으로 나열해주면 됩니다</strong>.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> operator <span class=\"token keyword\">import</span> itemgetter\n<span class=\"token keyword\">from</span> langchain_core<span class=\"token punctuation\">.</span>runnables <span class=\"token keyword\">import</span> RunnableBranch\n\nbranch <span class=\"token operator\">=</span> RunnableBranch<span class=\"token punctuation\">(</span>\n    <span class=\"token comment\"># 주제에 \"수학\"이 포함되어 있는지 확인하고, 포함되어 있다면 math_chain을 실행합니다.</span>\n    <span class=\"token punctuation\">(</span><span class=\"token keyword\">lambda</span> x<span class=\"token punctuation\">:</span> <span class=\"token string\">\"수학\"</span> <span class=\"token keyword\">in</span> x<span class=\"token punctuation\">[</span><span class=\"token string\">\"topic\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>lower<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> math_chain<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\"># 주제에 \"과학\"이 포함되어 있는지 확인하고, 포함되어 있다면 science_chain을 실행합니다.</span>\n    <span class=\"token punctuation\">(</span><span class=\"token keyword\">lambda</span> x<span class=\"token punctuation\">:</span> <span class=\"token string\">\"과학\"</span> <span class=\"token keyword\">in</span> x<span class=\"token punctuation\">[</span><span class=\"token string\">\"topic\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>lower<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> science_chain<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\"># 위의 조건에 해당하지 않는 경우 general_chain을 실행합니다.</span>\n    general_chain<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># 주제와 질문을 입력받아 branch를 실행하는 전체 체인을 정의합니다.</span>\nfull_chain <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">{</span><span class=\"token string\">\"topic\"</span><span class=\"token punctuation\">:</span> route_chain<span class=\"token punctuation\">,</span> <span class=\"token string\">\"question\"</span><span class=\"token punctuation\">:</span> itemgetter<span class=\"token punctuation\">(</span><span class=\"token string\">\"question\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span> <span class=\"token operator\">|</span> branch <span class=\"token operator\">|</span> StrOutputParser<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p><code class=\"language-text\">RunnableBranch</code>안에서 <code class=\"language-text\">Runnable</code>인 <code class=\"language-text\">lamda</code> 함수로 if, elif, else 순으로 나열하면 됩니다.</p>\n<p><code class=\"language-text\">lamda</code> 함수는 <code class=\"language-text\">(lamda 입력: 조건, 실행할 것)</code> 식으로 작성하며<br>앞에서부터 해당하는 조건에서 실행됩니다.</p>\n<p> </p>\n<p> </p>\n<p>여기서 끊고 넘어가도록 하겠습니다. 👍🏻</p>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#chain-%EB%8D%B0%EC%BD%94%EB%A0%88%EC%9D%B4%ED%84%B0\">@chain 데코레이터</a></p>\n</li>\n<li>\n<p><a href=\"#helper-%ED%95%A8%EC%88%98%EC%99%80-wrapper-%ED%95%A8%EC%88%98\">Helper 함수와 Wrapper 함수</a></p>\n</li>\n<li>\n<p><a href=\"#configurable\">Configurable</a></p>\n<ul>\n<li><a href=\"#%EB%8F%99%EC%A0%81-%EB%B3%80%EA%B2%BD%EC%9D%84-%ED%97%88%EC%9A%A9%ED%95%A0-%EC%86%8D%EC%84%B1runnable-%EB%8C%80%EC%95%88-%EC%A0%95%EC%9D%98%ED%95%98%EB%8A%94-%EB%B0%A9%EB%B2%95\">동적 변경을 허용할 ‘속성/Runnable 대안’ 정의하는 방법</a></li>\n<li><a href=\"#%EC%86%8D%EC%84%B1%EC%9D%84-%EB%B3%80%EA%B2%BD%ED%95%98%EB%8A%94-%EB%B0%A9%EB%B2%95\">속성을 변경하는 방법</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#route\">Route</a></p>\n<ul>\n<li><a href=\"#runnablelambda%EC%97%90%EC%84%9C-routing\"><code class=\"language-text\">RunnableLambda</code>에서 Routing</a></li>\n<li><a href=\"#runnablebranch%EC%97%90%EC%84%9C-routing\"><code class=\"language-text\">RunnableBranch</code>에서 Routing</a></li>\n</ul>\n</li>\n</ul>\n</div>","excerpt":"참고 : 테디노트의 RAG 비법노트 (https://fastcampus.co.kr/data_online_teddy)소스코드: https://github.com/teddylee777/langchain-kr위키독스: https://wikidocs.net/book/14314   오늘은 정말 뜬금없이 갖가지 내용들을 끄적이고자 합니다..@chain 데코레이터, Configurable, Route 등에 대해 정리하고자 합니다. 레츠기릿   @chain 데코레이터 으로 가져와서 데코레이터를 이용해 함수를 으로 변환하도록 합시다. 즉, 은  객체이기 때문에 LCEL 인터페이스에 따라  메서드 등을 활용할 수 있습니다. chain.get_graph().print_ascii()로 체인의 그래프 출력 가능( 그래프 그리는 라이브러리 설치해야 함) 로 체인의 프롬프트 확인 가능 Helper 함수와 Wrapper 함수 Configurable 에 로 전달하는 딕셔너리()에서 주로 쓰는 약속된 키가 몇 가…","frontmatter":{"date":"January 13, 2026","title":"[LLM] 테디노트의 RAG 비법노트 끄적끄적-13","categories":"LLM RAG","author":"변우중","emoji":"☀️"},"fields":{"slug":"/26-01-13_1/"}},"next":{"id":"73d60c32-da40-5d8c-adea-c9b7352ed91c","html":"<p>참고 : 테디노트의 RAG 비법노트 (<a href=\"https://fastcampus.co.kr/data_online_teddy)\">https://fastcampus.co.kr/data_online_teddy)</a><br>소스코드: <a href=\"https://github.com/teddylee777/langchain-kr\">https://github.com/teddylee777/langchain-kr</a><br>위키독스: <a href=\"https://wikidocs.net/book/14314\">https://wikidocs.net/book/14314</a></p>\n<p> </p>\n<p>오랜만에 왔습니다!! (열심히 공부하고 왔습니다 🫡)</p>\n<p>Text Embedding와 Vectorstore, Retriver, Reranker는 워낙 모델이 많아서 모두 각각 정리하는 것보다는<br>RAG 개발 시 각 단계별로 고려할 점들을 정리해보는 것이 좋지 않을까 해서 가져왔습니다.</p>\n<p>고럼,, 레츠기릿~!</p>\n<p> </p>\n<h2 id=\"rag-개발-단계별-고려할-점\" style=\"position:relative;\"><a href=\"#rag-%EA%B0%9C%EB%B0%9C-%EB%8B%A8%EA%B3%84%EB%B3%84-%EA%B3%A0%EB%A0%A4%ED%95%A0-%EC%A0%90\" aria-label=\"rag 개발 단계별 고려할 점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>RAG 개발 단계별 고려할 점</h2>\n<hr>\n<p>각 단계에서 고려할 점들을 제 생각대로 정리해보았습니다. 떠오르는 부분들만 적어두었는데, 추가적으로 고려할 점들이 있다면 알려주시면 감사하겠습니다 😊</p>\n<h3 id=\"1-데이터-로드\" style=\"position:relative;\"><a href=\"#1-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EB%A1%9C%EB%93%9C\" aria-label=\"1 데이터 로드 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. <strong>데이터 로드</strong></h3>\n<ul>\n<li>데이터에 따라 로드 방식 설정</li>\n<li>PDF 등의 이미지의 문서의 경우 텍스트 OCR 모델 선정</li>\n</ul>\n<p> </p>\n<h3 id=\"2-텍스트-데이터-임베딩하면서-벡터스토어에-저장\" style=\"position:relative;\"><a href=\"#2-%ED%85%8D%EC%8A%A4%ED%8A%B8-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%9E%84%EB%B2%A0%EB%94%A9%ED%95%98%EB%A9%B4%EC%84%9C-%EB%B2%A1%ED%84%B0%EC%8A%A4%ED%86%A0%EC%96%B4%EC%97%90-%EC%A0%80%EC%9E%A5\" aria-label=\"2 텍스트 데이터 임베딩하면서 벡터스토어에 저장 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. <strong>텍스트 데이터 임베딩하면서 벡터스토어에 저장</strong></h3>\n<ul>\n<li>\n<p>이미지, 오디오, 비디오 등 데이터는 텍스트화 해놓은 것이 좋음</p>\n</li>\n<li>\n<p><strong>임베딩 모델 선정</strong>: <strong>임베딩 차원 수, 언어</strong> 등을 고려해야 합니다.</p>\n</li>\n<li>\n<p><strong>벡터스토어 선정</strong>: <strong>메타필터링</strong> 등 검색 시 기능들을 확인해야 합니다.</p>\n</li>\n<li>\n<p><strong>문서 요약을 넣을 것인지, 넣는다면 방법은?</strong><br>: ”<strong>나의 문서 요약이 검색에 활용하는 것이 좋은 방법인지</strong>“를 판단해야 합니다.</p>\n<ul>\n<li>\n<p><strong>요약 활용 방법</strong>: 문서를 다양한 방식으로 요약하여, 그 요약들을 벡터스토어에 함께 넣을 수 있습니다. <strong><code class=\"language-text\">MultiVectorRetriever</code></strong>는 요약된 텍스트의 원본 문서를 <code class=\"language-text\">docstore</code>에 지정하면서 <strong>검색된 문서가 요약된 텍스트이었을 때 해당 원본 문서를 가져오게끔</strong> 할 수도 있습니다.</p>\n</li>\n<li>\n<p><strong>요약 방식</strong>:</p>\n<ul>\n<li>\n<p><strong>단순히 청크별 요약</strong>하는 방식</p>\n</li>\n<li>\n<p><strong>RAPTOR</strong>(Recursive Abstractive Processing For Tree-Organized Retrieval) 활용</p>\n<blockquote>\n<p>유사한 청크들을 묶어 요약을 한 후<br>요약 텍스트들에서 유사한 것들을 묶어 <strong>재귀적으로 요약</strong>하는 방법</p>\n</blockquote>\n<p>개인적으로는</p>\n<blockquote>\n<p><strong>구조적인 문서(전체 내용이 논리적인 구조인 논문 등)에는 유리하지만<br>시계열 문서(대화 등)에는 어울리지 않는 방법</strong>이라 생각합니다.</p>\n</blockquote>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<p> </p>\n<h3 id=\"3-청킹-방식방법길이-설정\" style=\"position:relative;\"><a href=\"#3-%EC%B2%AD%ED%82%B9-%EB%B0%A9%EC%8B%9D%EB%B0%A9%EB%B2%95%EA%B8%B8%EC%9D%B4-%EC%84%A4%EC%A0%95\" aria-label=\"3 청킹 방식방법길이 설정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. <strong>청킹 방식/방법/길이 설정</strong></h3>\n<ul>\n<li><strong>청킹 방식</strong>: <strong>데이터와 retriever에 따라 결정</strong>\n<ul>\n<li>어떤 식으로 메타데이터를 구축 해놓을지</li>\n<li>부모/자식 문서 검색(청크를 더 쪼개어 자식 청크에서 부모 청크 찾음) 방법을 활용할지</li>\n<li>멀티벡터 검색(요약 등 다양한 형태 데이터를 만들어서 부모 청크 찾음) 방법을 활용할지 등등</li>\n</ul>\n</li>\n<li><strong>청킹 방법</strong>: <strong>Splitter 선정</strong>\n<ul>\n<li>재귀적으로 문자 단위를 분할할지</li>\n<li>토큰화 모델을 활용할지</li>\n<li>시맨틱 분할, 코드/마크다운/JSON 등 전용 분할 등등</li>\n</ul>\n</li>\n<li><strong>청크 길이</strong>: <strong>어느 정도 길이로 분할하는 것이 서로 유사한 정도가 잘 나올지 판단</strong><br>(검색은 쿼리와 데이터 각각 임베딩한 것을 바탕으로 유사한 것을 가져오는 bi-encoder 방식이기 때문에 청크 길이가 중요합니다.)</li>\n</ul>\n<p> </p>\n<h3 id=\"4-벡터스토어에서-retriever-설정\" style=\"position:relative;\"><a href=\"#4-%EB%B2%A1%ED%84%B0%EC%8A%A4%ED%86%A0%EC%96%B4%EC%97%90%EC%84%9C-retriever-%EC%84%A4%EC%A0%95\" aria-label=\"4 벡터스토어에서 retriever 설정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. <strong>벡터스토어에서 retriever 설정</strong></h3>\n<ul>\n<li>\n<p>Retriever는 쿼리와 문서를 각각 독립적으로 벡터화(Bi-encoder)하여<br>유사도(Dense)나 키워드 중요도(Sparse)를 계산해 원하는 정보를 찾아옵니다. <br>(리랭커보단 보통 빠른 방식임)</p>\n</li>\n<li>\n<p><strong>검색 방식</strong>: ”<strong>어떤 벡터를 쓸 것인가?</strong> (데이터에 따라 결정)</p>\n<ul>\n<li>\n<p><strong>Dense 검색</strong>(밀집 검색): ⭐️ <strong>의미적 검색</strong>할 때 사용 ⭐️</p>\n<ul>\n<li>보통 <strong>cosine 유사도</strong>로 점수 계산, 유클리드 거리, 내적 등도 존재</li>\n<li>문서의 임베딩 벡터와 쿼리의 임베딩 벡터 사이의 유사도를 계산함</li>\n</ul>\n</li>\n<li>\n<p><strong>Sparse 검색</strong>(희소 검색): ⭐️ <strong>키워드 검색</strong>할 때 사용 ⭐️</p>\n<ul>\n<li>\n<p>보통 TF-IDF, <strong>BM25</strong> 알고리즘으로 점수 계산</p>\n</li>\n<li>\n<p>문서의 <strong>토큰별 중요도(TF-IDF/BM25 가중치)</strong>가 미리 계산된 벡터(인덱스)와<br>쿼리의 <strong>토큰 존재 여부</strong>를 <strong>매칭(내적)</strong>하여 최종 점수를 계산함</p>\n<blockquote>\n<p><strong>“쿼리 단어(키워드)가 저 문서 벡터에 얼마나 중요하게(높은 점수로) 박혀있는가?”</strong>를 계산</p>\n</blockquote>\n</li>\n<li>\n<p>BM25은 문서 길이 길면 점수 페널티도 추가함</p>\n</li>\n</ul>\n</li>\n<li>\n<p>⭐️ <strong>Hybrid 검색</strong>: <strong>Dense + Sparse 결합</strong> ⭐️</p>\n<ul>\n<li>보통 <strong>RRF (Reciprocal Rank Fusion)</strong> 알고리즘을 사용 ⭐️</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><strong>결과 정제 및 선택</strong>: ”<strong>가져온 걸 어떻게 골라낼 것인가?</strong>”</p>\n<ul>\n<li><strong>유사한 k개 단순히 선정</strong></li>\n<li><strong>MMR(Maximum Marginal Relevance)</strong> 알고리즘을 이용하여 선정\n<ul>\n<li><strong>유사성 + ‘다양성’을 모두 고려하는 방식</strong></li>\n<li>즉, <strong>유사한 k개 먼저 가져오고, 그 k개 사이에서 다양하게 최종 선택하는 방법</strong> (서로 너무 유사한 것은 제외함)</li>\n<li>최대한 서로 유사한 내용들은 제외하고, 쿼리와 관련한 내용을 다양하게 가져오고 싶을 때 이용함</li>\n</ul>\n</li>\n<li>설정한 임계값 이상인 것들만 선정 등등</li>\n</ul>\n</li>\n</ul>\n<p> </p>\n<h3 id=\"5-reranker-선정\" style=\"position:relative;\"><a href=\"#5-reranker-%EC%84%A0%EC%A0%95\" aria-label=\"5 reranker 선정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>5. <strong>Reranker 선정</strong></h3>\n<ul>\n<li>\n<p>Reranker 모델은 Retriever와 적절히 조정하여 비용 &#x26; 성능 개선이 필요합니다.</p>\n<ul>\n<li>빠르게 많은 양을 검색해오고, 정확하게 리랭킹하는 방법</li>\n<li>Hybrid Search로 정밀하게 검색해오고, 가벼운 모델 사용 또는 키워드 매칭 정도로 리랭킹</li>\n</ul>\n<p>등등.. 시간, 경제적 비용과 성능 등을 고려하면서 정하면 됩니다.</p>\n</li>\n<li>\n<p><strong>표준 (Cross-encoder) 방법</strong></p>\n<ul>\n<li>쿼리와 문서를 하나로 결합해 <strong>Transformer의 Full Self-Attention</strong>을 수행하며, 문맥을 완벽히 파악한 뒤 **관련성 확률(Score)**을 직접 추론합니다. (속도는 느리지만 정확도 최고!!)</li>\n<li>즉, <strong>보통의 Reranker는 쿼리와 문서를 쌍으로 묶어 동시에 인코딩(Cross-encoder)한 후, 쿼리 각 토큰과 문서의 토큰들 사이의 관련성 점수를 계산하면서(Full Attention) 순위를 재조정합니다(느리지만 정확함).</strong></li>\n</ul>\n</li>\n<li>\n<p><strong>Late Interaction (예: ColBERT) 방법</strong>- 경량화 방법</p>\n<ul>\n<li>\n<p>쿼리와 문서를 <strong>독립적으로 임베딩</strong>한 뒤<br>마지막 단계에서 <strong>토큰별 최대 유사도(MaxSim)</strong>만 빠르게 계산하여 합산합니다.</p>\n<blockquote>\n<p><strong>Bi-encoder의 빠른 속도 + Cross-encoder의 높은 정확성</strong>을 가진 방법입니다.</p>\n</blockquote>\n</li>\n</ul>\n</li>\n<li>\n<p><strong>무료 오픈소스 Reranker 모델</strong></p>\n<ul>\n<li>\n<p><strong><code class=\"language-text\">BAAI/bge-reranker-v2-m3</code></strong>: 성능이 좋고, 유명함 ⭐️</p>\n</li>\n<li>\n<p><strong><code class=\"language-text\">FlashrankRerank</code> 모델</strong>( <code class=\"language-text\">ms-marco-MultiBERT-L-12</code> 등)<br>: <strong>Cross-encoder 방식이지만, 속도가 빠른 모델</strong></p>\n<ul>\n<li>\n<p>FlashrankRerank에서 MultiBERT 모델은 한국어도 지원합니다.</p>\n<p><a href=\"https://github.com/PrithivirajDamodaran/FlashRank\">FlashRank Github</a></p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 77.77777777777777%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAADC0lEQVQ4y02U2XrbNhCFedk0lkRxEwmQBPd9025JlmM7zubctS/Q93+J084ozteL84EAiBnwPzPUPi5szJYrlO0aZbtB0Uw8J9GeF6Rohh266cDPf84tmKuA358b7u+zUdbgTneg2Z6Cyhq00wHD9oRpf0GQVDAcHwvTg+snSIqOZa5CPkQBo7zF3PQwNwVkVMINMg6u5fWEol1DhBkHjosOQVxCtyWkylF1G84eJhXuFjbfmt5Ny/4WPNrATE9Yhrcv08KUggyI8p5HlXUI0xbGKoSMKl5L6wleWEC3fRiugiNT3rNFDFNksPwClsz5jNZtzhj3j6jHI5r1Cc10QtHvYcsM3eaC17e/cXl+w/n5B6rhAEukiMsJ29MzRFRB1A8Ixq/w20fYMoXmyJgzWZ6CsQpwp68wM1zmQ7cvuy2PWT3BkQkWpmCWXpjxOX0VwfBSLN0YC0tCow1yN6tGxHmLP+4MZkVuEqfjwwubdbp+ZnYfZiYsN0TdbyFVBt3vYecnmGrCjFwmHn5cI0gaVlKNPBpuhKjoUY8HNOOR2ZpeBMuLWboTwnQjWDJjfiSaa8Rpd37BsLsyy935M+rxHqZI0K5PeP35Fx5e3rA9v8ASCUvlAy7PP5C3G8jhO9LrPwiGL7C8CJpQJXQnwMwQvzW3bm5m9RrnT9/Qb86c3aTbCWKe3CQTrOIRXnEPJ+pgugraSibI6pFVdjeWaTlwUVPtUZes9xdQveqW4HUSdQlpKQoYfoOlKG91aIsIUhUQKucOkdHtmVymORlS9zt06yM2x0deo0r4qDucwPRrWNEI0284kabyHlSLxLIajlxrxFDGDfJ2i/PTd4z7K9bHT/BUyWbF5Yhmuue68/I9RHWBVxwYg+YGOXcGidx9d5z4xOXADttsxo0dsRRRCZV37LajWjjxCEf9YijCnNlRP7+zJI5U5CptsDs94f76isvTN+51qk9i9z4aQQ8r2cEI+xtDy1XMjX4EVLjeL+mWZLbddERSDminI9wg5R/C/03R3RRLWUH3Msz/C/gv/kO+h4r6d3AAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"img 1\" title=\"img 1\" src=\"/static/5ef07e554d875b76f562c2ebb9b207e9/37523/img_1.png\" srcset=\"/static/5ef07e554d875b76f562c2ebb9b207e9/e9ff0/img_1.png 180w,\n/static/5ef07e554d875b76f562c2ebb9b207e9/f21e7/img_1.png 360w,\n/static/5ef07e554d875b76f562c2ebb9b207e9/37523/img_1.png 720w,\n/static/5ef07e554d875b76f562c2ebb9b207e9/587b0/img_1.png 970w\" sizes=\"(max-width: 720px) 100vw, 720px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n</li>\n<li>\n<p><strong>Cross-encoder인데, 어떻게 빠른가?</strong></p>\n<p><strong>실행 환경(Runtime)과 최적화 기법(Optimization)</strong>의 차이 때문입니다.<br><strong><code class=\"language-text\">ms-marco</code> 모델들은 <code class=\"language-text\">MiniLM</code> 아키텍처를 기반으로 합니다.</strong></p>\n<blockquote>\n<p>Teacher 모델(BERT Large 등)의 지식을 <strong>지식 증류(Knowledge Distillation)</strong> 기법을 활용해 학습함으로써 <strong>파라미터 수와 연산량을 줄였습니다.</strong></p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th><strong>비교 항목</strong></th>\n<th><strong>기존 Cross-Encoder (PyTorch)</strong></th>\n<th><strong>FlashRank (ONNX)</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>연산 정밀도</strong></td>\n<td>Float32 (무거움)</td>\n<td><strong>Int8 (가벼움)</strong></td>\n</tr>\n<tr>\n<td><strong>실행 엔진</strong></td>\n<td>PyTorch (Eager execution)</td>\n<td><strong>ONNX Runtime (Graph optimized)</strong></td>\n</tr>\n<tr>\n<td><strong>의존성</strong></td>\n<td>Torch, Transformers (수 GB)</td>\n<td><strong>Numpy, Onnxruntime (수 MB)</strong></td>\n</tr>\n<tr>\n<td><strong>하드웨어</strong></td>\n<td>GPU 권장</td>\n<td><strong>CPU에서도 매우 빠름</strong></td>\n</tr>\n<tr>\n<td><strong>용도</strong></td>\n<td>연구 및 고성능 학습용</td>\n<td><strong>실서비스 배포(Inference)용</strong></td>\n</tr>\n</tbody>\n</table>\n</li>\n<li>\n<p><strong>실제로 사용했을 때, 어떠했는지?</strong><br>: 개인적으로는.. 우선 속도는 매우 빨랐지만 성능이 기대한만큼 나오지 않았습니다.</p>\n<p>다만!! 성능이 좋지 않게 나왔던 이유를 생각해봤을 때</p>\n<blockquote>\n<p><strong>청크를 쪼개는 방식의 문제였거나</strong> (여러 내용이 섞이지 않도록 더 잘게 또는 헤더를 이용한 청킹 방식 채택하는 것이 좋았을 듯)</p>\n<p><strong>한국어 성능이 생각보다 좋지 않은 모델이었거나</strong></p>\n<p><strong>키워드가 중요한 쿼리였는데, 의미적으로 비슷한 내용들이 많은 문서가 있었거나</strong><br>(하지만 이것은 검색된 충분한 문서를 LLM에게 쥐어줘서 답변하게끔 하면 될 것 같습니다.)</p>\n</blockquote>\n<p>이정도로 생각이 드네요.</p>\n<p>하지만, <strong>CPU로도 돌아갈 정도로 경량화되고 빠른 모델</strong> 장점은 포기 못합니다.. ㅎㅎ</p>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<p> </p>\n<p> </p>\n<p>다음 글에서는</p>\n<p>프로젝트에서 RAG 개발하면서 고민했던 점을 담아서 얘기를 할 것 같습니다.<br>(그렇지만 또 남기고 싶은 얘기가 있다면 그 얘기를 쓸지도…?)</p>\n<p>암튼 오늘도 봐주셔서 감사합니다 빠잇~!</p>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#rag-%EA%B0%9C%EB%B0%9C-%EB%8B%A8%EA%B3%84%EB%B3%84-%EA%B3%A0%EB%A0%A4%ED%95%A0-%EC%A0%90\">RAG 개발 단계별 고려할 점</a></p>\n<ul>\n<li><a href=\"#1-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EB%A1%9C%EB%93%9C\">1. <strong>데이터 로드</strong></a></li>\n<li><a href=\"#2-%ED%85%8D%EC%8A%A4%ED%8A%B8-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%9E%84%EB%B2%A0%EB%94%A9%ED%95%98%EB%A9%B4%EC%84%9C-%EB%B2%A1%ED%84%B0%EC%8A%A4%ED%86%A0%EC%96%B4%EC%97%90-%EC%A0%80%EC%9E%A5\">2. <strong>텍스트 데이터 임베딩하면서 벡터스토어에 저장</strong></a></li>\n<li><a href=\"#3-%EC%B2%AD%ED%82%B9-%EB%B0%A9%EC%8B%9D%EB%B0%A9%EB%B2%95%EA%B8%B8%EC%9D%B4-%EC%84%A4%EC%A0%95\">3. <strong>청킹 방식/방법/길이 설정</strong></a></li>\n<li><a href=\"#4-%EB%B2%A1%ED%84%B0%EC%8A%A4%ED%86%A0%EC%96%B4%EC%97%90%EC%84%9C-retriever-%EC%84%A4%EC%A0%95\">4. <strong>벡터스토어에서 retriever 설정</strong></a></li>\n<li><a href=\"#5-reranker-%EC%84%A0%EC%A0%95\">5. <strong>Reranker 선정</strong></a></li>\n</ul>\n</li>\n</ul>\n</div>","frontmatter":{"date":"January 11, 2026","title":"[LLM] 테디노트의 RAG 비법노트 끄적끄적-12 (RAG 개발 고려할 점)","categories":"LLM RAG","author":"변우중","emoji":"☀️"},"fields":{"slug":"/26-01-11_1/"}},"prev":{"id":"9873a81c-6667-5bd3-856c-57c33af2f27a","html":"<p>참고 : 테디노트의 RAG 비법노트 (<a href=\"https://fastcampus.co.kr/data_online_teddy)\">https://fastcampus.co.kr/data_online_teddy)</a><br>소스코드: <a href=\"https://github.com/teddylee777/langchain-kr\">https://github.com/teddylee777/langchain-kr</a><br>위키독스: <a href=\"https://wikidocs.net/book/14314\">https://wikidocs.net/book/14314</a></p>\n<p> </p>\n<p>글이 자주 올라오지 않는 것은<br>RAG와 Agent의 내용들은 프로젝트에 녹여서 끄적이고자 그렇습니다,,</p>\n<p>오늘은 아아아주 정말 메모장st 느낌의 글입니다. 다소 짧고 구조적이지 않습니다.</p>\n<p>레츠기릿,,</p>\n<p> </p>\n<h2 id=\"create_sql_query_chain\" style=\"position:relative;\"><a href=\"#create_sql_query_chain\" aria-label=\"create_sql_query_chain permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>create_sql_query_chain</h2>\n<hr>\n<p>DB에서 특정 값을 조회하기 위한 SQL 쿼리를 생성하고, 쿼리를 실행하는 방법에 대해 정리하고자 합니다.</p>\n<p>간단합니다.</p>\n<ol>\n<li>\n<p>SQL 쿼리를 생성하는 chain 생성 (DB를 연결하고, 쿼리 생성하는 LLM 선정)</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">\n<span class=\"token keyword\">from</span> langchain_core<span class=\"token punctuation\">.</span>prompts <span class=\"token keyword\">import</span> PromptTemplate\n\ndb <span class=\"token operator\">=</span> SQLDatabase<span class=\"token punctuation\">.</span>from_uri<span class=\"token punctuation\">(</span><span class=\"token string\">\"sqlite:///data/my_db.db\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># db의 dialect(어떤 db인지), 사용자 입력, 컬럼 설명 등을 넣음</span>\nprompt <span class=\"token operator\">=</span> PromptTemplate<span class=\"token punctuation\">.</span>from_template<span class=\"token punctuation\">(</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"Given an input question, first create a syntactically correct {dialect} query to run, then look at the results of the query and return the answer. Unless the user specifies in his question a specific number of examples he wishes to obtain, always limit your query to at most {top_k} results. You can order the results by a relevant column to return the most interesting examples in the database.\nUse the following format:\n\nQuestion: \"Question here\"\nSQLQuery: \"SQL Query to run\"\nSQLResult: \"Result of the SQLQuery\"\nAnswer: \"Final answer here\"\n\nOnly use the following tables:\n{table_info}\n\nHere is the description of the columns in the tables:\n`컬럼1`: 컬럼 설명\n`컬럼2`: 컬럼 설명\n`컬럼3`: 컬럼 설명\n\nQuestion: {input}\"\"\"</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>partial<span class=\"token punctuation\">(</span>dialect<span class=\"token operator\">=</span>db<span class=\"token punctuation\">.</span>dialect<span class=\"token punctuation\">)</span> <span class=\"token comment\"># db.dialect 넣음!!</span>\n\n<span class=\"token comment\"># sql 쿼리 생성 모델</span>\nllm <span class=\"token operator\">=</span> ChatOpenAI<span class=\"token punctuation\">(</span>model<span class=\"token operator\">=</span><span class=\"token string\">\"gpt-4o-mini\"</span><span class=\"token punctuation\">,</span> temperature<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># LLM, DB, prompt를 매개변수로 입력하여 chain 을 생성합니다.</span>\n<span class=\"token comment\"># ⭐️ prompt는 직접 넣어서 변경 가능함 ⭐️</span>\ncreate_query_chain <span class=\"token operator\">=</span> create_sql_query_chain<span class=\"token punctuation\">(</span>llm<span class=\"token punctuation\">,</span> db<span class=\"token punctuation\">,</span> prompt<span class=\"token punctuation\">)</span>\n\n\n<span class=\"token comment\"># 생성된 쿼리를 출력하기</span>\nanswer <span class=\"token operator\">=</span> create_query_chain<span class=\"token punctuation\">.</span>invoke<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"question\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"고객의 이름을 나열하세요\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>answer<span class=\"token punctuation\">.</span>__repr__<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n</li>\n<li>\n<p>쿼리를 실행하는 도구 생성</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> langchain_community<span class=\"token punctuation\">.</span>tools<span class=\"token punctuation\">.</span>sql_database<span class=\"token punctuation\">.</span>tool <span class=\"token keyword\">import</span> QuerySQLDataBaseTool\n\n<span class=\"token comment\"># 생성한 쿼리를 실행하기 위한 도구 생성</span>\nexecute_query <span class=\"token operator\">=</span> QuerySQLDataBaseTool<span class=\"token punctuation\">(</span>db<span class=\"token operator\">=</span>db<span class=\"token punctuation\">)</span></code></pre></div>\n</li>\n<li>\n<p>두 체인 연결</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">chain <span class=\"token operator\">=</span> create_query_chain <span class=\"token operator\">|</span> execute_query\nchain<span class=\"token punctuation\">.</span>invoke<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"question\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"민수의 이메일을 조회하세요\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li>create_query_chain의 결과가 execute_query의 query 변수에 들어가서 db에 조회합니다.</li>\n</ul>\n</li>\n</ol>\n<p> </p>\n<p> </p>\n<h2 id=\"추가-메모장\" style=\"position:relative;\"><a href=\"#%EC%B6%94%EA%B0%80-%EB%A9%94%EB%AA%A8%EC%9E%A5\" aria-label=\"추가 메모장 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>추가 메모장</h2>\n<hr>\n<ol>\n<li>\n<p>retriever를 그냥 호출하게 되면 page_content만 반환하므로, LLM에게 줄 추가적인 메타데이터는 프롬프트 템플릿을 통해 넣어야 한다.</p>\n</li>\n<li>\n<p>LangGraph에서 Reducer(add_messages, operator.add): 자동으로 리스트에 메시지를 추가해주는 기능</p>\n</li>\n<li>\n<p>TypedDict: dict에 타입힌팅 추가한 개념</p>\n</li>\n<li>\n<p>LangGraph 기본 개념</p>\n<ul>\n<li>\n<p>상태(State): 노드와 노드 간에 정보를 전달할 때 상태(State) 객체에 담아 전달함</p>\n</li>\n<li>\n<p>새로운 노드에서 값을 덮어쓰기 방식으로 채움</p>\n</li>\n<li>\n<p>GraphState 클래스를 TypedDict 클래스를 상속받아 보통 정의함</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> typing <span class=\"token keyword\">import</span> Annotated<span class=\"token punctuation\">,</span> TypedDict\n<span class=\"token keyword\">from</span> langgraph<span class=\"token punctuation\">.</span>graph<span class=\"token punctuation\">.</span>message <span class=\"token keyword\">import</span> add_messages\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">GraphState</span><span class=\"token punctuation\">(</span>TypedDict<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    question<span class=\"token punctuation\">:</span> Annotated<span class=\"token punctuation\">(</span><span class=\"token builtin\">list</span><span class=\"token punctuation\">,</span> add_messages<span class=\"token punctuation\">)</span>  <span class=\"token comment\"># 질문</span>\n    context<span class=\"token punctuation\">:</span> Annotated<span class=\"token punctuation\">(</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Context\"</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># 문서의 검색 결과</span>\n    answer<span class=\"token punctuation\">:</span>  Annotated<span class=\"token punctuation\">(</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Answer\"</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># 답변</span>\n    messages<span class=\"token punctuation\">:</span> Annotated<span class=\"token punctuation\">(</span><span class=\"token builtin\">list</span><span class=\"token punctuation\">,</span> add_messages<span class=\"token punctuation\">)</span>  <span class=\"token comment\"># 메시지</span>\n    relevance<span class=\"token punctuation\">:</span> Annotated<span class=\"token punctuation\">(</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"relevance\"</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># 관련성</span></code></pre></div>\n<ul>\n<li><code class=\"language-text\">question</code>, <code class=\"language-text\">messages</code>는 <code class=\"language-text\">Annotated(list, add_messages)</code>를 통해 리스트에 메시지를 계속 추가함</li>\n<li>다른 것들은 덮어쓰기로 상태를 저장함</li>\n</ul>\n</li>\n</ul>\n</li>\n</ol>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#create_sql_query_chain\">create_sql_query_chain</a></li>\n<li><a href=\"#%EC%B6%94%EA%B0%80-%EB%A9%94%EB%AA%A8%EC%9E%A5\">추가 메모장</a></li>\n</ul>\n</div>","frontmatter":{"date":"January 17, 2026","title":"[LLM] 테디노트의 RAG 비법노트 끄적끄적-14","categories":"LLM RAG","author":"변우중","emoji":"☀️"},"fields":{"slug":"/26-01-17_1/"}},"site":{"siteMetadata":{"siteUrl":"https://www.zoomkoding.com","comments":{"utterances":{"repo":"https://github.com/byeonwoojung/byeonwoojung.github.io"}}}}},"pageContext":{"slug":"/26-01-13_1/","nextSlug":"/26-01-11_1/","prevSlug":"/26-01-17_1/"}},"staticQueryHashes":["1073350324","1956554647","2938748437"]}