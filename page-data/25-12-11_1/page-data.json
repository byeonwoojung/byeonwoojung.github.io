{"componentChunkName":"component---src-templates-blog-template-js","path":"/25-12-11_1/","result":{"data":{"cur":{"id":"66d916a8-fe23-5bc2-a843-b9c1486dac94","html":"<p>참고 : 테디노트의 RAG 비법노트</p>\n<p>소스코드: <a href=\"https://github.com/teddylee777/langchain-kr\">https://github.com/teddylee777/langchain-kr</a></p>\n<p> </p>\n<p>지난 번 토큰화 관련해서 공부하고 블로그도 썼지만, 관련 내용 이해와 내면화 사이의 괴리가 있었다.\n그런데, 갓 테디노트님 강의 들으면서 그 괴리를 좁혀나갈 수 있었던 것 같다^^&#x3C; 굳👍🏻</p>\n<p>(오늘 게시글은 진짜 두서없이 깨알 Tip 넣을 것임다… 너무 뜬금 없어도 이해부탁…)</p>\n<p> </p>\n<h2 id=\"서브워드-기반-토큰화-왜-하는-것인가\" style=\"position:relative;\"><a href=\"#%EC%84%9C%EB%B8%8C%EC%9B%8C%EB%93%9C-%EA%B8%B0%EB%B0%98-%ED%86%A0%ED%81%B0%ED%99%94-%EC%99%9C-%ED%95%98%EB%8A%94-%EA%B2%83%EC%9D%B8%EA%B0%80\" aria-label=\"서브워드 기반 토큰화 왜 하는 것인가 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>서브워드 기반 토큰화 왜 하는 것인가?</h2>\n<hr>\n<p><strong>문자 기반 토큰화</strong>(한국어는 자모 단위로 토큰화)는 너무 쪼개니까 편집거리를 이용해 검색어 추천, 오타 교정 정도에 활용할 수 있는데,</p>\n<p><strong>텍스트 문장 생성에서는 너무 많이 분절해놓으니, 이렇게 쪼갠 것을 모델이 학습하고 이걸 생성해내기가 어려워진다.(모델이 생성해야하는 묶음이 더 많아짐!!)\n(우리한테 자모음들을 막 뿌려 주고, 텍스트 문장 만들라고 시켜보면 얼마나 힘든가…)</strong></p>\n<p>단어 기반 토큰화는 텍스트 문장 생성에 효과적일 수 있다지만, 지난 블로그 글에 남겼듯이 자주 사용하는 단어들이 있잖아..?\n고런 것들도 고려하려면 <strong>서브워드 기반 토큰화</strong>를 통해서 <strong>단어 사전 만드는 것</strong>이 좋지~~</p>\n<p>그. 이. 후. 그 토큰별로 벡터화 시키는 것이다!!! -> 그 하나가 1토큰임 -> 즉, <strong>토큰화 잘하면 토큰 사용량 줄일 수 있다</strong>!!!!</p>\n<p> </p>\n<h2 id=\"한국어-버전-토큰화-vs-영어-버전-토큰화\" style=\"position:relative;\"><a href=\"#%ED%95%9C%EA%B5%AD%EC%96%B4-%EB%B2%84%EC%A0%84-%ED%86%A0%ED%81%B0%ED%99%94-vs-%EC%98%81%EC%96%B4-%EB%B2%84%EC%A0%84-%ED%86%A0%ED%81%B0%ED%99%94\" aria-label=\"한국어 버전 토큰화 vs 영어 버전 토큰화 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>한국어 버전 토큰화 vs 영어 버전 토큰화</h2>\n<hr>\n<h3 id=\"한국어-버전\" style=\"position:relative;\"><a href=\"#%ED%95%9C%EA%B5%AD%EC%96%B4-%EB%B2%84%EC%A0%84\" aria-label=\"한국어 버전 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>한국어 버전</h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 57.77777777777777%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAACHUlEQVQoz42TSU8bQRCF5/+fIgVErBgwhC0SipJbpOQQFMEBCzwe7xgbkjFeZvWMx559vqjbznYhKenpVZe6q0vvdSuapqGqKrVaDc/z+FcURSE5CALSNEUsRS3Pc8nK09MY07LQRyOm0xm2beM4DrZl4dg2i2Al4bpzVmFEkuYkaUYUxcRJulmva3leoPy8WdywWi7xfV/mf8YyTHD8JXGckSQxYZQRJhmRaBwnpHFCGKXynPLm5JyD43NKeyeUykeU908p7R2zXTrg8OQdrytvqdVbdPrf+dJqoDYvuOncUet26bWHdFWdW62J9liFHJRy5ZSXO/tslw7ZKR9xfPae3coZW6UDtl5VeLG1S/W2RrNxzderGpcXN1xcf+Kqeol69YHPapWPnQb1QQcKUFzHZjadYFsmxmyKaRrYtsncdSRc1ybLcmamiznxMMZzxmMHfWIzMoeYnkEURazCeK2hYZiMRiN0XUfXR0wmE+aeRygMSFLiOF4LXkAm3CyQkO7mQntIs0Ia85cpz0WSpnj+An+xxPMD/EXwiyX8gEWwXDcUzojkN29QrFm6vArpdO8kGs023V6fZquzqfVk3r8fCglRxGN8DiLCKOJ+8CAbiYMi7931abW79PsD2p0uw4dvcq/yP78iimM5RV1rbKZsoTVaqHVNNhP5YPi4bvg/E6Zphmk5TKYGhmFhWjaGaWM7LlGUSIfDKJEa/gA+4IDnaYFF5AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"img 1\" title=\"img 1\" src=\"/static/88295fffbab9d7c05b261c6581cca526/37523/img_1.png\" srcset=\"/static/88295fffbab9d7c05b261c6581cca526/e9ff0/img_1.png 180w,\n/static/88295fffbab9d7c05b261c6581cca526/f21e7/img_1.png 360w,\n/static/88295fffbab9d7c05b261c6581cca526/37523/img_1.png 720w,\n/static/88295fffbab9d7c05b261c6581cca526/302a4/img_1.png 1080w,\n/static/88295fffbab9d7c05b261c6581cca526/07a9c/img_1.png 1440w,\n/static/88295fffbab9d7c05b261c6581cca526/5ab15/img_1.png 2446w\" sizes=\"(max-width: 720px) 100vw, 720px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n<h3 id=\"영어-버전\" style=\"position:relative;\"><a href=\"#%EC%98%81%EC%96%B4-%EB%B2%84%EC%A0%84\" aria-label=\"영어 버전 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>영어 버전</h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 59.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAACIklEQVQoz4WTTWsTURSG57+KC61CUaQglS5cFNy5ceFSf4AIulCqRis1YiptMpmZzCSTpEmbz/nKZJLM5yNzp2mDSD3w8N47F86cc99zJVmWKZVKlMtlVFUljyRJrkjTVLCOLMuExnGM53nFeZaRphlJkiIFQcB8HjDzffr9c0ajEd5shut5OI6L7/ssViGOW+zDKLkkJorTjX2BtPn3PLlIsFiwGVGS4i+WeMGSMIxYLROWy4xVGLKMI1ZhQriKiKIIyWx3qas6umFycipTq6tUawpqw6DT7WO2z9BbXXr9CT9O+5yoP5G1dxw0DCrKMVq1iqq0qWgyQ6uL9OLla27decT9h3vc3d5lZ3efx3vP2Nre5d6DJ9ze2uHp/nMqSp23n79yePSRo2+f+FD6zqvjCgfl37z/dciXozd0u8dIeXuj4ZDxeCzuL2c6nWLb1pXmMXUsdMNgoNU5UwZ01AnjiYXrzjj3XC6csfBCsm0bXdfpdDq0Wi2azSamaQrt9Xpind9rmkHub7pBkhZkCeRWxLnL67HIxyET9qf/ZB4scD2fmT/HExrgzxdi788DwSqMkNZzVSS8nDWudX0+GI6pyQqapgut1upUazJyXRXk3yzbQRJDeRNpUbntuOhGC1XTMZomzVYbRdFo6IZYaw2DycRC4j+xrjBvs9Pt0WyZXAxGov2p5YiqLNstDPJmRcs3UySN4uvXkL+QnDjJ/iLlD/iHgTUfW3h+AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"img 2\" title=\"img 2\" src=\"/static/45bdf123ade94eda3c30734a1d02df1f/37523/img_2.png\" srcset=\"/static/45bdf123ade94eda3c30734a1d02df1f/e9ff0/img_2.png 180w,\n/static/45bdf123ade94eda3c30734a1d02df1f/f21e7/img_2.png 360w,\n/static/45bdf123ade94eda3c30734a1d02df1f/37523/img_2.png 720w,\n/static/45bdf123ade94eda3c30734a1d02df1f/302a4/img_2.png 1080w,\n/static/45bdf123ade94eda3c30734a1d02df1f/07a9c/img_2.png 1440w,\n/static/45bdf123ade94eda3c30734a1d02df1f/b0bb3/img_2.png 2344w\" sizes=\"(max-width: 720px) 100vw, 720px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n<p>그림에서 오른쪽 형관펜으로 칠한 만큼 각각 한 토큰이다. 같은 문장이지만, 영어 버전이 토큰이 적게 든다.\n즉, 비용을 줄이긴 위해선 영어로 바꿔서 하는 것이 좋다.</p>\n<p>그리고, 모델에 한국어 서브워드를 학습시킨다면 더 좋을 수 있지 않겠는가,,,,\n(학습 비용이 더 들 수는 있는데, LLM Post Training이 필요한 프로젝트가 있다면 반드시 고려해볼만 하다.)\n한국어 버전에서 확인할 수 있듯이 ‘안녕하세요’는 ‘안’+‘녕하세요’ 2개 토큰으로 인식하고 있다. ‘열심히’도 ‘열’ + ‘심’ + ‘히’ 3개 토큰으로 인식하고 있다.\n(요즘은 예전보다는 gpt의 한국어 토큰 최적화 잘 되어 있다고 하지만, 어쨌든 토큰 최적화를 위해 이정도는 알아 두자,, 지금은 GPT-5.1까지 나왔는데 나중에 확인 ㄱㄱ)</p>\n<p>서브워드의 중요성 인식 완.</p>\n<p> </p>\n<blockquote>\n<h3 id=\"깨알-tip\" style=\"position:relative;\"><a href=\"#%EA%B9%A8%EC%95%8C-tip\" aria-label=\"깨알 tip permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>💡깨알 Tip</h3>\n<p>멀티모달 GPT 사용시 LangChain의 HumanMessage를 이용한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># HumanMessage 안에 이미지와 텍스트를 같이 넣는 방법</span>\n<span class=\"token keyword\">from</span> langchain_openai <span class=\"token keyword\">import</span> ChatOpenAI\n<span class=\"token keyword\">from</span> langchain_core<span class=\"token punctuation\">.</span>messages <span class=\"token keyword\">import</span> HumanMessage\n\n<span class=\"token comment\"># GPT-4o / GPT-4.1 등 멀티모달 지원 모델</span>\nllm <span class=\"token operator\">=</span> ChatOpenAI<span class=\"token punctuation\">(</span>\n    model<span class=\"token operator\">=</span><span class=\"token string\">\"gpt-4o-mini\"</span><span class=\"token punctuation\">,</span> \n    temperature<span class=\"token operator\">=</span><span class=\"token number\">0.1</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 예시 이미지</span>\nimage_url <span class=\"token operator\">=</span> <span class=\"token string\">\"https://example.com/cat.png\"</span>\n\nmessages <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n    HumanMessage<span class=\"token punctuation\">(</span>\n        content<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span>\n            <span class=\"token punctuation\">{</span><span class=\"token string\">\"type\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"text\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"text\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"이 이미지에 무엇이 보여?\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">{</span>\n                <span class=\"token string\">\"type\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"image_url\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string\">\"image_url\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"url\"</span><span class=\"token punctuation\">:</span> image_url<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n</blockquote>\n<p> </p>\n<h2 id=\"lcellangchain-expression-language\" style=\"position:relative;\"><a href=\"#lcellangchain-expression-language\" aria-label=\"lcellangchain expression language permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>LCEL(LangChain Expression Language)</h2>\n<hr>\n<p>chain = prompt | model | output_parser\n가장 기본적인 chain 형태이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> langchain_openai <span class=\"token keyword\">import</span> ChatOpenAI\n<span class=\"token comment\"># from langchain_teddynote.messages import stream_response  # teddynote 스트리밍 출력 (for문 사용하지 않고도 쉽게 출력되도록 되어 있음)</span>\n<span class=\"token keyword\">from</span> langchain_core<span class=\"token punctuation\">.</span>prompts <span class=\"token keyword\">import</span> PromptTemplate\n\nprompt <span class=\"token operator\">=</span> PromptTemplate<span class=\"token punctuation\">.</span>from_template<span class=\"token punctuation\">(</span><span class=\"token string\">\"{topic}에 대해 {how} 설명해주세요.\"</span><span class=\"token punctuation\">)</span>\noutput_parser <span class=\"token operator\">=</span> StrOutputParser<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\nmodel <span class=\"token operator\">=</span> ChatOpenAI<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nchain <span class=\"token operator\">=</span> prompt <span class=\"token operator\">|</span> model <span class=\"token operator\">|</span> output_parser</code></pre></div>\n<p>chain을 출력해서 보면</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">PromptTemplate(input_variables=['how', 'topic'], input_types={}, partial_variables={}, template='{topic} 에 대해 {how} 설명해주세요.')\n| ChatOpenAI(client=&lt;openai.resources.chat.completions.completions.Completions object at 0x1751c8650>, async_client=&lt;openai.resources.chat.completions.completions.AsyncCompletions object at 0x175156110>, root_client=&lt;openai.OpenAI object at 0x15ffe7b90>, root_async_client=&lt;openai.AsyncOpenAI object at 0x1751c9290>, model_name='gpt-4.1-nano', temperature=0.1, model_kwargs={}, openai_api_key=SecretStr('**********'))\n| StrOutputParser()</code></pre></div>\n<p>이렇게 연결됨을 알 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token builtin\">input</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"topic\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"인공지능 모델의 학습 원리\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"how\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"5살짜리 어린 아이에게도 이해할 수 있도록 쉽게\"</span><span class=\"token punctuation\">}</span>\n\nchain<span class=\"token punctuation\">.</span>invoke<span class=\"token punctuation\">(</span><span class=\"token builtin\">input</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>input에서 딕셔너리 형태로 변수 값을 넣어주고, chain에 invoke() 함수에 던져주면 값을 한번에 생성해서 보여줍니다.\n(참고1: 변수가 1개일 때는 딕셔너리가 아닌 문자열로 던져줘도 가능하다)\n(참고2: stream() 함수에 넣어주고 for문으로 출력하면 실시간으로 출력 토큰을 출력가능하다)</p>\n<p>이때는 <strong>모든 변수의 값을 넣어주어야 오류가 나지 않는다</strong>.</p>\n<p>그리고, 출력 결과는 chain = prompt | model | output_parser 이므로\n<strong>model에서 나온 output의 content !!!! 부분</strong>을 string 형태로 파싱하여 나온다!!\n(<strong>참고3: chain = prompt | model 의 결과는 model 객체가 나와서 content, response_metadata 등 클래스 속성들 모두 결과로 갖는다</strong>)</p>\n<p> </p>\n<blockquote>\n<h3 id=\"깨알-tip-1\" style=\"position:relative;\"><a href=\"#%EA%B9%A8%EC%95%8C-tip-1\" aria-label=\"깨알 tip 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>💡깨알 Tip</h3>\n<p>중괄호 {{}}를 겹쳐 쓰면 변수로 인식하지 않고 중괄호 2쌍으로 인식한다.\n(f-string 방식은 중괄호 겹쳐 쓰면 중괄호 1쌍으로 인식하는데 prompt 템플릿에 넣으면 두쌍으로 인식됨… 왜 그런지는 이해가 안가요..)</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">template <span class=\"token operator\">=</span> <span class=\"token string\">\"{{question}}과 같이 중괄호 겹쳐 쓰면 변수로 인식하지 않는다.\"</span>\ntemplate\n<span class=\"token comment\"># '{{question}}과 같이 중괄호 겹쳐 쓰면 변수로 인식하지 않는다.'</span></code></pre></div>\n</blockquote>\n<p> </p>\n<p>아, invoke() 출력과 stream() 출력 방법 비교도 해보자.</p>\n<h3 id=\"invoke-출력-답변-완성-후-출력\" style=\"position:relative;\"><a href=\"#invoke-%EC%B6%9C%EB%A0%A5-%EB%8B%B5%EB%B3%80-%EC%99%84%EC%84%B1-%ED%9B%84-%EC%B6%9C%EB%A0%A5\" aria-label=\"invoke 출력 답변 완성 후 출력 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>invoke() 출력: 답변 완성 후 출력</h3>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">answer <span class=\"token operator\">=</span> llm<span class=\"token punctuation\">.</span>stream<span class=\"token punctuation\">(</span><span class=\"token string\">\"대한민국의 아름다운 관광지 10곳과 주소를 알려주세요!\"</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3 id=\"stream-출력-실시간-출력\" style=\"position:relative;\"><a href=\"#stream-%EC%B6%9C%EB%A0%A5-%EC%8B%A4%EC%8B%9C%EA%B0%84-%EC%B6%9C%EB%A0%A5\" aria-label=\"stream 출력 실시간 출력 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>stream() 출력: 실시간 출력</h3>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\">### 갓 테디노트님이 만드신 것 활용</span>\n<span class=\"token keyword\">from</span> langchain_openai <span class=\"token keyword\">import</span> ChatOpenAI\n<span class=\"token keyword\">from</span> langchain_teddynote<span class=\"token punctuation\">.</span>messages <span class=\"token keyword\">import</span> stream_response\n\n<span class=\"token comment\"># 객체 생성</span>\nllm <span class=\"token operator\">=</span> ChatOpenAI<span class=\"token punctuation\">(</span>\n    temperature<span class=\"token operator\">=</span><span class=\"token number\">0.1</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># 창의성 (0.0 ~ 2.0)</span>\n    model_name<span class=\"token operator\">=</span><span class=\"token string\">\"gpt-4.1-nano\"</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># 모델명</span>\n<span class=\"token punctuation\">)</span>\nanswer <span class=\"token operator\">=</span> llm<span class=\"token punctuation\">.</span>stream<span class=\"token punctuation\">(</span><span class=\"token string\">\"대한민국의 아름다운 관광지 10곳과 주소를 알려주세요!\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 최종 결과물 토큰별 누적하면서 실시간 출력</span>\nfinal_ansewer2 <span class=\"token operator\">=</span> stream_response<span class=\"token punctuation\">(</span>answer<span class=\"token punctuation\">,</span> return_output<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\">### 국룰 방법</span>\n<span class=\"token keyword\">from</span> langchain_openai <span class=\"token keyword\">import</span> ChatOpenAI\n\n<span class=\"token comment\"># 객체 생성</span>\nllm <span class=\"token operator\">=</span> ChatOpenAI<span class=\"token punctuation\">(</span>\n    temperature<span class=\"token operator\">=</span><span class=\"token number\">0.1</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># 창의성 (0.0 ~ 2.0)</span>\n    model_name<span class=\"token operator\">=</span><span class=\"token string\">\"gpt-4.1-nano\"</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># 모델명</span>\n<span class=\"token punctuation\">)</span>\n\nanswer <span class=\"token operator\">=</span> llm<span class=\"token punctuation\">.</span>stream<span class=\"token punctuation\">(</span><span class=\"token string\">\"대한민국의 아름다운 관광지 10곳과 주소를 알려주세요!\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 최종 결과물 토큰별 누적하면서 실시간 출력</span>\nfinal_answer <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span>  <span class=\"token comment\"># 최종 결과물 토큰 누적시킬 변수</span>\n<span class=\"token keyword\">for</span> token <span class=\"token keyword\">in</span> answer<span class=\"token punctuation\">:</span>\n    <span class=\"token comment\"># token.content: 각 토큰 별로 담긴 내용</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">.</span>content<span class=\"token punctuation\">,</span> end<span class=\"token operator\">=</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> flush<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n    final_answer <span class=\"token operator\">+=</span> token<span class=\"token punctuation\">.</span>content</code></pre></div>\n<p><strong>.stream() 한다고 바로 호출되는 것이 아니고, for문을 통해 실시간으로 호출되면서 응답을 받는다.</strong></p>\n<p> </p>\n<p> </p>\n<p>일단 여기서 끝.</p>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#%EC%84%9C%EB%B8%8C%EC%9B%8C%EB%93%9C-%EA%B8%B0%EB%B0%98-%ED%86%A0%ED%81%B0%ED%99%94-%EC%99%9C-%ED%95%98%EB%8A%94-%EA%B2%83%EC%9D%B8%EA%B0%80\">서브워드 기반 토큰화 왜 하는 것인가?</a></p>\n</li>\n<li>\n<p><a href=\"#%ED%95%9C%EA%B5%AD%EC%96%B4-%EB%B2%84%EC%A0%84-%ED%86%A0%ED%81%B0%ED%99%94-vs-%EC%98%81%EC%96%B4-%EB%B2%84%EC%A0%84-%ED%86%A0%ED%81%B0%ED%99%94\">한국어 버전 토큰화 vs 영어 버전 토큰화</a></p>\n<ul>\n<li><a href=\"#%ED%95%9C%EA%B5%AD%EC%96%B4-%EB%B2%84%EC%A0%84\">한국어 버전</a></li>\n<li><a href=\"#%EC%98%81%EC%96%B4-%EB%B2%84%EC%A0%84\">영어 버전</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#lcellangchain-expression-language\">LCEL(LangChain Expression Language)</a></p>\n<ul>\n<li><a href=\"#invoke-%EC%B6%9C%EB%A0%A5-%EB%8B%B5%EB%B3%80-%EC%99%84%EC%84%B1-%ED%9B%84-%EC%B6%9C%EB%A0%A5\">invoke() 출력: 답변 완성 후 출력</a></li>\n<li><a href=\"#stream-%EC%B6%9C%EB%A0%A5-%EC%8B%A4%EC%8B%9C%EA%B0%84-%EC%B6%9C%EB%A0%A5\">stream() 출력: 실시간 출력</a></li>\n</ul>\n</li>\n</ul>\n</div>","excerpt":"참고 : 테디노트의 RAG 비법노트 소스코드: https://github.com/teddylee777/langchain-kr   지난 번 토큰화 관련해서 공부하고 블로그도 썼지만, 관련 내용 이해와 내면화 사이의 괴리가 있었다.\n그런데, 갓 테디노트님 강의 들으면서 그 괴리를 좁혀나갈 수 있었던 것 같다^^< 굳👍🏻 (오늘 게시글은 진짜 두서없이 깨알 Tip 넣을 것임다… 너무 뜬금 없어도 이해부탁…)   서브워드 기반 토큰화 왜 하는 것인가? 문자 기반 토큰화(한국어는 자모 단위로 토큰화)는 너무 쪼개니까 편집거리를 이용해 검색어 추천, 오타 교정 정도에 활용할 수 있는데, 텍스트 문장 생성에서는 너무 많이 분절해놓으니, 이렇게 쪼갠 것을 모델이 학습하고 이걸 생성해내기가 어려워진다.(모델이 생성해야하는 묶음이 더 많아짐!!)\n(우리한테 자모음들을 막 뿌려 주고, 텍스트 문장 만들라고 시켜보면 얼마나 힘든가…) 단어 기반 토큰화는 텍스트 문장 생성에 효과적일 수 있다지만, 지난 블…","frontmatter":{"date":"December 11, 2025","title":"[LLM] 테디노트의 RAG 비법노트 끄적끄적-1","categories":"NLP LLM","author":"변우중","emoji":"☀️"},"fields":{"slug":"/25-12-11_1/"}},"next":{"id":"510447e4-7933-5a0e-b6aa-8ea9e7284203","html":"<p>참고 : 윤대희 외. (2023). <em>파이토치 트랜스포머를 활용한 자연어 처리와 컴퓨터비전 심층학습</em>. 위키북스.</p>\n<p>소스코드: <a href=\"https://github.com/wikibook/pytorchtrf\">https://github.com/wikibook/pytorchtrf</a></p>\n<p>위의 교재와 소스코드를 참고하였으며, 대부분의 내용은 직접 찾아보며 학습하였습니다.</p>\n<p> </p>\n<p>자연어 처리에서 토큰화하는 것에 대해 알아보자.</p>\n<p>토큰을 나누는 기준은 공백 분할, 정규표현식 사용, 어휘사전 적용, 머신러닝 활용하는 방법이 있다. <strong>어휘 사전</strong>을 구축할 때, 너무 크게 구축하면 차원의 저주에 빠지고, 너무 작게 구축하면 OOV(Out of Vocab) 존재 가능성이 있으므로 그 크기를 적절히 정해야 하며, <strong>출현빈도는 고려되지만 순서관계는 표현하지 못한다는 점</strong>을 기억하자.</p>\n<p> </p>\n<h2 id=\"토큰화-라이브러리\" style=\"position:relative;\"><a href=\"#%ED%86%A0%ED%81%B0%ED%99%94-%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC\" aria-label=\"토큰화 라이브러리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>토큰화 라이브러리</h2>\n<hr>\n<h3 id=\"jamo-라이브러리\" style=\"position:relative;\"><a href=\"#jamo-%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC\" aria-label=\"jamo 라이브러리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>jamo 라이브러리</h3>\n<ul>\n<li>\n<p>h2j (Hangul to Jamo): 한글 → 자모(자음과 모음 / 한글 글자를 초성,중성,종성 단위로 쪼갬) 변환한다.\n자모 단위로 쪼개었을 때 → 음운단위 학습 가능해져, <strong>희귀단어</strong>나 <strong>신조어 처리</strong>에 유리하다.</p>\n</li>\n<li>\n<p>j2hcj (Jamo to Hangul ConJoining): 자모 → 한글 변환한다. (초성+중성+(종성) 다시 합쳐 완전한 한글글자 만듦)</p>\n</li>\n</ul>\n<p> </p>\n<h3 id=\"konlpy-라이브러리\" style=\"position:relative;\"><a href=\"#konlpy-%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC\" aria-label=\"konlpy 라이브러리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>KoNLPy 라이브러리</h3>\n<ul>\n<li>KoNLPy: 한국어 형태소 분석 라이브러리</li>\n<li>Okt: “Open Korean Text” 형태소 분석기</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> konlpy<span class=\"token punctuation\">.</span>tag <span class=\"token keyword\">import</span> Okt\n\nokt <span class=\"token operator\">=</span> Okt<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\ntext <span class=\"token operator\">=</span> <span class=\"token string\">\"한글 자연어 처리를 공부해봅시다.\"</span>\n\n<span class=\"token comment\"># 형태소 분석</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>okt<span class=\"token punctuation\">.</span>morphs<span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># ['한글', '자연어', '처리', '를', '공부', '해봅시다', '.']</span>\n\n<span class=\"token comment\"># 형태소 + 품사 태깅</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>okt<span class=\"token punctuation\">.</span>pos<span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># [('한글', 'Noun'), ('자연어', 'Noun'), ('처리', 'Noun'),</span>\n<span class=\"token comment\">#  ('를', 'Josa'), ('공부', 'Noun'), ('해봅시다', 'Verb'), ('.', 'Punctuation')]</span>\n\n<span class=\"token comment\"># 명사 추출</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>okt<span class=\"token punctuation\">.</span>nouns<span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># ['한글', '자연어', '처리', '공부']</span>\n\n<span class=\"token comment\"># 구 추출 - 연속된 명사 묶음을 그대로 반환</span>\n<span class=\"token keyword\">print</span> <span class=\"token punctuation\">(</span>okt<span class=\"token punctuation\">.</span>phrases<span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># ['한글', '한글 자연어', '한글 자연어 처리', '공부', '자연어', '처리']</span></code></pre></div>\n<ul>\n<li>Kkma (꼬꼬마): 서울대학교 IDS(Intelligent Data Systems) 연구실에서 개발한 한국어 형태소/구문 분석기\n<ul>\n<li>꼬꼬마는 <code class=\"language-text\">Okt</code>보다 <strong>세밀한 품사 태깅</strong>이 가능하다. (예: 구체적인 조사 구분)</li>\n<li>문장 분리(splitting) 기능이 기본 제공된다.</li>\n<li>속도는 Okt보다 느린 편이지만, 정확성은 높다.</li>\n</ul>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> konlpy<span class=\"token punctuation\">.</span>tag <span class=\"token keyword\">import</span> Kkma\n\nkkma <span class=\"token operator\">=</span> Kkma<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\ntext <span class=\"token operator\">=</span> <span class=\"token string\">\"한글 자연어 처리를 공부해봅시다.\"</span>\n\n<span class=\"token comment\"># 형태소 분석</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>kkma<span class=\"token punctuation\">.</span>morphs<span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># ['한글', '자연어', '처리', '를', '공부', '해보', 'ㅂ시다', '.'] -> ㅂ시다!!!</span>\n\n<span class=\"token comment\"># 형태소 + 품사 태깅</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>kkma<span class=\"token punctuation\">.</span>pos<span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># [('한글', 'NNG'), ('자연어', 'NNG'), ('처리', 'NNG'), ('를', 'JKO'),</span>\n<span class=\"token comment\"># ('공부', 'NNG'), ('해보', 'VV'), ('ㅂ시다', 'EFA'), ('.', 'SF')]</span>\n\n\n<span class=\"token comment\"># 명사 추출</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>kkma<span class=\"token punctuation\">.</span>nouns<span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># ['한글', '자연어', '처리', '공부']</span>\n\n<span class=\"token comment\"># 문장 추출</span>\n<span class=\"token keyword\">print</span> <span class=\"token punctuation\">(</span>kkma<span class=\"token punctuation\">.</span>sentences<span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># ['한글 자연어 처리를 공부 해봅시다.']</span></code></pre></div>\n<p> </p>\n<h3 id=\"nltknatural-language-toolkit-라이브러리\" style=\"position:relative;\"><a href=\"#nltknatural-language-toolkit-%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC\" aria-label=\"nltknatural language toolkit 라이브러리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>NLTK(Natural Language Toolkit) 라이브러리</h3>\n<ul>\n<li>NLTK 라이브러리는 토큰화(tokenization), 품사 태깅, 파싱, 텍스트 분류, 코퍼스 제공 등 다양한 기능을 지원한다.</li>\n<li>영어 기반이라 한국어 토큰화는 잘 안 된다!! → 한국어는 <code class=\"language-text\">KoNLPy</code>의 <code class=\"language-text\">Okt</code>, <code class=\"language-text\">Kkma</code>, <code class=\"language-text\">Mecab</code> 같은 형태소 분석기 이용하는 것이 더 좋음</li>\n<li>tokenize:</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> nltk<span class=\"token punctuation\">.</span>tokenize <span class=\"token keyword\">import</span> sent_tokenize\n<span class=\"token keyword\">from</span> nltk<span class=\"token punctuation\">.</span>tokenize <span class=\"token keyword\">import</span> word_tokenize\n<span class=\"token keyword\">from</span> nltk<span class=\"token punctuation\">.</span>tokenize <span class=\"token keyword\">import</span> RegexpTokenizer\n\ntext <span class=\"token operator\">=</span> <span class=\"token string\">\"Hello world. This is NLTK. Let's learn tokenization! 123 test.\"</span>\n\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>sent_tokenize<span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># ['Hello world.', 'This is NLTK.', \"Let's learn tokenization!\", '123 test.']</span>\n\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>word_tokenize<span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># ['Hello', 'world', '.', 'This', 'is', 'NLTK', '.',</span>\n<span class=\"token comment\">#  'Let', \"'s\", 'learn', 'tokenization', '!', '123', 'test', '.']</span>\n\n\ntokenizer <span class=\"token operator\">=</span> RegexpTokenizer<span class=\"token punctuation\">(</span><span class=\"token string\">r'\\w+'</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># 알파벳 대소문자(a-z, A-Z), 숫자(0-9), 아래밑줄(_) 1개이상 포함 정규화</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>tokenizer<span class=\"token punctuation\">.</span>tokenize<span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># ['Hello', 'world', 'This', 'is', 'NLTK', 'Let', </span>\n<span class=\"token comment\"># 's', 'learn', 'tokenization', '123', 'test']</span></code></pre></div>\n<p> </p>\n<h3 id=\"spacy-라이브러리\" style=\"position:relative;\"><a href=\"#spacy-%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC\" aria-label=\"spacy 라이브러리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>spaCy 라이브러리</h3>\n<ul>\n<li>\n<p>사이썬(Cython) 기반으로 개발된 오픈소스 라이브러리</p>\n</li>\n<li>\n<p>NLTK보다 빠른 속도, 높은 정확도를 가짐</p>\n</li>\n<li>\n<p>spaCy는 <code class=\"language-text\">spacy.load(\"en_core_web_sm\")</code>로 모델을 불러와서 모델에 문장을 입력값으로 넣으면, 객체 지향적으로 처리된 결과를 속성값으로 접근할 수 있다.</p>\n</li>\n<li>\n<p><code class=\"language-text\">doc</code> : 전체 문서 객체 (<code class=\"language-text\">spacy.tokens.doc.Doc</code>)</p>\n<p><code class=\"language-text\">token</code> : 문서의 토큰 단위 (<code class=\"language-text\">spacy.tokens.token.Token</code>)</p>\n<p><code class=\"language-text\">span</code> : 특정 구간 (문장, 구 등) (<code class=\"language-text\">spacy.tokens.span.Span</code>)</p>\n<p>→ 각 객체에서 속성들을 접근할 수 있는데, 너무 많으니 생략!!</p>\n</li>\n</ul>\n<p> </p>\n<p> </p>\n<h2 id=\"하위-단어-토큰화-subword-tokenization\" style=\"position:relative;\"><a href=\"#%ED%95%98%EC%9C%84-%EB%8B%A8%EC%96%B4-%ED%86%A0%ED%81%B0%ED%99%94-subword-tokenization\" aria-label=\"하위 단어 토큰화 subword tokenization permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>하위 단어 토큰화 (Subword Tokenization)</h2>\n<hr>\n<p>하위 단어 토큰화는 단어(word)를 더 작은 단위인 subword(하위 단어)로 나누는 방법이다. 완전한 형태소 분석보다는 <strong>빈도 기반 분리</strong>에 가깝다. <strong>OOV(Out-Of-Vocabulary, 사전에 없는 단어) 문제를 해결</strong>하기 위해 고안된 것!!</p>\n<p>희귀 단어 처리</p>\n<ul>\n<li>‘돈쭐내다’라는 단어가 사전에 없으면? → 전통적인 토큰화에서는 ‘돈’+‘쭐’+‘내다’로 쪼개서 처리함\n<ul>\n<li>하위단어 토큰화를 적용한다면, 원래 있는 토큰 ‘돈’과 하위단어 ‘쭐’, ‘내’, ‘다’로 쪼개고</li>\n<li>‘돈’+‘쭐내다(subword 패턴 조합)‘로 신조어 패턴을 학습할 수 있음</li>\n</ul>\n</li>\n<li>신조어, 오탈자도 subword로 분리하면 어느 정도 의미 유지 가능하다.</li>\n</ul>\n<p>단어 집합 크기 줄이기</p>\n<ul>\n<li>모든 단어를 사전에 등록하면 수십만~수백만 단어 필요 → 메모리, 연산량 ↑</li>\n<li>subword로 쪼개면 수만 단위의 작은 사전으로 충분해진다.</li>\n</ul>\n<p> </p>\n<h3 id=\"바이트-페어-인코딩-bpe\" style=\"position:relative;\"><a href=\"#%EB%B0%94%EC%9D%B4%ED%8A%B8-%ED%8E%98%EC%96%B4-%EC%9D%B8%EC%BD%94%EB%94%A9-bpe\" aria-label=\"바이트 페어 인코딩 bpe permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>바이트 페어 인코딩 (BPE)</h3>\n<ul>\n<li>\n<p>어휘 사전 추가 방법</p>\n<ul>\n<li><strong>병합 점수 = 특정 쌍이 코퍼스(여러 문장)에서 함께 등장한 횟수(빈도)</strong></li>\n<li>가장 빈도가 높은 쌍을 합친 새로운 subword를 사전에 추가한다. (ex. (‘돈’,‘쭐’) 쌍이 가장 많이 등장한 쌍이면 ‘돈쭐’을 어휘 사전에 추가함)</li>\n<li>이 과정을 vocab_size가 될 때까지 반복한다. (ex. subword로 연결된 ‘돈쭐’과 ‘내’ 쌍이 가장 많이 등장하면 ‘돈쭐내’를 어휘 사전에 추가함)</li>\n</ul>\n</li>\n<li>\n<p>sentencepiece 라이브러리</p>\n<ul>\n<li>\n<p>구글이 만든 언어 독립적인 서브워드 토크나이저</p>\n</li>\n<li>\n<p>BPE(Byte Pair Encoding), Unigram LM 방식을 지원한다.</p>\n</li>\n<li>\n<p>띄어쓰기 기반이 아니라 <strong>문자 단위 입력</strong>을 사용하기 때문에, 한국어·중국어·일본어 등 띄어쓰기가 애매한 언어에도 잘 동작한다.</p>\n</li>\n<li>\n<p>SentencePieceTrainer 모듈</p>\n<ul>\n<li>\n<p>토크나이저 학습 모듈 불러옴 → <strong>새로운 subword 토큰화 모델을 학습</strong>할 때 사용함</p>\n</li>\n<li>\n<p>실행 결과\n<code class=\"language-text\">spm.model</code> → 학습된 토크나이저 모델 파일</p>\n<p><code class=\"language-text\">spm.vocab</code> → 서브워드 사전 (토큰과 점수)</p>\n</li>\n<li>\n<p>주요 파라미터\n<code class=\"language-text\">--input</code> : 학습할 텍스트 파일</p>\n<p><code class=\"language-text\">--model_prefix</code> : 출력 모델/사전 파일 이름 prefix</p>\n<p><code class=\"language-text\">--vocab_size</code> : 어휘 크기 (예: 8000, 32000)</p>\n<p><code class=\"language-text\">--model_type</code> : <code class=\"language-text\">unigram</code>(기본), <code class=\"language-text\">bpe</code>, <code class=\"language-text\">char</code>, <code class=\"language-text\">word</code></p>\n<p><code class=\"language-text\">--character_coverage</code> : 문자 커버율 (예: 한국어는 1.0, 일본어/중국어는 0.9995)</p>\n<p><code class=\"language-text\">--input_sentence_size</code> : 학습에 사용할 문장 샘플 크기</p>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p>sentencepiece 라이브러리의 SentencePieceTrainer 모듈로 BPE 모델 학습 &#x26; 적용</p>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> sentencepiece <span class=\"token keyword\">import</span> SentencePieceTrainer\n\n<span class=\"token comment\"># bpe 모델 학습</span>\n<span class=\"token comment\"># input.txt: 학습할 말뭉치 (한 줄 = 하나의 문장)</span>\n<span class=\"token comment\"># character_coverage=1.0: 학습 코퍼스에 등장하는 모든 문자를 vocab에 포함(한국어/한자/이모지 다룰 것)</span>\n<span class=\"token comment\"># unk_id: 어휘 사전에 없는 OOV를 의미하는 unk 토큰의 id (기본값: 0)</span>\n<span class=\"token comment\"># bos_id: 문장이 시작되는 지점을 의미하는 bos 토큰의 id (기본값: 1)</span>\n<span class=\"token comment\"># eos_id: 문장이 끝나는 지점을 의미하는 eos 토큰의 id (기본값: 2)</span>\nSentencePieceTrainer<span class=\"token punctuation\">.</span>Train<span class=\"token punctuation\">(</span>\n    \"<span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token builtin\">input</span><span class=\"token operator\">=</span><span class=\"token builtin\">input</span><span class=\"token punctuation\">.</span>txt\\\n    <span class=\"token operator\">-</span><span class=\"token operator\">-</span>model_prefix<span class=\"token operator\">=</span>spm\\\n    <span class=\"token operator\">-</span><span class=\"token operator\">-</span>vocab_size<span class=\"token operator\">=</span><span class=\"token number\">8000</span>\\\n    <span class=\"token operator\">-</span><span class=\"token operator\">-</span>model_type<span class=\"token operator\">=</span>bpe\\\n    <span class=\"token operator\">-</span><span class=\"token operator\">-</span>character_coverage<span class=\"token operator\">=</span><span class=\"token number\">1.0</span>\"\n<span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> sentencepiece <span class=\"token keyword\">import</span> SentencePieceProcessor\n\n<span class=\"token comment\"># 1. 학습된 모델 로드</span>\nsp <span class=\"token operator\">=</span> SentencePieceProcessor<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nsp<span class=\"token punctuation\">.</span>load<span class=\"token punctuation\">(</span><span class=\"token string\">\"spm.model\"</span><span class=\"token punctuation\">)</span>   <span class=\"token comment\"># Trainer가 만든 모델 파일</span>\n\n<span class=\"token comment\"># 2. 문장을 subword 단위로 토큰화</span>\ntext <span class=\"token operator\">=</span> <span class=\"token string\">\"돈쭐내다라는 신조어를 SentencePiece로 실험해봅시다.\"</span>\n\n<span class=\"token comment\"># 서브워드 단위로 분리 (문장 -> 서브워드)</span>\npieces <span class=\"token operator\">=</span> sp<span class=\"token punctuation\">.</span>encode_as_pieces<span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Pieces:\"</span><span class=\"token punctuation\">,</span> pieces<span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># Pieces: ['▁돈', '쭐', '내', '다', '라는', '▁신', '조', '어',</span>\n<span class=\"token comment\"># '를', '▁', 'S', 'e', 'n', 't', 'e', 'n', 'c', 'e',</span>\n<span class=\"token comment\"># 'P', 'i', 'e', 'c', 'e', '로', '▁실', '험', '해', '봅', '시다', '.']</span>\n\n\n<span class=\"token comment\"># 토큰 id로 변환 (문장 -> 정수 인코딩)</span>\nids <span class=\"token operator\">=</span> sp<span class=\"token punctuation\">.</span>encode_as_ids<span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"IDs:\"</span><span class=\"token punctuation\">,</span> ids<span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># IDs: [189, 3427, 1718, 1622, 165, 111, 1706,</span>\n<span class=\"token comment\"># 1647, 1644, 1620, 2099, 1958, 1997, 1928, 1958,</span>\n<span class=\"token comment\"># 1997, 2047, 1958, 2232, 2009, 1958, 2047, 1958, 1635,</span>\n<span class=\"token comment\"># 136, 1875, 1639, 2029, 743, 1623]</span>\n\n\n<span class=\"token comment\"># 다시 문장으로 복원 (정수 인코딩 -> 문장)</span>\ndecoded_ids <span class=\"token operator\">=</span> sp<span class=\"token punctuation\">.</span>decode_ids<span class=\"token punctuation\">(</span>ids<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Decoded_ids:\"</span><span class=\"token punctuation\">,</span> decoded_ids<span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># Decoded_ids: 돈쭐내다라는 신조어를 SentencePiece로 실험해봅시다.</span>\n\n\n<span class=\"token comment\"># 다시 문장으로 복원 (서브워드 -> 문장)</span>\ndecoded_pieces <span class=\"token operator\">=</span> sp<span class=\"token punctuation\">.</span>decode_pieces<span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Decoded_pieces:\"</span><span class=\"token punctuation\">,</span> decoded_pieces<span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># Decoded_pieces: 돈쭐내다라는 신조어를 SentencePiece로 실험해봅시다.</span></code></pre></div>\n<ul>\n<li>학습된 어휘사전 확인</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> sentencepiece <span class=\"token keyword\">import</span> SentencePieceProcessor\n\ntokenizer <span class=\"token operator\">=</span> SentencePieceProcessor<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\ntokenizer<span class=\"token punctuation\">.</span>load<span class=\"token punctuation\">(</span><span class=\"token string\">\"spm.model\"</span><span class=\"token punctuation\">)</span>\n\nvocab <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>idx<span class=\"token punctuation\">:</span> tokenizer<span class=\"token punctuation\">.</span>id_to_piece<span class=\"token punctuation\">(</span>idx<span class=\"token punctuation\">)</span> <span class=\"token keyword\">for</span> idx <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span>tokenizer<span class=\"token punctuation\">.</span>get_piece_size<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">list</span><span class=\"token punctuation\">(</span>vocab<span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token number\">100</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># 100개 확인</span>\n<span class=\"token comment\"># [(0, '&lt;unk>'), (1, '&lt;s>'), (2, '&lt;/s>'), (3, '니다'), (4, '▁이'), (5, '▁있'), (6, '습니다'), (7, '▁하'), (8, '▁그'), (9, '▁사'), (10, '▁대'), (11, '으로'), (12, '▁아'), (13, '▁국'), (14, '▁정'), (15, '합니다'), (16, '▁지'), (17, '에서'), (18, '▁수'), (19, '하는'), (20, '▁가'), (21, '하고'), (22, '입니다'), (23, '▁보'), (24, '..'), (25, '▁일'), (26, '▁한'), (27, '▁없'), (28, '▁해'), (29, '▁제'), (30, '▁부'), (31, '▁생'), (32, '▁자'), (33, '▁것'), (34, '▁나'), (35, '▁주'), (36, '▁국민'), (37, '▁안'), (38, '▁다'), (39, '들이'), (40, '▁시'), (41, '▁어'), (42, '▁기'), (43, '▁1'), (44, '▁저'), (45, '다고'), (46, '▁않'), (47, '▁공'), (48, '▁인'), (49, '▁전'), (50, '▁위'), (51, '▁경'), (52, '▁생각'), (53, '▁되'), (54, '▁모'), (55, '▁있는'), (56, '▁2'), (57, '▁청'), (58, '세요'), (59, '▁우'), (60, '▁여'), (61, '▁무'), (62, '지만'), (63, '▁문'), (64, '▁많'), (65, '니까'), (66, '▁사람'), (67, '▁바'), (68, '▁말'), (69, '▁조'), (70, '▁있습니다'), (71, '▁내'), (72, '▁대한'), (73, '에게'), (74, '이라'), (75, '▁고'), (76, '다는'), (77, '▁받'), (78, '▁의'), (79, '▁상'), (80, '들은'), (81, '▁현'), (82, '▁만'), (83, '▁소'), (84, '▁중'), (85, '는데'), (86, '▁더'), (87, '▁불'), (88, '▁합니다'), (89, '하여'), (90, '▁못'), (91, '해서'), (92, '▁우리'), (93, '▁개'), (94, '▁세'), (95, '▁비'), (96, '하게'), (97, '▁미'), (98, '▁법'), (99, '▁도')]</span>\n<span class=\"token comment\"># vocab size : 8000</span></code></pre></div>\n<p> </p>\n<h3 id=\"워드피스-wordpiece\" style=\"position:relative;\"><a href=\"#%EC%9B%8C%EB%93%9C%ED%94%BC%EC%8A%A4-wordpiece\" aria-label=\"워드피스 wordpiece permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>워드피스 (Wordpiece)</h3>\n<ul>\n<li>\n<p>구글 번역(Google Neural Machine Translation)에서 제안됨</p>\n</li>\n<li>\n<p>어휘 사전 추가 방법</p>\n<ul>\n<li>\n<p><strong>병합 점수 = 글자쌍의 등장횟수 / 각 글자의 등장 횟수의 곱</strong></p>\n</li>\n<li>\n<p><strong>초기 상태</strong>: 어휘 사전(vocab)을 문자 단위로 시작 (예: <code class=\"language-text\">['ㄷ', 'ㅗ', 'ㄴ', '쭐', '내', '다']</code>)</p>\n</li>\n<li>\n<p><strong>병합 과정</strong>: 코퍼스에서 가장 자주 등장하는 <strong>subword 쌍</strong>을 합쳐 새로운 토큰으로 추가</p>\n<ul>\n<li><code class=\"language-text\">'ㄷ'</code>,<code class=\"language-text\">'ㅗ'</code>,<code class=\"language-text\">'ㄴ'</code> 의 등장 횟수 대비 <code class=\"language-text\">\"돈\"</code>이 자주 나오면 `‘ㄷ’+‘ㅗ’+‘ㄴ’ → ‘돈’“</li>\n</ul>\n</li>\n<li>\n<p><strong>사전 확장</strong>: 원하는 vocab_size (예: 30k)까지 반복</p>\n<ul>\n<li>많이 쓰이는 건 그대로 하나의 토큰, 드물게 쓰이는 건 작은 subword 단위로 쪼개짐</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p>허깅페이스 Tokenizer 라이브러리</p>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> tokenizers <span class=\"token keyword\">import</span> Tokenizer\n<span class=\"token keyword\">from</span> tokenizers<span class=\"token punctuation\">.</span>models <span class=\"token keyword\">import</span> WordPiece\n<span class=\"token keyword\">from</span> tokenizers<span class=\"token punctuation\">.</span>normalizers <span class=\"token keyword\">import</span> Sequence<span class=\"token punctuation\">,</span> NFD<span class=\"token punctuation\">,</span> Lowercase\n<span class=\"token keyword\">from</span> tokenizers<span class=\"token punctuation\">.</span>pre_tokenizers <span class=\"token keyword\">import</span> Whitespace\n\n<span class=\"token comment\"># 1. WordPiece 모델 정의</span>\n<span class=\"token comment\"># - WordPiece 알고리즘을 기반으로 토크나이저를 생성</span>\n<span class=\"token comment\"># - unk_token=\"[UNK]\" : 사전에 없는 토큰(OOV)을 처리할 때 사용되는 특별 토큰</span>\ntokenizer <span class=\"token operator\">=</span> Tokenizer<span class=\"token punctuation\">(</span>WordPiece<span class=\"token punctuation\">(</span>unk_token<span class=\"token operator\">=</span><span class=\"token string\">\"[UNK]\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 2. 정규화기(Normalizer) 설정</span>\n<span class=\"token comment\"># - 입력 텍스트를 표준화하는 과정</span>\n<span class=\"token comment\"># - NFD() : 유니코드 정규화 클래스 (예: é -> e + ´)</span>\n<span class=\"token comment\"># - Lowercase() : 모든 문자를 소문자로 변환하는 정규화 클래스</span>\n<span class=\"token comment\"># - 정규화 클래스는 NFKD, NFC, NFKC, strip 등이 더 존재함</span>\n<span class=\"token comment\"># - Sequence([...]) : 여러 정규화기를 순서대로 적용</span>\ntokenizer<span class=\"token punctuation\">.</span>normalizer <span class=\"token operator\">=</span> Sequence<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>NFD<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> Lowercase<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 3. PreTokenizer 설정 (사전 토큰화 클래스)</span>\n<span class=\"token comment\"># - 본격적인 subword 학습 전에 단어 단위로 먼저 나누는 과정</span>\n<span class=\"token comment\"># - Whitespace() : 공백 단위로 먼저 토큰 분리하는 클래스</span>\n<span class=\"token comment\"># - 사전 토큰화 클래스는 Sequence(), CharDelimiterSplit(), Digits() 등이 더 존재함</span>\ntokenizer<span class=\"token punctuation\">.</span>pre_tokenizer <span class=\"token operator\">=</span> Whitespace<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 4. WordPiece 토크나이저 학습</span>\n<span class=\"token comment\"># - \"../datasets/corpus.txt\" : 학습에 사용할 말뭉치 파일</span>\n<span class=\"token comment\"># - 파일 안의 텍스트를 기반으로 WordPiece subword 사전을 학습</span>\ntokenizer<span class=\"token punctuation\">.</span>train<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"../datasets/corpus.txt\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 5. 학습된 토크나이저 저장</span>\n<span class=\"token comment\"># - \"../models/petition_wordpiece.json\" : 토크나이저 설정 및 vocab이 포함된 JSON 파일</span>\n<span class=\"token comment\"># - 나중에 이 파일을 불러와서 같은 토크나이저를 재사용 가능</span>\ntokenizer<span class=\"token punctuation\">.</span>save<span class=\"token punctuation\">(</span><span class=\"token string\">\"../models/petition_wordpiece.json\"</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> tokenizers <span class=\"token keyword\">import</span> Tokenizer\n<span class=\"token keyword\">from</span> tokenizers<span class=\"token punctuation\">.</span>decoders <span class=\"token keyword\">import</span> WordPiece <span class=\"token keyword\">as</span> WordPieceDecoder\n\n<span class=\"token comment\"># 1. 학습된 모델 로드</span>\ntokenizer <span class=\"token operator\">=</span> Tokenizer<span class=\"token punctuation\">.</span>from_file<span class=\"token punctuation\">(</span><span class=\"token string\">\"../models/petition_wordpiece.json\"</span><span class=\"token punctuation\">)</span>\ntokenizer<span class=\"token punctuation\">.</span>decoder <span class=\"token operator\">=</span> WordPieceDecoder<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 2. 문장을 subword 단위로 토큰화</span>\ntext <span class=\"token operator\">=</span> <span class=\"token string\">\"돈쭐내다라는 신조어를 SentencePiece로 실험해봅시다.\"</span>\n\n<span class=\"token comment\"># 인코딩</span>\nencoded <span class=\"token operator\">=</span> tokenizer<span class=\"token punctuation\">.</span>encode<span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 인코딩 타입</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"encoded_type:\"</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">type</span><span class=\"token punctuation\">(</span>encoded<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># encoded_type: &lt;class 'tokenizers.Encoding'></span>\n\n<span class=\"token comment\"># 문장 토큰화</span>\ntokens <span class=\"token operator\">=</span> encoded<span class=\"token punctuation\">.</span>tokens\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"tokens:\"</span><span class=\"token punctuation\">,</span> tokens<span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># tokens: ['돈', '##ᄍ', '##ᅮᆯ', '##내', '##다', '##라는', '신',</span>\n<span class=\"token comment\"># '##조', '##어를', 'se', '##nt', '##en', '##ce', '##p', '##i'</span>\n<span class=\"token comment\">#  '##ec', '##e', '##로', '실험', '##해보', '##ᆸ시다', '.']</span>\n\n<span class=\"token comment\"># 정수 인코딩</span>\nids <span class=\"token operator\">=</span> encoded<span class=\"token punctuation\">.</span>ids\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ids:\"</span><span class=\"token punctuation\">,</span> ids<span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># ids: [7917, 4280, 7521, 7731, 7478, 7906,</span>\n<span class=\"token comment\"># 7755, 7649, 11207, 26328, 23624, 10456, 21575,</span>\n<span class=\"token comment\"># 4295, 4263, 10611, 4288, 7495, 12904, 9150, 9008, 13]</span>\n\n<span class=\"token comment\"># 디코딩 (정수 인코딩 -> 문장 변환)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"decoded:\"</span><span class=\"token punctuation\">,</span> tokenizer<span class=\"token punctuation\">.</span>decode<span class=\"token punctuation\">(</span>ids<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># decoded: 돈쭐내다라는 신조어를 sentencepiece로 실험해봅시다.</span></code></pre></div>\n<p> </p>\n<p>토큰화하는 방법은 여러가지 존재한다.</p>\n<p>번역/챗봇에서는 subword 방식(WordPiece, SentencePiece), 한국어 문법 분석에서는 형태소 기반(Okt, Kkma, Mecab), 소셜미디어 신조어 처리에서는 subword + 자모 단위 보완하도록 토큰화를 진행할 수 있다. 또한, 어떤 단어/서브워드를 어휘 사전에 포함시킬지에 따라 모델 성능이 크게 달라진다.</p>\n<p>결국, <strong>프로젝트 목적에 맞는 토큰화 선택이 중요하고, 어휘사전 구축이 핵심이다.</strong></p>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#%ED%86%A0%ED%81%B0%ED%99%94-%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC\">토큰화 라이브러리</a></p>\n<ul>\n<li><a href=\"#jamo-%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC\">jamo 라이브러리</a></li>\n<li><a href=\"#konlpy-%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC\">KoNLPy 라이브러리</a></li>\n<li><a href=\"#nltknatural-language-toolkit-%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC\">NLTK(Natural Language Toolkit) 라이브러리</a></li>\n<li><a href=\"#spacy-%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC\">spaCy 라이브러리</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%ED%95%98%EC%9C%84-%EB%8B%A8%EC%96%B4-%ED%86%A0%ED%81%B0%ED%99%94-subword-tokenization\">하위 단어 토큰화 (Subword Tokenization)</a></p>\n<ul>\n<li><a href=\"#%EB%B0%94%EC%9D%B4%ED%8A%B8-%ED%8E%98%EC%96%B4-%EC%9D%B8%EC%BD%94%EB%94%A9-bpe\">바이트 페어 인코딩 (BPE)</a></li>\n<li><a href=\"#%EC%9B%8C%EB%93%9C%ED%94%BC%EC%8A%A4-wordpiece\">워드피스 (Wordpiece)</a></li>\n</ul>\n</li>\n</ul>\n</div>","frontmatter":{"date":"September 09, 2025","title":"[NLP] 파이토치 트랜스포머를 활용한 자연어 처리와 컴퓨터비전 심층학습 -토큰화","categories":"NLP","author":"변우중","emoji":"☀️"},"fields":{"slug":"/25-09-09_1/"}},"prev":{"id":"16028044-feb8-52fb-8dfc-47bb74183808","html":"<p>참고 : 테디노트의 RAG 비법노트</p>\n<p>소스코드: <a href=\"https://github.com/teddylee777/langchain-kr\">https://github.com/teddylee777/langchain-kr</a></p>\n<p> </p>\n<p>오늘도 가즈아..!!!!\n새로운 걸 알아가는 건 정말 즐겁다~ 다만 알게된 것을 {정리}하는 것은 별개일 뿐… O—&#x3C;</p>\n<p>거두절미. 레츠고~!</p>\n<p> </p>\n<h2 id=\"lcel-인터페이스\" style=\"position:relative;\"><a href=\"#lcel-%EC%9D%B8%ED%84%B0%ED%8E%98%EC%9D%B4%EC%8A%A4\" aria-label=\"lcel 인터페이스 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>LCEL 인터페이스</h2>\n<hr>\n<p>지난 글에서는 invoke(), stream() 메서드를 살펴봤는데\n사실 batch() 메서드도 있다.</p>\n<h4 id=\"batch-배치-처리\" style=\"position:relative;\"><a href=\"#batch-%EB%B0%B0%EC%B9%98-%EC%B2%98%EB%A6%AC\" aria-label=\"batch 배치 처리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>batch(): 배치 처리</h4>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> langchain_openai <span class=\"token keyword\">import</span> ChatOpenAI\n<span class=\"token keyword\">from</span> langchain_core<span class=\"token punctuation\">.</span>prompts <span class=\"token keyword\">import</span> PromptTemplate\n<span class=\"token keyword\">from</span> langchain_core<span class=\"token punctuation\">.</span>output_parsers <span class=\"token keyword\">import</span> StrOutputParser\n\nmodel <span class=\"token operator\">=</span> ChatOpenAI<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nprompt <span class=\"token operator\">=</span> PromptTemplate<span class=\"token punctuation\">.</span>from_template<span class=\"token punctuation\">(</span><span class=\"token string\">\"{topic}에 대하여 3문장으로 설명해줘.\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># 프롬프트와 모델을 연결하여 대화 체인을 생성합니다.</span>\nchain <span class=\"token operator\">=</span> prompt <span class=\"token operator\">|</span> model <span class=\"token operator\">|</span> StrOutputParser<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\nchain<span class=\"token punctuation\">.</span>batch<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"topic\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"ChatGPT\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"topic\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Instagram\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># 출력: ['ChatGPT는 자연어 처리 기술을 사용하여 사람과의 대화를 시뮬레이션하는 인공지능 챗봇이다. 최신의 딥러닝 모델을 바탕으로 학습하며 사용자의 질문에 대답하고 다양한 주제에 대한 정보를 제공한다. 사용자와 자연스럽게 상호작용하면서 학습과 업데이트를 거쳐 보다 정확하고 유용한 응답을 제공한다.', 'Instagram은 사진과 동영상을 공유하고 다른 사용자들과 소통할 수 있는 소셜 미디어 플랫폼이다. 인스타그램은 휴대폰 앱을 통해 이용되며, 다양한 필터와 효과를 통해 사진을 가공하고 세련된 프로필을 만들 수 있다. 또한 해시태그를 통해 다양한 주제와 관심사에 맞는 콘텐츠를 검색하고 소통할 수 있다.']</span></code></pre></div>\n<p>리스트에 input_variables의 값들을 갖는 딕셔너리를 모아서 각각 배치로 chain에 던진다.<br>\n<strong>model을 거치고 파싱을 거치면서 각 배치 결과의 content들을 리스트에 묶어서 저장된다.</strong></p>\n<p>참고로 config 딕셔너리에서 max_concurrency 키의 값을 설정하여 동시 처리할 수 있는 최대 작업 수를 정해줄 수 있다. 즉, 한번에 배치를 여러 개 처리를 할 수 있고 결과는 똑같이 모든 배치를 묶어서 정리되어 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">chain<span class=\"token punctuation\">.</span>batch<span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">{</span><span class=\"token string\">\"topic\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"ChatGPT\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">{</span><span class=\"token string\">\"topic\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Instagram\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">{</span><span class=\"token string\">\"topic\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"멀티모달\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">{</span><span class=\"token string\">\"topic\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"프로그래밍\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">{</span><span class=\"token string\">\"topic\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"머신러닝\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    config<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"max_concurrency\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p> </p>\n<h3 id=\"비동기-메소드\" style=\"position:relative;\"><a href=\"#%EB%B9%84%EB%8F%99%EA%B8%B0-%EB%A9%94%EC%86%8C%EB%93%9C\" aria-label=\"비동기 메소드 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>비동기 메소드</h3>\n<p>어떤 작업을 기다리는 동안 다른 작업도 할 수 있는 것을 비동기라고 한다.</p>\n<p>async 키워드 사용하여 비동기 스트림, 호출, 배치 가능하다.</p>\n<h4 id=\"1-비동기-스트림-async-for-astream\" style=\"position:relative;\"><a href=\"#1-%EB%B9%84%EB%8F%99%EA%B8%B0-%EC%8A%A4%ED%8A%B8%EB%A6%BC-async-for-astream\" aria-label=\"1 비동기 스트림 async for astream permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 비동기 스트림: async for, astream()</h4>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">async</span> <span class=\"token keyword\">for</span> token <span class=\"token keyword\">in</span> chain<span class=\"token punctuation\">.</span>astream<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"topic\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Youtube\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span> <span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">,</span> end<span class=\"token operator\">=</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> flush<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h4 id=\"2-비동기-호출-ainvoke\" style=\"position:relative;\"><a href=\"#2-%EB%B9%84%EB%8F%99%EA%B8%B0-%ED%98%B8%EC%B6%9C-ainvoke\" aria-label=\"2 비동기 호출 ainvoke permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 비동기 호출: ainvoke()</h4>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># 비동기 호출 체인 객체 생성</span>\nmy_process <span class=\"token operator\">=</span> chain<span class=\"token punctuation\">.</span>ainvoke<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"topic\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Youtube\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 비동기로 처리하며 프로세스 완료 후 출력됨</span>\n<span class=\"token keyword\">await</span> my_process</code></pre></div>\n<p><strong>ainvoke는 비동기 체인 객체 생성 후, await 키워드 호출로 답변을 생성한다.</strong></p>\n<h4 id=\"3-비동기-배치-abatch\" style=\"position:relative;\"><a href=\"#3-%EB%B9%84%EB%8F%99%EA%B8%B0-%EB%B0%B0%EC%B9%98-abatch\" aria-label=\"3 비동기 배치 abatch permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. 비동기 배치: abatch()</h4>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># 비동기 배치 체인 객체 생성</span>\nmy_abatch_process <span class=\"token operator\">=</span> chain<span class=\"token punctuation\">.</span>abatch<span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"topic\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"YouTube\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"topic\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Instagram\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"topic\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Facebook\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 비동기적으로 배치를 일괄 처리하며 프로세스 완료 후 </span>\n<span class=\"token keyword\">await</span> my_abatch_process\n<span class=\"token triple-quoted-string string\">\"\"\" 출력:\n['YouTube는 온라인 동영상 공유 플랫폼으로, 사용자들이 동영상을 업로드하고 시청할 수 있는 서비스이다. 먹방, 게임 플레이, 뷰티 관련 콘텐츠 등 다양한 주제의 동영상을 제공하며, 수많은 유저들이 이용하고 있다. 유명 인플루언서나 크리에이터들이 YouTube를 통해 수익을 창출하고, 전 세계적으로 인기를 끌고 있다.',\n '인스타그램은 사진과 동영상을 공유할 수 있는 소셜미디어 플랫폼이다. 사용자들은 팔로워들과 소통하며 일상 속의 순간들을 공유할 수 있다. 또한 해시태그를 통해 관심사나 주제에 맞는 콘텐츠를 찾을 수도 있다.',\n 'Facebook은 소셜 네트워크 서비스로, 사용자들이 글을 게시하고 사진이나 동영상을 공유할 수 있는 플랫폼입니다. 전 세계적으로 많은 사람들이 가입해 사용하며, 친구들이나 가족과 소통하고 소셜 미디어를 통해 정보를 공유합니다. 또한 광고도 활발히 진행되어 상품이나 서비스를 홍보하는데 이용됩니다.']\n\"\"\"</span></code></pre></div>\n<p><strong>비동기적으로 각 배치를 기다리지 않고 동시 작업을 수행하며, 프로세스 완료 후 리스트로 출력한다.</strong><br>이때, 결과는 뱉어 내고 어디에 저장이 되지 않습니다!!</p>\n<blockquote>\n<h3 id=\"깨알-tip\" style=\"position:relative;\"><a href=\"#%EA%B9%A8%EC%95%8C-tip\" aria-label=\"깨알 tip permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>💡깨알 Tip</h3>\n<p>그래서!! ‘변수 = await 비동기 배치 체인 객체’로 결과를 받아 놓을 수 있습니다!</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">my_abatch_process <span class=\"token operator\">=</span> chain<span class=\"token punctuation\">.</span>abatch<span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"topic\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"YouTube\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"topic\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Instagram\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"topic\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Facebook\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">)</span>\n\nresult <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> my_abatch_process\nresult</code></pre></div>\n</blockquote>\n<p> </p>\n<p> </p>\n<h2 id=\"runnable-interface\" style=\"position:relative;\"><a href=\"#runnable-interface\" aria-label=\"runnable interface permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Runnable Interface</h2>\n<hr>\n<p><strong>Runnable</strong>은 채팅 모델, LLM, 프롬프트 템플릿, 출력 파서, 검색기 등 <strong>입력을 받아 실행 가능한 LangChain의 기본 구성요소</strong>를 의미합니다.</p>\n<p>이러한 Runnable들을 순차 또는 병렬로 연결해 하나의 실행 흐름으로 구성한 것을 <strong>Chain</strong>이라고 합니다.</p>\n<p> </p>\n<h3 id=\"runnable-프로토콜\" style=\"position:relative;\"><a href=\"#runnable-%ED%94%84%EB%A1%9C%ED%86%A0%EC%BD%9C\" aria-label=\"runnable 프로토콜 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Runnable 프로토콜</h3>\n<p><strong>Runnable 프로토콜</strong>은<br>\nLangChain에서 **모든 실행 가능한 구성요소가 따라야 하는 공통 실행 규약(interface)**입니다.</p>\n<blockquote>\n<p>즉,\n<strong>“입력을 받아 실행하고, 출력을 반환하는 방법을 표준화한 약속”</strong></p>\n</blockquote>\n<p> </p>\n<p>LangChain에 서로 성격이 완전히 다른 구성요소들이</p>\n<ol>\n<li>실행 방식이 통일되어야 하고</li>\n<li>입력/출력 흐름이 예측 가능해야 하므로</li>\n</ol>\n<p><strong>Runnable 프로토콜</strong>이 필요합니다.</p>\n<p>Runnable 프로토콜 덕분에 <strong>객체들은 모두 동일한 실행 인터페이스를 가집니다.</strong></p>\n<table>\n<thead>\n<tr>\n<th>메서드</th>\n<th>의미</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code class=\"language-text\">invoke(input)</code></td>\n<td>단일 입력 → 단일 출력</td>\n</tr>\n<tr>\n<td><code class=\"language-text\">batch(inputs)</code></td>\n<td>여러 입력 → 여러 출력</td>\n</tr>\n<tr>\n<td><code class=\"language-text\">stream(input)</code></td>\n<td>출력 스트리밍</td>\n</tr>\n<tr>\n<td><code class=\"language-text\">astream(input)</code></td>\n<td>비동기 스트리밍</td>\n</tr>\n<tr>\n<td><code class=\"language-text\">ainvoke(input)</code></td>\n<td>비동기 실행</td>\n</tr>\n</tbody>\n</table>\n<p> </p>\n<p>즉,</p>\n<p><strong>LLM도 Runnable</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">llm<span class=\"token punctuation\">.</span>invoke<span class=\"token punctuation\">(</span><span class=\"token string\">\"2+3은?\"</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><strong>PromptTemplate도 Runnable</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">prompt<span class=\"token punctuation\">.</span>invoke<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"question\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"2+3은?\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><strong>Retriever도 Runnable</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">retriever<span class=\"token punctuation\">.</span>invoke<span class=\"token punctuation\">(</span><span class=\"token string\">\"2+3\"</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>전부 <code class=\"language-text\">invoke()</code>로 실행 가능하다는 말입니다.</p>\n<p>참고로 Chain도 그 자체가 Runnable이라 동일한 실행 인터페이스로 호출 가능합니다. (쉿🤫 Chain이라는 Runnable을 병렬로 연결 가능한데, 그것도 가능함~)</p>\n<p> </p>\n<p>결국, Runnable의 핵심 철학은</p>\n<blockquote>\n<p>“무엇을 하는가”가 아니라\n“어떻게 실행되는가”를 통일한다</p>\n</blockquote>\n<p> </p>\n<p>이해 완.🧐✨</p>\n<p> </p>\n<p> </p>\n<h3 id=\"데이터-전달-방법\" style=\"position:relative;\"><a href=\"#%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%A0%84%EB%8B%AC-%EB%B0%A9%EB%B2%95\" aria-label=\"데이터 전달 방법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>데이터 전달 방법</h3>\n<p>LangChain에서 Runnable들을 연결할 때는</p>\n<ul>\n<li>앞 Runnable의 <strong>출력 형태</strong></li>\n<li>다음 Runnable이 <strong>기대하는 입력 형태</strong></li>\n</ul>\n<p>를 맞춰야 하고, 이를 위해 <strong>데이터를 전달·변형하는 여러 방법</strong>이 존재합니다.</p>\n<p> </p>\n<h4 id=\"1-값-전달-runnablepassthrough\" style=\"position:relative;\"><a href=\"#1-%EA%B0%92-%EC%A0%84%EB%8B%AC-runnablepassthrough\" aria-label=\"1 값 전달 runnablepassthrough permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 값 전달: RunnablePassthrough</h4>\n<p>RunnablePassthrough는 값을 그대로 전달해주는 친구입니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> langchain_core<span class=\"token punctuation\">.</span>runnables <span class=\"token keyword\">import</span> RunnablePassthrough\n\nRunnablePassthrough<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>invoke<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"num\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">10</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># 출력: {\"num\": 10}</span></code></pre></div>\n<p>이렇게 RunnablePassthrough()에서 invoke 메서드 호출하면 입력값 그대로 출력됩니다.<br>일반적으로 invoke() 통해 Runnable 실행할 때는 사용자 입력은 <strong>딕셔너리 형태</strong>로 전달하잖아요?</p>\n<p><strong>사용자 입력을 딕셔너리가 아닌 ‘입력 변수의 값’만 받고, RunnablePassthrough를 통해서 chain 내부에서 입력(딕셔너리 형태) 키의 값으로 곧바로 넣어줄 수가 있습니다.</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># chain에 딕셔너리 {입력 변수명: RunnablePassthrough()}를 넣고 연결해줌</span>\nrunnable_chain <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"num\"</span><span class=\"token punctuation\">:</span> RunnablePassthrough<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span> <span class=\"token operator\">|</span> prompt <span class=\"token operator\">|</span> ChatOpenAI<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 사용자 입력은 입력 변수의 '값'만 받음</span>\nrunnable_chain<span class=\"token punctuation\">.</span>invoke<span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><strong>그럼 이것의 장점이 뭐냐?</strong><br><strong>=> 체인 설계할 때  딕셔너리 형태로 변수를 미리 다 넣어 두고, 입력 변수 넣고 호출할 때는 변수명 기억 못해도 값만 넣을 수 있음!!</strong></p>\n<blockquote>\n<h3 id=\"깨알-tip-1\" style=\"position:relative;\"><a href=\"#%EA%B9%A8%EC%95%8C-tip-1\" aria-label=\"깨알 tip 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>💡깨알 Tip</h3>\n<p><strong>RunnablePassthrough.assign</strong>()을 이용해서 RunnablePassthrough의 <strong>입력 key/valu</strong>e와 <strong>새롭게 할당할 key/value를 통합할 수 있다.</strong><br>\n=> <strong>RunnablePassthrough.assign(새롭게 할당할 key이름=Runnable/lambda 함수).invoke({입력 key: value})을 이용하면 된다.</strong></p>\n<p><strong>즉, 입력은 그대로 가져오면서 assign을 통해 새로운 key/value도 가져와 출력한다.</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># \"RunnablePassthrough.assign(new_num=lambda x: x[\"num\"] * 3)\"에 입력 {\"num\": 1}을 넣음</span>\n<span class=\"token comment\"># 입력 {\"num\": 1} 자체가 x로 들어감 (x={\"num\": 1})</span>\n<span class=\"token comment\"># x[\"num\"] * 3 결과를 new_num 키의 값에 넣어 새로운 key/value 만듦</span>\n<span class=\"token comment\"># 입력은 그대로 가져오면서 assign을 통해 새로운 key/value도 가져와 출력한다.</span>\n<span class=\"token punctuation\">(</span>RunnablePassthrough<span class=\"token punctuation\">.</span>assign<span class=\"token punctuation\">(</span>new_num<span class=\"token operator\">=</span><span class=\"token keyword\">lambda</span> x<span class=\"token punctuation\">:</span> x<span class=\"token punctuation\">[</span><span class=\"token string\">\"num\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">*</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>invoke<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"num\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># 출력: {'num': 1, 'new_num': 3}</span></code></pre></div>\n</blockquote>\n<p> </p>\n<h3 id=\"2-runnable-병렬-연결-runnableparallel\" style=\"position:relative;\"><a href=\"#2-runnable-%EB%B3%91%EB%A0%AC-%EC%97%B0%EA%B2%B0-runnableparallel\" aria-label=\"2 runnable 병렬 연결 runnableparallel permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. Runnable 병렬 연결: RunnableParallel</h3>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> langchain_core<span class=\"token punctuation\">.</span>runnables <span class=\"token keyword\">import</span> RunnableParallel\n<span class=\"token keyword\">from</span> langchain_openai <span class=\"token keyword\">import</span> ChatOpenAI\n<span class=\"token keyword\">from</span> langchain_core<span class=\"token punctuation\">.</span>prompts <span class=\"token keyword\">import</span> PromptTemplate\n<span class=\"token keyword\">from</span> langchain_core<span class=\"token punctuation\">.</span>output_parsers <span class=\"token keyword\">import</span> StrOutputParser\n\nmodel <span class=\"token operator\">=</span> ChatOpenAI<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># {country} 의 수도를 물어보는 체인을 생성합니다.</span>\nchain1 <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>\n    PromptTemplate<span class=\"token punctuation\">.</span>from_template<span class=\"token punctuation\">(</span><span class=\"token string\">\"{country} 의 수도는 어디야?\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token operator\">|</span> model\n    <span class=\"token operator\">|</span> StrOutputParser<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># {country} 의 면적을 물어보는 체인을 생성합니다.</span>\nchain2 <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>\n    PromptTemplate<span class=\"token punctuation\">.</span>from_template<span class=\"token punctuation\">(</span><span class=\"token string\">\"{country} 의 면적은 얼마야?\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token operator\">|</span> model\n    <span class=\"token operator\">|</span> StrOutputParser<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 위의 2개 체인을 동시에 생성하는 병렬 실행 체인을 생성합니다.</span>\ncombined <span class=\"token operator\">=</span> RunnableParallel<span class=\"token punctuation\">(</span>capital<span class=\"token operator\">=</span>chain1<span class=\"token punctuation\">,</span> area<span class=\"token operator\">=</span>chain2<span class=\"token punctuation\">)</span>\ncombined<span class=\"token punctuation\">.</span>invoke<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"country\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"대한민국\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># 출력: {'capital': '대한민국의 수도는 서울이에요.', 'area': '대한민국의 총 면적은 약 100,363km² 입니다.'}</span></code></pre></div>\n<p>각 chain 객체를 생성한 후,<br><strong>RunnableParallel를 이용해 chain들을 동시에 실행하는 병렬 실행 체인을 생성할 수 있습니다.</strong> (정확히 말하면 Runnable인 chain 객체를 병렬 연결 가능합니다.)</p>\n<p>그리고,<br><strong>RunnableParallel 안에 capital과 area는 각 체인의 응답 결과를 받는 변수명입니다.</strong> <strong>그 capital과 area을 키로 갖는 딕셔너리 형태로 최종 결과를 내어 줍니다.</strong> (이렇게 체인 간 데이터 전달도 가능한 겁니다~)</p>\n<p>결과를 보면,<br>각 체인을 <strong>병렬로 실행한 후, 각 응답 결과를 capital과 area의 키의 값으로 넣어 딕셔너리를 반환</strong>하고 있습니다.</p>\n<blockquote>\n<h3 id=\"깨알-tip-2\" style=\"position:relative;\"><a href=\"#%EA%B9%A8%EC%95%8C-tip-2\" aria-label=\"깨알 tip 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>💡깨알 Tip</h3>\n<p><strong>Q1. 병렬로 연결한 Chain들의 input_variables이 다르다면?</strong><br>\n=> 호출 메서드(여기서 invoke)의 입력값에 <strong>하나의 딕셔너리에 input_variables 값들을 모두 넣어주면 된다!!</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># input_variables: country2</span>\nchain1 <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>\n PromptTemplate<span class=\"token punctuation\">.</span>from_template<span class=\"token punctuation\">(</span><span class=\"token string\">\"{country1} 의 수도는 어디야?\"</span><span class=\"token punctuation\">)</span>\n <span class=\"token operator\">|</span> model\n <span class=\"token operator\">|</span> StrOutputParser<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># input_variables: country2</span>\nchain2 <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>\n PromptTemplate<span class=\"token punctuation\">.</span>from_template<span class=\"token punctuation\">(</span><span class=\"token string\">\"{country2} 의 면적은 얼마야?\"</span><span class=\"token punctuation\">)</span>\n <span class=\"token operator\">|</span> model\n <span class=\"token operator\">|</span> StrOutputParser<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span>\n\ncombined <span class=\"token operator\">=</span> RunnableParallel<span class=\"token punctuation\">(</span>capital<span class=\"token operator\">=</span>chain1<span class=\"token punctuation\">,</span> area<span class=\"token operator\">=</span>chain2<span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># ⭐️ 하나의 딕셔너리에 input_variables 값을 넣어줌 ⭐️</span>\ncombined<span class=\"token punctuation\">.</span>invoke<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"country1\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"대한민국\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"country2\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"미국\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p> </p>\n<p><strong>Q2. 병렬로 묶은 Chain들을 배치 가능한가?</strong><br>\n=> <del>쌉가능</del> 매우 가능. <strong>RunnableParallel() 객체 또한 Runnable이기 때문에 동일한 batch 실행 인터페이스로 호출 가능합니다요.</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># input_variables: country2</span>\nchain1 <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>\n PromptTemplate<span class=\"token punctuation\">.</span>from_template<span class=\"token punctuation\">(</span><span class=\"token string\">\"{country1} 의 수도는 어디야?\"</span><span class=\"token punctuation\">)</span>\n <span class=\"token operator\">|</span> model\n <span class=\"token operator\">|</span> StrOutputParser<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># input_variables: country2</span>\nchain2 <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>\n PromptTemplate<span class=\"token punctuation\">.</span>from_template<span class=\"token punctuation\">(</span><span class=\"token string\">\"{country2} 의 면적은 얼마야?\"</span><span class=\"token punctuation\">)</span>\n <span class=\"token operator\">|</span> model\n <span class=\"token operator\">|</span> StrOutputParser<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span>\n\ncombined <span class=\"token operator\">=</span> RunnableParallel<span class=\"token punctuation\">(</span>capital<span class=\"token operator\">=</span>chain1<span class=\"token punctuation\">,</span> area<span class=\"token operator\">=</span>chain2<span class=\"token punctuation\">)</span>\ncombined<span class=\"token punctuation\">.</span>invoke<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"country1\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"대한민국\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"country2\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"미국\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"country1\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"일본\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"country2\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"중국\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>위 예시는 좀 복잡해 보이는데</p>\n<ol>\n<li>각 배치의 체인의 결과는 capital, area로 받으면서</li>\n<li>각 체인의 input_variables는 첫번째 배치에서는 대한민국, 미국, 두번째 배치에서는 일본, 중국을 넣어줌</li>\n</ol>\n<p>그럼 최종 결과는 첫번째  <code class=\"language-text\">{\"country1\": \"대한민국\", \"country2\": \"미국\"}</code>로 넣은 결과와 두번째  <code class=\"language-text\">{\"country1\": \"일본\", \"country2\": \"중국\"}</code>로 넣은 결과를 리스트로 묶은 것이 나오겠죠?<br>\n즉, 최종 응답 결과는 capital, area 키와 값을 갖는 딕셔너리 2개를 리스트로 묶은 것이다!</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># 출력</span>\n<span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span><span class=\"token string\">'capital'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'대한민국의 수도는 서울입니다.'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'area'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'대한민국의 면적은 약 100,363km² 입니다.'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n <span class=\"token punctuation\">{</span><span class=\"token string\">'capital'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'미국의 수도는 워싱턴 D.C.입니다.'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'area'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'미국의 면적은 대략 9,833,520 제곱 킬로미터이며, 이는 세계에서 세 번째로 넓은 국가입니다.'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span></code></pre></div>\n<p>아, 참고로 병렬처리는 각 배치에서 <strong>chain 결과 받아오는 것을 병렬로 처리</strong>되는 것이니까 헷갈리지 않도록.</p>\n<p> </p>\n<p><strong>Q3. Chain에 RunnablePassthrough()를 이용해 직접 딕셔너리를 만들었는데, chain들을 병렬로 RunnableParallel()로 병렬로 연결한다면 입력 변수가 서로 다를 때는 어떻게 전달해야 하는 것인가?</strong> (참고로 입력변수 서로 같으면 그냥 값만 넣어도 됩니다.)</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">chain1 <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">{</span><span class=\"token string\">\"country1\"</span><span class=\"token punctuation\">:</span> RunnablePassthrough<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">|</span> PromptTemplate<span class=\"token punctuation\">.</span>from_template<span class=\"token punctuation\">(</span><span class=\"token string\">\"{country1} 의 수도는?\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token operator\">|</span> ChatOpenAI<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span>\nchain2 <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">{</span><span class=\"token string\">\"country2\"</span><span class=\"token punctuation\">:</span> RunnablePassthrough<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">|</span> PromptTemplate<span class=\"token punctuation\">.</span>from_template<span class=\"token punctuation\">(</span><span class=\"token string\">\"{country2} 의 면적은?\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token operator\">|</span> ChatOpenAI<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span>\n\ncombined_chain <span class=\"token operator\">=</span> RunnableParallel<span class=\"token punctuation\">(</span>capital<span class=\"token operator\">=</span>chain1<span class=\"token punctuation\">,</span> area<span class=\"token operator\">=</span>chain2<span class=\"token punctuation\">)</span>\ncombined_chain<span class=\"token punctuation\">.</span>invoke<span class=\"token comment\">#(\"여기에 무엇을 넣어야 하는 것인가?\")</span></code></pre></div>\n<p>(❌) combined_chain.invoke({“country1”: “대한민국”, “country2”: “대한민국”})<br>\n(❌) combined_chain.invoke(“대한민국”)<br>\n입력 변수명이 달라서 이런 식으로는 다 안 됩니다.</p>\n<p>마음 편히 하는 방법은 chain을 좀 뜯어 고치는 것.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> langchain<span class=\"token punctuation\">.</span>schema<span class=\"token punctuation\">.</span>runnable <span class=\"token keyword\">import</span> RunnableLambda\n\nchain1 <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token comment\"># 방법: RunnableLambda를 사용해 country1 키에 값을 매핑</span>\n    <span class=\"token punctuation\">{</span><span class=\"token string\">\"country1\"</span><span class=\"token punctuation\">:</span> RunnableLambda<span class=\"token punctuation\">(</span><span class=\"token keyword\">lambda</span> x<span class=\"token punctuation\">:</span> x<span class=\"token punctuation\">[</span><span class=\"token string\">\"country1\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">|</span> PromptTemplate<span class=\"token punctuation\">.</span>from_template<span class=\"token punctuation\">(</span><span class=\"token string\">\"{country1} 의 수도는?\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token operator\">|</span> ChatOpenAI<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span>\n\nchain2 <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token comment\"># 방법: RunnableLambda를 사용해 country2 키에 값을 매핑</span>\n    <span class=\"token punctuation\">{</span><span class=\"token string\">\"country2\"</span><span class=\"token punctuation\">:</span> RunnableLambda<span class=\"token punctuation\">(</span><span class=\"token keyword\">lambda</span> x<span class=\"token punctuation\">:</span> x<span class=\"token punctuation\">[</span><span class=\"token string\">\"country2\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">|</span> PromptTemplate<span class=\"token punctuation\">.</span>from_template<span class=\"token punctuation\">(</span><span class=\"token string\">\"{country2} 의 면적은?\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token operator\">|</span> ChatOpenAI<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span>\n\ncombined_chain <span class=\"token operator\">=</span> RunnableParallel<span class=\"token punctuation\">(</span>capital<span class=\"token operator\">=</span>chain1<span class=\"token punctuation\">,</span> area<span class=\"token operator\">=</span>chain2<span class=\"token punctuation\">)</span>\n\ncombined_chain<span class=\"token punctuation\">.</span>invoke<span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\"># 방법: country1, country2 키에 각각 값을 전달</span>\n        <span class=\"token string\">\"country1\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"대한민국\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"country2\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"대한민국\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p><strong>아래에서 배울 RunnableLambda() 함수를 이용해서 직접 입력 값에서 꺼내어 쓰면 됩니다.</strong></p>\n<p>굳👍🏻</p>\n</blockquote>\n<p> </p>\n<p><strong>Q. Runnable 병렬 연결, RunnablePassthrough(), RunnablePassthrough.assign() 메서드, 일반 lambda 함수에 관한 복잡한 예시의 결과를 예상해봅시다.</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> langchain_core<span class=\"token punctuation\">.</span>runnables <span class=\"token keyword\">import</span> RunnableParallel\n\nrunnable <span class=\"token operator\">=</span> RunnableParallel<span class=\"token punctuation\">(</span>\n    passed<span class=\"token operator\">=</span>RunnablePassthrough<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    extra<span class=\"token operator\">=</span>RunnablePassthrough<span class=\"token punctuation\">.</span>assign<span class=\"token punctuation\">(</span>mult<span class=\"token operator\">=</span><span class=\"token keyword\">lambda</span> x<span class=\"token punctuation\">:</span> x<span class=\"token punctuation\">[</span><span class=\"token string\">\"num\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">*</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    modified<span class=\"token operator\">=</span><span class=\"token keyword\">lambda</span> x<span class=\"token punctuation\">:</span> x<span class=\"token punctuation\">[</span><span class=\"token string\">\"num\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span>\n\nrunnable<span class=\"token punctuation\">.</span>invoke<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"num\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<ol>\n<li>최종 응답 결과는 RunnableParallel 내부를 병렬로 실행하여 각 결과를 passed, extra, modified 키의 값으로 하는 딕셔너리 형태로 반환한다.</li>\n<li><code class=\"language-text\">passed</code>: 입력  <code class=\"language-text\">{\"num\": 1}</code> 그대로 반환함</li>\n<li><code class=\"language-text\">extra</code>: 입력  <code class=\"language-text\">{\"num\": 1}</code>를 x로 받아와서 num의 값 1에 3을 곱한 값을 mult에 ‘추가 할당’하여 결과 <code class=\"language-text\">{\"num\": 1, \"mult\": 3}</code>을 반환함</li>\n<li><code class=\"language-text\">modified</code>: 입력  <code class=\"language-text\">{\"num\": 1}</code>를 x로 받아와서 num의 값 1에 1을 더하여 반환함</li>\n</ol>\n<p>그래서 최종 결과는 <code class=\"language-text\">{'passed': {'num': 1}, 'extra': {'num': 1, 'mult': 3}, 'modified': 2}</code>가 나옵니다.</p>\n<p> </p>\n<h3 id=\"3-사용자-정의-함수-매핑-runnablelambda\" style=\"position:relative;\"><a href=\"#3-%EC%82%AC%EC%9A%A9%EC%9E%90-%EC%A0%95%EC%9D%98-%ED%95%A8%EC%88%98-%EB%A7%A4%ED%95%91-runnablelambda\" aria-label=\"3 사용자 정의 함수 매핑 runnablelambda permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. 사용자 정의 함수 매핑: RunnableLambda</h3>\n<p>함수를 호출한 후에 프롬프트에 넣고 싶을 때 사용합니다. RunnableLambda(사용자 정의 함수)로 이용하면 됩니다.</p>\n<p>대충, 머릿 속으로 그려보자면</p>\n<blockquote>\n<p>invoke(입력 변수) -> RunnableLambda(사용자 정의 함수)을 통해 프롬프트에 전달</p>\n</blockquote>\n<p>이런 식이 될 것 같은데, 이때 <strong>사용자 정의 함수는 정말 함수 이름만 작성합니다.</strong></p>\n<p>그렇다면,<br>\n사용자 정의 함수 즉, 함수가 있다는 것은 매개변수를 전달하는 상황이 있을 텐데, <strong>전달하는 입력 변수가 딕셔너리 형태</strong>일 때는</p>\n<ol>\n<li>직접 키로 접근하는 방법 뿐만 아니라</li>\n<li><strong>operator 라이브러리의 itemgetter 모듈을 이용하여 접근하는 방법</strong>이 있습니다.</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">chain <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">\"a\"</span><span class=\"token punctuation\">:</span> itemgetter<span class=\"token punctuation\">(</span><span class=\"token string\">\"word1\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">|</span> RunnableLambda<span class=\"token punctuation\">(</span>length_function<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"b\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"text1\"</span><span class=\"token punctuation\">:</span> itemgetter<span class=\"token punctuation\">(</span><span class=\"token string\">\"word1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"text2\"</span><span class=\"token punctuation\">:</span> itemgetter<span class=\"token punctuation\">(</span><span class=\"token string\">\"word2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n        <span class=\"token operator\">|</span> RunnableLambda<span class=\"token punctuation\">(</span>multiple_length_function<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">|</span> prompt\n    <span class=\"token operator\">|</span> model\n<span class=\"token punctuation\">)</span>\n\nchain<span class=\"token punctuation\">.</span>invoke<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"word1\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"hello\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"word2\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"world\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>요런 느낌으로 각 입력 <code class=\"language-text\">{\"word1\": \"hello\", \"word2\": \"world\"}</code>에서 <code class=\"language-text\">itemgetter(\"word1\")</code>, <code class=\"language-text\">itemgetter(\"word2\")</code>을 이용해서 각 키의 값을 꺼내어 쓸 수 있습니다.</p>\n<blockquote>\n<p><strong>Q. 그러면 그냥 딕셔너리에서 직접 키 값으로 접근하며 되지, 왜 itemgetter()을 이용하나요?</strong></p>\n<p>=> operator.itemgetter()을 작성하면, \"\"내가 이것을 뽑아 쓸 거다”라는 <strong>명확성</strong>과 간결함을 제공하기 때문입니다.</p>\n</blockquote>\n<p> </p>\n<p>그러면 입력 변수가 여러 개는…? <del>(딕셔너리 1개에 여러 개 있는 것 말고, 진짜 여러 개 말하는 것임)</del></p>\n<blockquote>\n<p><strong>Q. 입력 변수가 여러 개면 사용자 정의 함수에 어떻게 전달하는 것인가?</strong></p>\n<p>=> 결론부터 말하면, <strong>입력 변수는 반드시 하나</strong>여야 합니다.</p>\n<p>입력 변수가 1개면 매개변수도 하나일테니 적당히 잘 매칭될 것 같은데,<br>\n입력 변수가 2개면 어떻게 매칭하나 걱정이 됐습니다.</p>\n<p>그런데, 여기서 <strong>입력 변수는 반드시 하나여야 하며,<br>여러 개를 전달하고 싶을 땐 반드시 딕셔너리를 이용해서 전달해준 후 이를 전달 받아서 키의 값을 읽는 형태로 이용</strong>하여야 합니다.</p>\n<p>그래서 <strong>사용자 정의함수에서 매개변수는 보통 딕셔너리 1개 받는 형태로써 다루게 됩니다.</strong> (_dict !!)</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> operator <span class=\"token keyword\">import</span> itemgetter\n\n<span class=\"token keyword\">from</span> langchain_core<span class=\"token punctuation\">.</span>prompts <span class=\"token keyword\">import</span> ChatPromptTemplate\n<span class=\"token keyword\">from</span> langchain_core<span class=\"token punctuation\">.</span>runnables <span class=\"token keyword\">import</span> RunnableLambda\n<span class=\"token keyword\">from</span> langchain_openai <span class=\"token keyword\">import</span> ChatOpenAI\n\n\n<span class=\"token comment\"># 문장의 길이를 반환하는 함수입니다.</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">length_function</span><span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">return</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 두 문장의 길이를 곱한 값을 반환하는 함수입니다.</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">_multiple_length_function</span><span class=\"token punctuation\">(</span>text1<span class=\"token punctuation\">,</span> text2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">return</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>text1<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>text2<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># ⭐️ 딕셔너리를 매개변수로 받아오기 떄문에 _dict로 받음 ⭐️</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">multiple_length_function</span><span class=\"token punctuation\">(</span>_dict<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">return</span> _multiple_length_function<span class=\"token punctuation\">(</span>_dict<span class=\"token punctuation\">[</span><span class=\"token string\">\"text1\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> _dict<span class=\"token punctuation\">[</span><span class=\"token string\">\"text2\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n\nprompt <span class=\"token operator\">=</span> ChatPromptTemplate<span class=\"token punctuation\">.</span>from_template<span class=\"token punctuation\">(</span><span class=\"token string\">\"{a} + {b} 는 무엇인가요?\"</span><span class=\"token punctuation\">)</span>\nmodel <span class=\"token operator\">=</span> ChatOpenAI<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\nchain1 <span class=\"token operator\">=</span> prompt <span class=\"token operator\">|</span> model\n\nchain <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\"># 입력 변수 딕셔너리에서 값을 꺼내어 사용자 정의 함수 length_function에 전달</span>\n        <span class=\"token comment\"># ⭐️ 즉, length_function에 word1의 값 1개를 전달 ⭐️</span>\n        <span class=\"token string\">\"a\"</span><span class=\"token punctuation\">:</span> itemgetter<span class=\"token punctuation\">(</span><span class=\"token string\">\"word1\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">|</span> RunnableLambda<span class=\"token punctuation\">(</span>length_function<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"b\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"text1\"</span><span class=\"token punctuation\">:</span> itemgetter<span class=\"token punctuation\">(</span><span class=\"token string\">\"word1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"text2\"</span><span class=\"token punctuation\">:</span> itemgetter<span class=\"token punctuation\">(</span><span class=\"token string\">\"word2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n        <span class=\"token comment\"># ⭐️ multiple_length_function에 {\"text1\": itemgetter(\"word1\"), \"text2\": itemgetter(\"word2\")} 1개를 전달 ⭐️</span>\n        <span class=\"token operator\">|</span> RunnableLambda<span class=\"token punctuation\">(</span>multiple_length_function<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">|</span> prompt\n    <span class=\"token operator\">|</span> model\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 입력변수: {\"word1\": \"hello\", \"word2\": \"world\"}</span>\nchain<span class=\"token punctuation\">.</span>invoke<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"word1\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"hello\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"word2\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"world\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n</blockquote>\n<p> </p>\n<blockquote>\n<h3 id=\"깨알-tip-3\" style=\"position:relative;\"><a href=\"#%EA%B9%A8%EC%95%8C-tip-3\" aria-label=\"깨알 tip 3 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>💡깨알 Tip</h3>\n<p><strong>RunnableLambda 내부 사용자 정의 함수를 invoke() 메서드로 호출 시,<br>입력 변수가 그 함수의 매개변수로 값을 전달해줘야 하기 때문에, 실제로 그 함수에서 입력 변수를 사용하지 않더라도 매개 변수를 써줘야 한다.</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> langchain_core<span class=\"token punctuation\">.</span>output_parsers <span class=\"token keyword\">import</span> StrOutputParser\n<span class=\"token keyword\">from</span> langchain_core<span class=\"token punctuation\">.</span>prompts <span class=\"token keyword\">import</span> PromptTemplate\n<span class=\"token keyword\">from</span> langchain_openai <span class=\"token keyword\">import</span> ChatOpenAI\n<span class=\"token keyword\">from</span> datetime <span class=\"token keyword\">import</span> datetime\n<span class=\"token keyword\">from</span> langchain_core<span class=\"token punctuation\">.</span>runnables <span class=\"token keyword\">import</span> RunnableLambda<span class=\"token punctuation\">,</span> RunnablePassthrough\n\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">get_today</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n <span class=\"token comment\"># 오늘 날짜를 가져오기</span>\n <span class=\"token keyword\">return</span> datetime<span class=\"token punctuation\">.</span>today<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>strftime<span class=\"token punctuation\">(</span><span class=\"token string\">\"%b-%d\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 오늘 날짜를 출력</span>\n<span class=\"token comment\"># print(get_today(None))</span>\n\n\n<span class=\"token comment\"># prompt 와 llm 을 생성합니다.</span>\nprompt <span class=\"token operator\">=</span> PromptTemplate<span class=\"token punctuation\">.</span>from_template<span class=\"token punctuation\">(</span>\n <span class=\"token string\">\"{today} 가 생일인 유명인 {n} 명을 나열하세요. 생년월일을 표기해 주세요.\"</span>\n<span class=\"token punctuation\">)</span>\nllm <span class=\"token operator\">=</span> ChatOpenAI<span class=\"token punctuation\">(</span>temperature<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> model_name<span class=\"token operator\">=</span><span class=\"token string\">\"gpt-4.1-mini\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># chain 을 생성합니다.</span>\nchain <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>\n\n <span class=\"token punctuation\">{</span><span class=\"token string\">\"today\"</span><span class=\"token punctuation\">:</span> RunnableLambda<span class=\"token punctuation\">(</span>get_today<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"n\"</span><span class=\"token punctuation\">:</span> RunnablePassthrough<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n <span class=\"token operator\">|</span> prompt\n <span class=\"token operator\">|</span> llm\n <span class=\"token operator\">|</span> StrOutputParser<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>chain<span class=\"token punctuation\">.</span>invoke<span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<ol>\n<li><code class=\"language-text\">chain.invoke(3)</code>에서 3을 <code class=\"language-text\">RunnableLambda(get_today)</code>에서 사용자 정의 함수 <code class=\"language-text\">get_today</code>에 전달한다.</li>\n<li><code class=\"language-text\">get_today</code>는 그 3을 이용하지 않더라도, 매개변수를 작성해야 하므로 <code class=\"language-text\">def get_today(a):</code> 라고 작성한다.</li>\n</ol>\n<p>(참고로 get_today() 함수를 호출할 때는 입력변수에 None과 같이 매개변수 값을 써줘야 한다.)</p>\n<p>LangSmith에서 직접 확인해보면 이런 흐름으로 진행되었음을 확인할 수 있습니다.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 51.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABD0lEQVQoz5WSS07DMBRFuwIgjmPHn8T5QWijtqg0RR0wKCPECtj/Rg5KpHRCScvgSs/y9fF9z16EoiYLNWnqUMogYkUsNSqW6O5A+/nNdtXx3G1IfCAe9i9IiASpDAtnUrqmoi5qtLFED4LoXhDdCVJlyHwghIo8L0cNB/+CDlpUrz1fHy9s+z1P+zdCt8E0LbZdYkI1wuYAv4C79yOH04llf+Rx15N1a3TTYtoVOivIs2Icx7VkZ6CRkuA8IS/HFgdZ7TDKEIuERBmSJL0dqLRDp25MkRqPsRnOB6zLkVKPcxuAN7cshCSKLmswlGWDtf72hNcM3gecy88XzH2bWeBkUMr+75XnYFM9rad6Tj9dVf7M+TmMqQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"img 1\" title=\"img 1\" src=\"/static/98e0bb52d22267b2de807136aab5ce60/37523/img_1.png\" srcset=\"/static/98e0bb52d22267b2de807136aab5ce60/e9ff0/img_1.png 180w,\n/static/98e0bb52d22267b2de807136aab5ce60/f21e7/img_1.png 360w,\n/static/98e0bb52d22267b2de807136aab5ce60/37523/img_1.png 720w,\n/static/98e0bb52d22267b2de807136aab5ce60/302a4/img_1.png 1080w,\n/static/98e0bb52d22267b2de807136aab5ce60/07a9c/img_1.png 1440w,\n/static/98e0bb52d22267b2de807136aab5ce60/3d22e/img_1.png 2010w\" sizes=\"(max-width: 720px) 100vw, 720px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 57.22222222222223%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABZElEQVQoz32SyW7CMBiE8wZAEi+xncVxSFgUIKBCKbSovVRqD7216vs/yFR2CQpiOXz6Y8saz4zjxbGGSgw4VyCEw/cJgoCg5zPMC4HvwwjD0QyLeQOlDUIujmeom91vwgQ8pSTWswrT8RSxNiCU/x8IKBiTkCpDmmjEcYYk0SeBW3hRmmNXxzBKQqkMjHAMer6DhAxFUSEM2YWrrrszwe3XB95+f7B8/0Qxa5AtH5DtX6APr5DTGjrNIWTi6qA0Os2WC0GzeUS53cHMGhSbLYZPz6j2B1RWsJog4tJFbUlTS44sM64GK9p16tGQuZiMRg5OI0RMILK3+wRJqsGYuIh6M7Lf6WXQMggdtjvrhrJzF/cexrv3YhYbUevCkedDF9WYEsYMz+K207t3o90vyzEWi5WjaVao6wVWqzUmk/qq65uC7R7nElImUCp1CBGf1raSq5HvCfrHTvv9wNH2a7n2b/4BWTgeSdGVbqIAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"img 2\" title=\"img 2\" src=\"/static/33293e51d1c8b0b0e615d9c783f5abd0/37523/img_2.png\" srcset=\"/static/33293e51d1c8b0b0e615d9c783f5abd0/e9ff0/img_2.png 180w,\n/static/33293e51d1c8b0b0e615d9c783f5abd0/f21e7/img_2.png 360w,\n/static/33293e51d1c8b0b0e615d9c783f5abd0/37523/img_2.png 720w,\n/static/33293e51d1c8b0b0e615d9c783f5abd0/302a4/img_2.png 1080w,\n/static/33293e51d1c8b0b0e615d9c783f5abd0/07a9c/img_2.png 1440w,\n/static/33293e51d1c8b0b0e615d9c783f5abd0/0486e/img_2.png 2008w\" sizes=\"(max-width: 720px) 100vw, 720px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n</blockquote>\n<p> </p>\n<p> </p>\n<p>끄-읕.</p>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#lcel-%EC%9D%B8%ED%84%B0%ED%8E%98%EC%9D%B4%EC%8A%A4\">LCEL 인터페이스</a></p>\n<ul>\n<li>\n<ul>\n<li><a href=\"#batch-%EB%B0%B0%EC%B9%98-%EC%B2%98%EB%A6%AC\">batch(): 배치 처리</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EB%B9%84%EB%8F%99%EA%B8%B0-%EB%A9%94%EC%86%8C%EB%93%9C\">비동기 메소드</a></p>\n<ul>\n<li><a href=\"#1-%EB%B9%84%EB%8F%99%EA%B8%B0-%EC%8A%A4%ED%8A%B8%EB%A6%BC-async-for-astream\">1. 비동기 스트림: async for, astream()</a></li>\n<li><a href=\"#2-%EB%B9%84%EB%8F%99%EA%B8%B0-%ED%98%B8%EC%B6%9C-ainvoke\">2. 비동기 호출: ainvoke()</a></li>\n<li><a href=\"#3-%EB%B9%84%EB%8F%99%EA%B8%B0-%EB%B0%B0%EC%B9%98-abatch\">3. 비동기 배치: abatch()</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"#runnable-interface\">Runnable Interface</a></p>\n<ul>\n<li>\n<p><a href=\"#runnable-%ED%94%84%EB%A1%9C%ED%86%A0%EC%BD%9C\">Runnable 프로토콜</a></p>\n</li>\n<li>\n<p><a href=\"#%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%A0%84%EB%8B%AC-%EB%B0%A9%EB%B2%95\">데이터 전달 방법</a></p>\n<ul>\n<li><a href=\"#1-%EA%B0%92-%EC%A0%84%EB%8B%AC-runnablepassthrough\">1. 값 전달: RunnablePassthrough</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#2-runnable-%EB%B3%91%EB%A0%AC-%EC%97%B0%EA%B2%B0-runnableparallel\">2. Runnable 병렬 연결: RunnableParallel</a></p>\n</li>\n<li>\n<p><a href=\"#3-%EC%82%AC%EC%9A%A9%EC%9E%90-%EC%A0%95%EC%9D%98-%ED%95%A8%EC%88%98-%EB%A7%A4%ED%95%91-runnablelambda\">3. 사용자 정의 함수 매핑: RunnableLambda</a></p>\n</li>\n</ul>\n</li>\n</ul>\n</div>","frontmatter":{"date":"December 12, 2025","title":"[LLM] 테디노트의 RAG 비법노트 끄적끄적-2","categories":"NLP LLM","author":"변우중","emoji":"☀️"},"fields":{"slug":"/25-12-12_1/"}},"site":{"siteMetadata":{"siteUrl":"https://www.zoomkoding.com","comments":{"utterances":{"repo":"https://github.com/byeonwoojung/byeonwoojung.github.io"}}}}},"pageContext":{"slug":"/25-12-11_1/","nextSlug":"/25-09-09_1/","prevSlug":"/25-12-12_1/"}},"staticQueryHashes":["1073350324","1956554647","2938748437"]}