---
emoji: â˜€ï¸
title: "[LLM] í…Œë””ë…¸íŠ¸ì˜ RAG ë¹„ë²•ë…¸íŠ¸ ë„ì ë„ì -1"
date: '2025-12-11 00:00:00'
author: ë³€ìš°ì¤‘
tags: NLP ìì—°ì–´ ìì—°ì–´ì²˜ë¦¬ í† í°í™” LLM
categories: NLP LLM
---
ì°¸ê³  : í…Œë””ë…¸íŠ¸ì˜ RAG ë¹„ë²•ë…¸íŠ¸

ì†ŒìŠ¤ì½”ë“œ: https://github.com/teddylee777/langchain-kr

&nbsp;

ì§€ë‚œ ë²ˆ í† í°í™” ê´€ë ¨í•´ì„œ ê³µë¶€í•˜ê³  ë¸”ë¡œê·¸ë„ ì¼ì§€ë§Œ, ê´€ë ¨ ë‚´ìš© ì´í•´ì™€ ë‚´ë©´í™” ì‚¬ì´ì˜ ê´´ë¦¬ê°€ ìˆì—ˆë‹¤.
ê·¸ëŸ°ë°, ê°“ í…Œë””ë…¸íŠ¸ë‹˜ ê°•ì˜ ë“¤ìœ¼ë©´ì„œ ê·¸ ê´´ë¦¬ë¥¼ ì¢í˜€ë‚˜ê°ˆ ìˆ˜ ìˆì—ˆë˜ ê²ƒ ê°™ë‹¤^^< êµ³ğŸ‘ğŸ»

(ì˜¤ëŠ˜ ê²Œì‹œê¸€ì€ ì§„ì§œ ë‘ì„œì—†ì´ ê¹¨ì•Œ Tip ë„£ì„ ê²ƒì„ë‹¤... ë„ˆë¬´ ëœ¬ê¸ˆ ì—†ì–´ë„ ì´í•´ë¶€íƒ...)

&nbsp;

## ì„œë¸Œì›Œë“œ ê¸°ë°˜ í† í°í™” ì™œ í•˜ëŠ” ê²ƒì¸ê°€?

---

**ë¬¸ì ê¸°ë°˜ í† í°í™”**(í•œêµ­ì–´ëŠ” ìëª¨ ë‹¨ìœ„ë¡œ í† í°í™”)ëŠ” ë„ˆë¬´ ìª¼ê°œë‹ˆê¹Œ í¸ì§‘ê±°ë¦¬ë¥¼ ì´ìš©í•´ ê²€ìƒ‰ì–´ ì¶”ì²œ, ì˜¤íƒ€ êµì • ì •ë„ì— í™œìš©í•  ìˆ˜ ìˆëŠ”ë°,

**í…ìŠ¤íŠ¸ ë¬¸ì¥ ìƒì„±ì—ì„œëŠ” ë„ˆë¬´ ë§ì´ ë¶„ì ˆí•´ë†“ìœ¼ë‹ˆ, ì´ë ‡ê²Œ ìª¼ê°  ê²ƒì„ ëª¨ë¸ì´ í•™ìŠµí•˜ê³  ì´ê±¸ ìƒì„±í•´ë‚´ê¸°ê°€ ì–´ë ¤ì›Œì§„ë‹¤.(ëª¨ë¸ì´ ìƒì„±í•´ì•¼í•˜ëŠ” ë¬¶ìŒì´ ë” ë§ì•„ì§!!)
(ìš°ë¦¬í•œí…Œ ìëª¨ìŒë“¤ì„ ë§‰ ë¿Œë ¤ ì£¼ê³ , í…ìŠ¤íŠ¸ ë¬¸ì¥ ë§Œë“¤ë¼ê³  ì‹œì¼œë³´ë©´ ì–¼ë§ˆë‚˜ í˜ë“ ê°€......)**

ë‹¨ì–´ ê¸°ë°˜ í† í°í™”ëŠ” í…ìŠ¤íŠ¸ ë¬¸ì¥ ìƒì„±ì— íš¨ê³¼ì ì¼ ìˆ˜ ìˆë‹¤ì§€ë§Œ, ì§€ë‚œ ë¸”ë¡œê·¸ ê¸€ì— ë‚¨ê²¼ë“¯ì´ ìì£¼ ì‚¬ìš©í•˜ëŠ” ë‹¨ì–´ë“¤ì´ ìˆì–ì•„..?
ê³ ëŸ° ê²ƒë“¤ë„ ê³ ë ¤í•˜ë ¤ë©´ **ì„œë¸Œì›Œë“œ ê¸°ë°˜ í† í°í™”**ë¥¼ í†µí•´ì„œ **ë‹¨ì–´ ì‚¬ì „ ë§Œë“œëŠ” ê²ƒ**ì´ ì¢‹ì§€~~

ê·¸. ì´. í›„. ê·¸ í† í°ë³„ë¡œ ë²¡í„°í™” ì‹œí‚¤ëŠ” ê²ƒì´ë‹¤!!! -> ê·¸ í•˜ë‚˜ê°€ 1í† í°ì„ -> ì¦‰, **í† í°í™” ì˜í•˜ë©´ í† í° ì‚¬ìš©ëŸ‰ ì¤„ì¼ ìˆ˜ ìˆë‹¤**!!!!

&nbsp;

## í•œêµ­ì–´ ë²„ì „ í† í°í™” vs ì˜ì–´ ë²„ì „ í† í°í™”

---

### í•œêµ­ì–´ ë²„ì „

<img src="img_1.png" style="zoom:38%;" />

### ì˜ì–´ ë²„ì „

<img src="img_2.png" style="zoom:40%;" />

ê·¸ë¦¼ì—ì„œ ì˜¤ë¥¸ìª½ í˜•ê´€íœìœ¼ë¡œ ì¹ í•œ ë§Œí¼ ê°ê° í•œ í† í°ì´ë‹¤. ê°™ì€ ë¬¸ì¥ì´ì§€ë§Œ, ì˜ì–´ ë²„ì „ì´ í† í°ì´ ì ê²Œ ë“ ë‹¤.
ì¦‰, ë¹„ìš©ì„ ì¤„ì´ê¸´ ìœ„í•´ì„  ì˜ì–´ë¡œ ë°”ê¿”ì„œ í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.

ê·¸ë¦¬ê³ , ëª¨ë¸ì— í•œêµ­ì–´ ì„œë¸Œì›Œë“œë¥¼ í•™ìŠµì‹œí‚¨ë‹¤ë©´ ë” ì¢‹ì„ ìˆ˜ ìˆì§€ ì•Šê² ëŠ”ê°€,,,,
(í•™ìŠµ ë¹„ìš©ì´ ë” ë“¤ ìˆ˜ëŠ” ìˆëŠ”ë°, LLM Post Trainingì´ í•„ìš”í•œ í”„ë¡œì íŠ¸ê°€ ìˆë‹¤ë©´ ë°˜ë“œì‹œ ê³ ë ¤í•´ë³¼ë§Œ í•˜ë‹¤.)
í•œêµ­ì–´ ë²„ì „ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆë“¯ì´ 'ì•ˆë…•í•˜ì„¸ìš”'ëŠ” 'ì•ˆ'+'ë…•í•˜ì„¸ìš”' 2ê°œ í† í°ìœ¼ë¡œ ì¸ì‹í•˜ê³  ìˆë‹¤. 'ì—´ì‹¬íˆ'ë„ 'ì—´' + 'ì‹¬' + 'íˆ' 3ê°œ í† í°ìœ¼ë¡œ ì¸ì‹í•˜ê³  ìˆë‹¤.
(ìš”ì¦˜ì€ ì˜ˆì „ë³´ë‹¤ëŠ” gptì˜ í•œêµ­ì–´ í† í° ìµœì í™” ì˜ ë˜ì–´ ìˆë‹¤ê³  í•˜ì§€ë§Œ, ì–´ì¨Œë“  í† í° ìµœì í™”ë¥¼ ìœ„í•´ ì´ì •ë„ëŠ” ì•Œì•„ ë‘ì,, ì§€ê¸ˆì€ GPT-5.1ê¹Œì§€ ë‚˜ì™”ëŠ”ë° ë‚˜ì¤‘ì— í™•ì¸ ã„±ã„±)

ì„œë¸Œì›Œë“œì˜ ì¤‘ìš”ì„± ì¸ì‹ ì™„.

&nbsp;

> ### ğŸ’¡ê¹¨ì•Œ Tip
>
> ë©€í‹°ëª¨ë‹¬ GPT ì‚¬ìš©ì‹œ LangChainì˜ HumanMessageë¥¼ ì´ìš©í•œë‹¤.
>
> ```python
> # HumanMessage ì•ˆì— ì´ë¯¸ì§€ì™€ í…ìŠ¤íŠ¸ë¥¼ ê°™ì´ ë„£ëŠ” ë°©ë²•
> from langchain_openai import ChatOpenAI
> from langchain_core.messages import HumanMessage
> 
> # GPT-4o / GPT-4.1 ë“± ë©€í‹°ëª¨ë‹¬ ì§€ì› ëª¨ë¸
> llm = ChatOpenAI(
>     model="gpt-4o-mini", 
>     temperature=0.1,
> )
> 
> # ì˜ˆì‹œ ì´ë¯¸ì§€
> image_url = "https://example.com/cat.png"
> 
> messages = [
>     HumanMessage(
>         content=[
>             {"type": "text", "text": "ì´ ì´ë¯¸ì§€ì— ë¬´ì—‡ì´ ë³´ì—¬?"},
>             {
>                 "type": "image_url",
>                 "image_url": {"url": image_url},
>             },
>         ]
>     )
> ]
> ```

&nbsp;

## LCEL(LangChain Expression Language)

---

chain = prompt | model | output_parser
ê°€ì¥ ê¸°ë³¸ì ì¸ chain í˜•íƒœì´ë‹¤.

```python
from langchain_openai import ChatOpenAI
# from langchain_teddynote.messages import stream_response  # teddynote ìŠ¤íŠ¸ë¦¬ë° ì¶œë ¥ (forë¬¸ ì‚¬ìš©í•˜ì§€ ì•Šê³ ë„ ì‰½ê²Œ ì¶œë ¥ë˜ë„ë¡ ë˜ì–´ ìˆìŒ)
from langchain_core.prompts import PromptTemplate

prompt = PromptTemplate.from_template("{topic}ì— ëŒ€í•´ {how} ì„¤ëª…í•´ì£¼ì„¸ìš”.")
output_parser = StrOutputParser()

model = ChatOpenAI()
chain = prompt | model | output_parser
```

chainì„ ì¶œë ¥í•´ì„œ ë³´ë©´

```
PromptTemplate(input_variables=['how', 'topic'], input_types={}, partial_variables={}, template='{topic} ì— ëŒ€í•´ {how} ì„¤ëª…í•´ì£¼ì„¸ìš”.')
| ChatOpenAI(client=<openai.resources.chat.completions.completions.Completions object at 0x1751c8650>, async_client=<openai.resources.chat.completions.completions.AsyncCompletions object at 0x175156110>, root_client=<openai.OpenAI object at 0x15ffe7b90>, root_async_client=<openai.AsyncOpenAI object at 0x1751c9290>, model_name='gpt-4.1-nano', temperature=0.1, model_kwargs={}, openai_api_key=SecretStr('**********'))
| StrOutputParser()
```

ì´ë ‡ê²Œ ì—°ê²°ë¨ì„ ì•Œ ìˆ˜ ìˆë‹¤.

```python
input = {"topic": "ì¸ê³µì§€ëŠ¥ ëª¨ë¸ì˜ í•™ìŠµ ì›ë¦¬", "how": "5ì‚´ì§œë¦¬ ì–´ë¦° ì•„ì´ì—ê²Œë„ ì´í•´í•  ìˆ˜ ìˆë„ë¡ ì‰½ê²Œ"}

chain.invoke(input)
```

inputì—ì„œ ë”•ì…”ë„ˆë¦¬ í˜•íƒœë¡œ ë³€ìˆ˜ ê°’ì„ ë„£ì–´ì£¼ê³ , chainì— invoke() í•¨ìˆ˜ì— ë˜ì ¸ì£¼ë©´ ê°’ì„ í•œë²ˆì— ìƒì„±í•´ì„œ ë³´ì—¬ì¤ë‹ˆë‹¤.
(ì°¸ê³ 1: ë³€ìˆ˜ê°€ 1ê°œì¼ ë•ŒëŠ” ë”•ì…”ë„ˆë¦¬ê°€ ì•„ë‹Œ ë¬¸ìì—´ë¡œ ë˜ì ¸ì¤˜ë„ ê°€ëŠ¥í•˜ë‹¤)
(ì°¸ê³ 2: stream() í•¨ìˆ˜ì— ë„£ì–´ì£¼ê³  forë¬¸ìœ¼ë¡œ ì¶œë ¥í•˜ë©´ ì‹¤ì‹œê°„ìœ¼ë¡œ ì¶œë ¥ í† í°ì„ ì¶œë ¥ê°€ëŠ¥í•˜ë‹¤)

ì´ë•ŒëŠ” **ëª¨ë“  ë³€ìˆ˜ì˜ ê°’ì„ ë„£ì–´ì£¼ì–´ì•¼ ì˜¤ë¥˜ê°€ ë‚˜ì§€ ì•ŠëŠ”ë‹¤**.

ê·¸ë¦¬ê³ , ì¶œë ¥ ê²°ê³¼ëŠ” chain = prompt | model | output_parser ì´ë¯€ë¡œ
**modelì—ì„œ ë‚˜ì˜¨ outputì˜ content !!!! ë¶€ë¶„**ì„ string í˜•íƒœë¡œ íŒŒì‹±í•˜ì—¬ ë‚˜ì˜¨ë‹¤!!
(**ì°¸ê³ 3: chain = prompt | model ì˜ ê²°ê³¼ëŠ” model ê°ì²´ê°€ ë‚˜ì™€ì„œ content, response_metadata ë“± í´ë˜ìŠ¤ ì†ì„±ë“¤ ëª¨ë‘ ê²°ê³¼ë¡œ ê°–ëŠ”ë‹¤**)

&nbsp;

> ### ğŸ’¡ê¹¨ì•Œ Tip
>
> ì¤‘ê´„í˜¸ {{}}ë¥¼ ê²¹ì³ ì“°ë©´ ë³€ìˆ˜ë¡œ ì¸ì‹í•˜ì§€ ì•Šê³  ì¤‘ê´„í˜¸ 2ìŒìœ¼ë¡œ ì¸ì‹í•œë‹¤.
> (f-string ë°©ì‹ì€ ì¤‘ê´„í˜¸ ê²¹ì³ ì“°ë©´ ì¤‘ê´„í˜¸ 1ìŒìœ¼ë¡œ ì¸ì‹í•˜ëŠ”ë° prompt í…œí”Œë¦¿ì— ë„£ìœ¼ë©´ ë‘ìŒìœ¼ë¡œ ì¸ì‹ë¨... ì™œ ê·¸ëŸ°ì§€ëŠ” ì´í•´ê°€ ì•ˆê°€ìš”..)
>
> ```python
> template = "{{question}}ê³¼ ê°™ì´ ì¤‘ê´„í˜¸ ê²¹ì³ ì“°ë©´ ë³€ìˆ˜ë¡œ ì¸ì‹í•˜ì§€ ì•ŠëŠ”ë‹¤."
> template
> # '{{question}}ê³¼ ê°™ì´ ì¤‘ê´„í˜¸ ê²¹ì³ ì“°ë©´ ë³€ìˆ˜ë¡œ ì¸ì‹í•˜ì§€ ì•ŠëŠ”ë‹¤.'
> ```

&nbsp;

ì•„, invoke() ì¶œë ¥ê³¼ stream() ì¶œë ¥ ë°©ë²• ë¹„êµë„ í•´ë³´ì.

### invoke() ì¶œë ¥: ë‹µë³€ ì™„ì„± í›„ ì¶œë ¥

```python
answer = llm.stream("ëŒ€í•œë¯¼êµ­ì˜ ì•„ë¦„ë‹¤ìš´ ê´€ê´‘ì§€ 10ê³³ê³¼ ì£¼ì†Œë¥¼ ì•Œë ¤ì£¼ì„¸ìš”!")
```

### stream() ì¶œë ¥: ì‹¤ì‹œê°„ ì¶œë ¥

```python
### ê°“ í…Œë””ë…¸íŠ¸ë‹˜ì´ ë§Œë“œì‹  ê²ƒ í™œìš©
from langchain_openai import ChatOpenAI
from langchain_teddynote.messages import stream_response

# ê°ì²´ ìƒì„±
llm = ChatOpenAI(
    temperature=0.1,  # ì°½ì˜ì„± (0.0 ~ 2.0)
    model_name="gpt-4.1-nano",  # ëª¨ë¸ëª…
)
answer = llm.stream("ëŒ€í•œë¯¼êµ­ì˜ ì•„ë¦„ë‹¤ìš´ ê´€ê´‘ì§€ 10ê³³ê³¼ ì£¼ì†Œë¥¼ ì•Œë ¤ì£¼ì„¸ìš”!")

# ìµœì¢… ê²°ê³¼ë¬¼ í† í°ë³„ ëˆ„ì í•˜ë©´ì„œ ì‹¤ì‹œê°„ ì¶œë ¥
final_ansewer2 = stream_response(answer, return_output=True)

```

```python
### êµ­ë£° ë°©ë²•
from langchain_openai import ChatOpenAI

# ê°ì²´ ìƒì„±
llm = ChatOpenAI(
    temperature=0.1,  # ì°½ì˜ì„± (0.0 ~ 2.0)
    model_name="gpt-4.1-nano",  # ëª¨ë¸ëª…
)

answer = llm.stream("ëŒ€í•œë¯¼êµ­ì˜ ì•„ë¦„ë‹¤ìš´ ê´€ê´‘ì§€ 10ê³³ê³¼ ì£¼ì†Œë¥¼ ì•Œë ¤ì£¼ì„¸ìš”!")

# ìµœì¢… ê²°ê³¼ë¬¼ í† í°ë³„ ëˆ„ì í•˜ë©´ì„œ ì‹¤ì‹œê°„ ì¶œë ¥
final_answer = ""  # ìµœì¢… ê²°ê³¼ë¬¼ í† í° ëˆ„ì ì‹œí‚¬ ë³€ìˆ˜
for token in answer:
    # token.content: ê° í† í° ë³„ë¡œ ë‹´ê¸´ ë‚´ìš©
    print(token.content, end="", flush=True)
    final_answer += token.content
```

**.stream() í•œë‹¤ê³  ë°”ë¡œ í˜¸ì¶œë˜ëŠ” ê²ƒì´ ì•„ë‹ˆê³ , forë¬¸ì„ í†µí•´ ì‹¤ì‹œê°„ìœ¼ë¡œ í˜¸ì¶œë˜ë©´ì„œ ì‘ë‹µì„ ë°›ëŠ”ë‹¤.**

&nbsp;

&nbsp;

ì¼ë‹¨ ì—¬ê¸°ì„œ ë.

```toc

```
